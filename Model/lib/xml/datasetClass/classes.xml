<?xml version="1.0" encoding="UTF-8" ?>
<?xml-stylesheet href="./../../xsl/datasetstyle.xsl" type="text/xsl" ?>
      
<!-- define here reusable text -->
<!DOCTYPE datasetClasses [
  <!ENTITY organismAbbrev "The abbreviation used for this organism and assigned in the project.xml dataset, e.g. in ToxoDB.xml, a value of the attribute organismAbbrev is 'tgonME49'. We have a adopted a standard of using the first letter (lower case) of the genus followed by the first two letters (lower case) of the species followed by the strain, e.g. Toxoplasma gondii ME49 abbreviation is tgonME49. This abbreviation is like a 'primary key' for the organism.  It must be unique to this organism, and may never change for the lifetime of the workflow.  It should only include alpha-numeric characters.">
  <!ENTITY projectName "The name of the project, eg, PlasmoDB.  This value is used to find graph files that are generated from  datasets, so it must be equal to the name of project directory which contains the project's dataset files.  It is stored in in the GUS database in Core.ProjectInfo.name and must agree with the project=XXXXXX value in gus.config.  It is also used in the names of website files and directories.">
  <!ENTITY organismFullName "The full name for this organism.  This must match the scientific name in the NCBI taxonomy for this organism (see ncbiTaxonId).  It is specified redundantly to cross validate the name and ncbiTaxonId.">
  <!ENTITY ncbiTaxonId "The NCBI Taxonomy ID for this organism.">
  <!ENTITY speciesNcbiTaxonId "The NCBI Taxonomy ID for the species to which this organism belongs.  This ID must agree with the ncbi Taxonomy database. Example: the subspecies 'Homo sapiens neanderthalensis' (taxonomy id = 63221)  belongs to the species 'Homo sapiens' (taxonomy id = 9606) and is below 'Homo sapiens' in the NCBI taxonomy hierarchy. In this case the speciesNcbiTaxonId = 9606.">
  <!ENTITY referenceStrainOrganismAbbrev "The organism abbreviation of the reference strain for this organism's species.  If this orgnanism is a reference strain, this value must be equal to its organismAbbrev; otherwise it must be equal to the organism abbreviation of this species' reference strain.  (These rules are validated by the triggers on the ApiDB.Organism table.)">
  <!ENTITY isAnnotatedGenome "[true|false] If true then this organism's genome has been annotated with gene models by the data provider.">
  <!ENTITY strainAbbrev "The abbreviation to use for this organism's strain.  Should not include the species name.  For example, for the organism 'Plasmodium Falciparum 3D7', this should be set to '3D7'.  It does not need to agree exactly with the organism's name in the NCBI Taxonomy.   This abbreviation should not include FIX: WHAT CHARS GIVE US TROUBLE?">
  <!ENTITY name "The name of this dataset, typically the provider, for example 'GeneDB.'  This name is used to form the directory name in Manual Delivery where this data will be found, and the name of the resource in the database.  It is not displayed to the end-user.">
  <!ENTITY version "The version of this dataset, typically a release number or a date in yyyy-mm-dd format. This version is used to find this dataset in Manual Delivery.  It is displayed to end-users.">
  <!ENTITY soTerm "The Sequence Ontology term that describes the sequence data in this dataset.">
  <!ENTITY sourceIdRegex "A Perl regular expression that will extract the stable identifier (a.k.a the source ID) from the definition line of a FASTA sequence.  For example >(\S+) will extract the first non-white-space word on the definition line.  The part to extract must be in parentheses.">
  <!ENTITY isfMappingFile "The mapping file required by the GUS InsertSequenceFeatures (ISF) plugin.  See the ISF documentation.">

]>

<!-- testing svn -->
<datasetClasses>

  <defaultPropertyDescriptions>
  </defaultPropertyDescriptions>

  <!-- temporary while developing API GUI -->
  <datasetClass class="example" category="" datasetFileHint="organism">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="experimentName"/>
    <prop name="experimentVersion"/>

    <graphTemplateFile name="project.xml"/>

    <qaNotes>To QA this class ask Dave Falke, he is really good at it</qaNotes>

    <templateInjector name="org.apidb.apicommon.model.datasetInjector.AnnotatedGenome">Optionally text here</templateInjector>

    <datasetLoader datasetName="metaboliteProfiles_${experimentName}_RSRC" version="${experimentVersion}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="FILL"
              organismAbbrev="">

      <manualGet fileOrDir="common/empty">
        <descriptionOfFinal>The final/ dir must contain three .fasta files</descriptionOfFinal>
        <example dir="genome/falke/2013">Provider gives crazy files</example>
        <example dir="genome/fischer/2012">Provider gives really crazy files</example>
        <dir name="final">
        </dir>
      </manualGet>

      <unpack>ln -s @@manualDeliveryDir@@/${projectName}/common/massSpecExperiments/${experimentName}/${experimentVersion}/final/ @@dataDir@@/final</unpack>

      <getAndUnpackOutput dir="@@dataDir@@/final" />
      <getAndUnpackOutput file="@@dataDir@@/final/config.txt"/>
      <getAndUnpackOutput file="@@dataDir@@/final/profile_config.txt"/>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="organism" category="organism" datasetFileHint="">
    <purpose>Add an organism to the workflow.  This "dataset" is not actually a dataset.  Instead, it provides the framework and essential properties of the organism so that real datasets can be added to the organism.  It is critical that every property of this dataset be carefully reviewed for correctness before the workflow runs this organism.   Correcting them after the workflow runs is very expensive.  NOTE: in the datasets file, reference strains must precede secondary strains</purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="projectName">&projectName;</prop>
    <prop name="publicOrganismAbbrev">The abbreviation for this organism that the end-user will see.   It is used in displays when there is very limited space.</prop>
    <prop name="organismFullName">&organismFullName;</prop>
    <prop name="organismNameForFiles">The name of this organism for use in file and directory names, for example on the download site.  It should not include white space or other characters that are not file friendly.</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;  The scientific name for this entry in the NCBI Taxonomy must match the organismFullName property.</prop>
    <prop name="isReferenceStrain">[true|false] If true then this organism is the reference strain for its species.  Exactly one organism per species must set this value to 'true', and all others must set it to 'false'.  FIX: NEED TO ADD VALIDATION FOR THIS TO InsertOrganism PLUGIN.  The reference strain for a species has the responsibility for loading species-wide datasets, for example ESTs.  Dataset classes that are intended to be used only by reference strains are typically named with the prefix 'referenceStrain-', for example 'referenceStrain-dbEST'.  Be sure to include these datasets in reference strains, and omit them from other organisms.</prop>
    <prop name="referenceStrainOrganismAbbrev">&referenceStrainOrganismAbbrev;</prop>
    <prop name="isFamilyRepresentative">[true|false] If true this organism acts as a representative for its taxonomic family.  Some dataset classes are designed to be included only for these representatives.  For example, isolates might be loaded only at the family level. </prop>
    <prop name="familyRepOrganismAbbrev">Organism abbreviation of the organism that, for this organism, acts as representative for its family.  All organisms must provide this value, even if self</prop>
    <prop name="familyNcbiTaxonIds">Only needed if this organism is a family representative.  One or more NCBI taxonomy IDs that are the root IDs for this family.  This is a flexible mechanism to steer around imperfections in the NCBI taxonomy at the family level.</prop>
    <prop name="familyNameForFiles">Only needed if this organism is a family representative.  The taxon name to use in download files for this family.</prop>
    <prop name="isAnnotatedGenome">&isAnnotatedGenome;</prop>
    <prop name="hasTemporaryNcbiTaxonId">[true|false] If true then this organism is not included in the NCBI Taxonomy table and requires a temporary taxon id (see ncbiTaxonId).  FIX: MORE HERE.</prop>
    <prop name="orthomclAbbrev">The abbreviation for this organism used by OrthoMCL-DB.  FIX: MORE HERE</prop>
    <prop name="strainAbbrev">&strainAbbrev;</prop>
    <prop name="genomeSource">The name of the provider of this organism's genome data.  For example, "GeneDB."  This value is included in the definition lines of fasta files including the genome and feature sequences, to give credit to the provider.</prop>
    <prop name="genomeVersion">The date or version number for this organism's genome, as determined by its provider.  If a date, typically the date the data was downloaded.   FIX:  WHAT DO WE USE THIS FOR?</prop>
    <prop name="annotationIncludesTRNAs">[true|false] If true then this genome's annotation includes predicted tRNAs.  This property is read by workflow steps that predict tRNAs.   If it is true those steps are skipped.</prop>
    <prop name="runExportPred">[true|false]  If "true" then the ExportPred program should be run on this organism. Typically only true for Plasmodium organisms</prop>
    <prop name="taxonFilterForNRProteinsAlignedToGenome">A comma delimited scientific names to be used to filter NRDB protein matches against this organism's genome  sequence. Use just genus name for now. For example:  Plasmodium.</prop>
    <prop name="isHugeGenome">[true|false] If true then skip making orfs and skip generating download files for orfs</prop>

    <prop name="maxIntronSize">An approximation of the maximum intron size.  Used by BLAT when mapping proteins or DNA to this organisms genome.</prop>

    <prop name="isNotEbiGenome">For any genome which is not coming from mysql dump from EBI.</prop>
    <graphTemplateFile name="project.xml"/>

    <!-- This is ONLY HERE so the propsfromDatasets works;  No workflow graph calls this -->
    <datasetLoader datasetName="${organismAbbrev}_RSRC" version="${genomeVersion}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="organism"
              subType=""
              organismAbbrev="">
      <manualGet fileOrDir="common/empty">
        <descriptionOfFinal></descriptionOfFinal>
        <dir name="final">
        </dir>
      </manualGet>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>




  </datasetClass>

  <datasetClass class="validateOrganismInfo" category="organism" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="strainAbbrev">&strainAbbrev;</prop>
    <prop name="projectName">&projectName;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>

    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

  </datasetClass>

  <!-- an instance of this class is needed if and only if an organism is a -->
  <!-- reference strain.  it is used by the strain comparison machinery -->
  <datasetClass class="referenceStrain" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="isAnnotatedGenome">&isAnnotatedGenome;</prop>

    <graphTemplateFile name="project.xml"/>

  </datasetClass>



  <!-- Category: genome -->


  <datasetClass class="ebi_primary_genome" category="" datasetFileHint="">
    <purpose>Load the primary genome sequence and annotation for an organism, when the data is provided from ebi mysql dump.  </purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="ebiOrganismName">matches ebi ftp directory name</prop>
    <prop name="ebiVersion">matches ebi ftp directory name</prop>
    <prop name="genomeVersion">matches assembly source id from ebi</prop>
    <prop name="releaseDate">version of the data, in date format 2012-11-29</prop>
    <prop name="ebi2gusTag">tag of ebi2gus container</prop>

    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_primary_genome_RSRC"
              version="${genomeVersion}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              type="genome"
              scope="organism"
              organismAbbrev="${organismAbbrev}"
              releaseDate="${releaseDate}">


      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/ebi_primary_genome/${ebiVersion}/final/">
        <dir name="final">
           <descrip></descrip>
           <file name="chromosomeMap.txt">chromosome map file</file>
        </dir>
      </manualGet>

     <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>



<!-- chromosomeMap.txt file with 3 tab delimited columns, source_id,chromosome,chromosome_order_number, must be in final dir for chromosomes -->
  <datasetClass class="genbank_primary_genome" category="" datasetFileHint="">
    <purpose>Load the primary genome sequence and annotation for an organism, when the data is provided in a GenBank format file.  </purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="soTerm">[chromosome, supercontig, contig] &soTerm;</prop>
    <prop name="mapFile">&isfMappingFile;</prop>
    <prop name="releaseDate">version of the data, in date format 2012-11-29</prop>

    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_primary_genome_RSRC"
              version="${version}"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              type="genome"
              scope="organism"
              organismAbbrev="${organismAbbrev}"
              releaseDate="${releaseDate}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${soTerm}_${name}_genbank/${version}/final/">
        <dir name="final">
           <descrip>description would go here</descrip>
           <dir name="someSubDir">
             <descrip>subdir's descrip</descrip>
           </dir>
           <file name="*.fasta">more descrip</file>
           <file name="anotherFile">more descrip</file>
        </dir>
      </manualGet>

      <pluginArgs>--extDbName %DATASET_NAME% --extDbRlsVer %DATASET_VERSION% --mapFile @@gusHome@@/lib/xml/isf/${mapFile} --inputFileOrDir @@dataDir@@/final/genome.gbf --chromosomeMapFile @@dataDir@@/final/chromosomeMap.txt --fileFormat genbank --soExtDbSpec "SO_RSRC|%" --organism ${ncbiTaxonId} --seqSoTerm ${soTerm} --bioperlTreeOutput @@dataDir@@/bioperlTree.out --validationLog @@dataDir@@/validation.log --postprocessingDirective SET_TRANSCRIPT_IDS --postprocessingDir @@dataDir@@/final/ </pluginArgs>
    </datasetLoader>
  </datasetClass>

  <!-- done automatically for all primary genomes
  <datasetClass class="insertScaffoldGapFeatures" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="genomeDbName"/>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="primaryVirtualGenome.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_insertScaffoldGapFeatures_RSRC"
              version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertScaffoldGapFeatures"
              scope="organism"
              type="feature"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

     <pluginArgs>- -extDbRlsName ${genomeDbName} - -extDbRlsVer ${version} - -SOExtDbRlsSpec 'SO_RSRC|%'</pluginArgs>
    </datasetLoader>
  </datasetClass>
  -->


<!-- chromosomeMap.txt file with 3 tab delimited columns, source_id,chromosome,chromosome_order_number, must be in final dir for chromosomes -->
  <datasetClass class="genbank_secondary_genome" category="genome" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="soTerm">[supercontig, contig, random_sequence] &soTerm;</prop>
    <prop name="mapFile"/>
    

    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${soTerm}_${name}_RSRC"
              version="${version}"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
	      parentDatasetName="${organismAbbrev}_primary_genome_RSRC"
              scope="organism"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${soTerm}_${name}_genbank/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--extDbName %PARENT_DATASET_NAME% --extDbRlsVer %PARENT_DATASET_VERSION% --mapFile @@gusHome@@/lib/xml/isf/${mapFile} --inputFileOrDir @@dataDir@@/final/genome.gbf --chromosomeMapFile @@dataDir@@/final/chromosomeMap.txt --fileFormat genbank --soExtDbSpec "SO_RSRC|%" --organism ${ncbiTaxonId} --seqSoTerm ${soTerm} --bioperlTreeOutput @@dataDir@@/bioperlTree.out --validationLog @@dataDir@@/validation.log --postprocessingDirective SET_TRANSCRIPT_IDS --postprocessingDir @@dataDir@@/final/ </pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="genbank_organelle_genome" category="genome" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="soTerm">[mitochondrial_chromosome, apicoplast_chromosome] &soTerm;</prop>
    <prop name="mapFile"/>
    <prop name="organelle"/>

    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${soTerm}_${name}_RSRC"
              version="${version}"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              scope="organism"
	      parentDatasetName="${organismAbbrev}_primary_genome_RSRC"
              type="organellar_genome"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${soTerm}_${name}_genbank/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--extDbName %PARENT_DATASET_NAME% --extDbRlsVer %PARENT_DATASET_VERSION% --mapFile @@gusHome@@/lib/xml/isf/${mapFile} --inputFileOrDir @@dataDir@@/final/genome.gbf --fileFormat genbank --soExtDbSpec "SO_RSRC|%" --organism ${ncbiTaxonId} --seqSoTerm ${soTerm} --bioperlTreeOutput @@dataDir@@/final/bioperltree.out --validationLog @@dataDir@@/final/validation.log --postprocessingDirective SET_TRANSCRIPT_IDS --postprocessingDir @@dataDir@@/final/ </pluginArgs>
    </datasetLoader>
  </datasetClass>


  <!-- This class is to be used for loading gene features outside of official gene model -->
  <!-- One example is deprecated genes from GiardiaDB -->


<!-- chromosomeMap.txt file with 3 tab delimited columns, source_id,chromosome,chromosome_order_number, must be in final dir for chromosomes -->
  <datasetClass class="embl_primary_genome" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="soTerm">[chromosome, supercontig, contig] &soTerm;</prop>
    <prop name="releaseDate">version of the data, in date format 2012-11-29</prop>
    <prop name="mapFile"/>

    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_primary_genome_RSRC"
              version="${version}"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              scope="organism"
              type="genome"
              organismAbbrev="${organismAbbrev}"
              releaseDate="${releaseDate}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${soTerm}_${name}_embl/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--extDbName %DATASET_NAME% --extDbRlsVer %DATASET_VERSION% --mapFile @@gusHome@@/lib/xml/isf/${mapFile} --inputFileOrDir @@dataDir@@/final/genome.embl --chromosomeMapFile @@dataDir@@/final/chromosomeMap.txt --fileFormat embl --soExtDbSpec "SO_RSRC|%" --organism ${ncbiTaxonId} --seqSoTerm ${soTerm} --bioperlTreeOutput @@dataDir@@/bioperlTree.out --validationLog @@dataDir@@/validation.log --postprocessingDirective SET_TRANSCRIPT_IDS --postprocessingDir @@dataDir@@/final/</pluginArgs>
    </datasetLoader>
  </datasetClass>

<!-- chromosomeMap.txt file with 3 tab delimited columns, source_id,chromosome,chromosome_order_number, must be in final dir for chromosomes -->
  <datasetClass class="embl_secondary_genome" category="genome" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="soTerm">[supercontig, contig, random_sequence] &soTerm;</prop>
    <prop name="mapFile"/>
   

    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${soTerm}_${name}_RSRC"
              version="${version}"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
	      parentDatasetName="${organismAbbrev}_primary_genome_RSRC"
              scope="organism"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${soTerm}_${name}_embl/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--extDbName %PARENT_DATASET_NAME% --extDbRlsVer %PARENT_DATASET_VERSION% --mapFile @@gusHome@@/lib/xml/isf/${mapFile} --inputFileOrDir @@dataDir@@/final/genome.embl --chromosomeMapFile @@dataDir@@/final/chromosomeMap.txt --fileFormat embl --soExtDbSpec "SO_RSRC|%" --organism ${ncbiTaxonId} --seqSoTerm ${soTerm} --bioperlTreeOutput @@dataDir@@/bioperlTree.out--validationLog @@dataDir@@/validation.log --postprocessingDirective SET_TRANSCRIPT_IDS --postprocessingDir @@dataDir@@/final/</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="embl_organelle_genome" category="genome" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="soTerm">[mitochondrial_chromosome, apicoplast_chromosome] &soTerm;</prop>
    <prop name="mapFile"/>
    <prop name="organelle"/>

    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${soTerm}_${name}_RSRC"
              version="${version}"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
	      parentDatasetName="${organismAbbrev}_primary_genome_RSRC"
              scope="organism"
              type="organellar_genome"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${soTerm}_${name}_embl/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--extDbName %PARENT_DATASET_NAME% --extDbRlsVer %PARENT_DATASET_VERSION% --mapFile @@gusHome@@/lib/xml/isf/${mapFile} --inputFileOrDir @@dataDir@@/final/genome.embl --fileFormat embl --soExtDbSpec "SO_RSRC|%" --organism ${ncbiTaxonId} --seqSoTerm ${soTerm} --bioperlTreeOutput @@dataDir@@/bioperlTree.out--validationLog @@dataDir@@/validation.log --postprocessingDirective SET_TRANSCRIPT_IDS --postprocessingDir @@dataDir@@/final/</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="GeneDB_GFF_needMapFile_primary_genome_features" category="genome" datasetFileHint="">
    <purpose>Use a customized mapping file to load the primary annotation data from GeneDB.</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="version">&version;</prop>
    <prop name="mapFile">&isfMappingFile;</prop>
    <prop name="soTerm">[chromosome, supercontig, contig] &soTerm;</prop>
    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_primary_genome_features_RSRC"
              version="${version}"
	      parentDatasetName="${organismAbbrev}_primary_genome_RSRC"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              scope="organism"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/GeneDB_GFF/${version}/final/">
	<descriptionOfFinal>The final/ dir must contains three files: genome.gff, transcriptInfoAndIds and chromosomeMap.txt. The genome.gff is an output of processed GFF file. See the example dir for preprocess steps. The chromosomeMap.txt file is a tab delimited txt file with three columns: sequence ID, chromosome name, and chromosome order number.  This file should be empty unless the soTerm is 'chromosome'. The transcriptInfoAndIds is a file generated by ISF prerun and including all transcript info</descriptionOfFinal>
      </manualGet>

      <pluginArgs>--extDbName %PARENT_DATASET_NAME% --extDbRlsVer %PARENT_DATASET_VERSION% --mapFile @@gusHome@@/lib/xml/isf/${mapFile} --inputFileOrDir @@dataDir@@/final/genome.gff --inputFileExtension "gff"  --fileFormat gff3 --soExtDbSpec "SO_RSRC|%" --defaultOrganism ${ncbiTaxonId}  --seqSoTerm '${soTerm}' --validationLog @@dataDir@@/final/validation.log --bioperlTreeOutput @@dataDir@@/final/bioperlTree.out --seqIdColumn source_id --naSequenceSubclass ExternalNASequence --chromosomeMapFile @@dataDir@@/final/chromosomeMap.txt --postprocessingDirective SET_TRANSCRIPT_IDS --postprocessingDir @@dataDir@@/final/</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="GeneDB_GFF_needMapFile_secondary_genome_features" category="genome" datasetFileHint="">
    <purpose>Use a customized mapping file to load the complementary genome annotation data from GeneDB</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="version">&version;</prop>
    <prop name="mapFile">&isfMappingFile;</prop>
    <prop name="soTerm">[supercontig, contig, random_sequence] &soTerm;</prop>

    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${soTerm}_GeneDB_genome_features_RSRC"
              version="${version}"
	      parentDatasetName="${organismAbbrev}_primary_genome_RSRC"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              scope="organism"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${soTerm}_GeneDB_GFF/${version}/final/">
	<descriptionOfFinal>The final/ dir must contains two files: genome.gff and chromosomeMap.txt. The genome.gff is an output of precessed GFF file. See the example dir for preprocess steps. The chromosomeMap.txt file in this dir should be empty</descriptionOfFinal>
      </manualGet>

      <pluginArgs>--extDbName %PARENT_DATASET_NAME% --extDbRlsVer %PARENT_DATASET_VERSION% --mapFile @@gusHome@@/lib/xml/isf/${mapFile} --inputFileOrDir @@dataDir@@/final/genome.gff --inputFileExtension "gff"  --fileFormat gff3 --soExtDbSpec "SO_RSRC|%" --defaultOrganism ${ncbiTaxonId}  --seqSoTerm '${soTerm}' --validationLog @@dataDir@@/validation.log --bioperlTreeOutput @@dataDir@@/bioperlTree.out --seqIdColumn source_id --naSequenceSubclass ExternalNASequence --chromosomeMapFile @@dataDir@@/final/chromosomeMap.txt --postprocessingDirective SET_TRANSCRIPT_IDS --postprocessingDir @@dataDir@@/final/ </pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="GeneDB_GFF_primary_genome_features" category="genome" datasetFileHint="">
    <purpose>Load the primary annotation data from GeneDB.</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="version">&version;</prop>
    <prop name="soTerm">[chromosome, supercontig, contig] &soTerm;</prop>
    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_primary_genome_features_RSRC"
              version="${version}"
	      parentDatasetName="${organismAbbrev}_primary_genome_RSRC"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              scope="organism"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/GeneDB_GFF/${version}/final/">
	<descriptionOfFinal>The final/ dir must contains two files: genome.gff and chromosomeMap.txt. The genome.gff is an output of processed GFF file. See the example dir for preprocess steps. The chromosomeMap.txt file is a tab delimited txt file with three columns: sequence ID, chromosome name, and chromosome order number.  This file should be empty unless the soTerm is 'chromosome'</descriptionOfFinal>
        <example dir="GeneDB_GFF_primary_genome_features"></example>
      </manualGet>

      <pluginArgs>--extDbName %PARENT_DATASET_NAME% --extDbRlsVer %PARENT_DATASET_VERSION% --mapFile @@gusHome@@/lib/xml/isf/geneDBGFF2Gus.xml --inputFileOrDir @@dataDir@@/final/genome.gff --inputFileExtension "gff"  --fileFormat gff3 --soExtDbSpec "SO_RSRC|%" --defaultOrganism ${ncbiTaxonId}  --seqSoTerm '${soTerm}' --validationLog @@dataDir@@/final/validation.log --bioperlTreeOutput @@dataDir@@/final/bioperlTree.out --seqIdColumn source_id --naSequenceSubclass ExternalNASequence --chromosomeMapFile @@dataDir@@/../${organismAbbrev}_primary_genome_RSRC/final/chromosomeMap.txt --postprocessingDirective SET_TRANSCRIPT_IDS --postprocessingDir @@dataDir@@/final/</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="GeneDB_GFF_secondary_genome_features" category="genome" datasetFileHint="">
    <purpose>Load the complementary genome annotation data from GeneDB</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="version">&version;</prop>
    <prop name="soTerm">[supercontig, contig, random_sequence] &soTerm;</prop>

    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${soTerm}_GeneDB_genome_features_RSRC"
              version="${version}"
	      parentDatasetName="${organismAbbrev}_primary_genome_RSRC"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              scope="organism"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${soTerm}_GeneDB_GFF/${version}/final/">
	<descriptionOfFinal>The final/ dir must contains two files: genome.gff and chromosomeMap.txt. The genome.gff is an output of precessed GFF file. See the example dir for preprocess steps. The chromosomeMap.txt file in this dir should be empty</descriptionOfFinal>
        <example dir="GeneDB_GFF_secondary_genome_features"></example>
      </manualGet>

      <pluginArgs>--extDbName %PARENT_DATASET_NAME% --extDbRlsVer %PARENT_DATASET_VERSION% --mapFile @@gusHome@@/lib/xml/isf/geneDBGFF2Gus.xml --inputFileOrDir @@dataDir@@/final/genome.gff --inputFileExtension "gff"  --fileFormat gff3 --soExtDbSpec "SO_RSRC|%" --defaultOrganism ${ncbiTaxonId}  --seqSoTerm '${soTerm}' --validationLog @@dataDir@@/validation.log --bioperlTreeOutput @@dataDir@@/bioperlTree.out --seqIdColumn source_id --naSequenceSubclass ExternalNASequence --chromosomeMapFile @@dataDir@@/../${organismAbbrev}_${soTerm}_RSRC/final/chromosomeMap.txt --postprocessingDirective SET_TRANSCRIPT_IDS --postprocessingDir @@dataDir@@/final/ </pluginArgs>
    </datasetLoader>
  </datasetClass>

  <!-- must be used in conjunction w/ fasta_organelle_genome with name="GeneDB" -->
  <datasetClass class="GeneDB_GFF_organelle_genome_features" category="genome" datasetFileHint="">
    <purpose>Load the non-nuclear genome annotation data from GeneDB, including mitochondrial and apicoplast.</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="version">&version;</prop>
    <prop name="soTerm">[mitochondrial_chromosome, apicoplast_chromosome] &soTerm;</prop>

    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${soTerm}_GeneDB_features_RSRC"
              version="${version}"
	      parentDatasetName="${organismAbbrev}_primary_genome_RSRC"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              scope="organism"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${soTerm}_GeneDB_GFF/${version}/final/">
	<descriptionOfFinal>The final/ dir contain one file, genome.gff. The genome.gff is an output of precessed GFF file. See the example dir for preprocess steps.</descriptionOfFinal>
        <example dir="GeneDB_GFF_organelle_genome_features"></example>
      </manualGet>

      <pluginArgs>--extDbName %PARENT_DATASET_NAME% --extDbRlsVer %PARENT_DATASET_VERSION% --mapFile @@gusHome@@/lib/xml/isf/geneDBGFF2Gus.xml --inputFileOrDir @@dataDir@@/final/genome.gff --inputFileExtension "gff"  --fileFormat gff3 --soExtDbSpec "SO_RSRC|%" --defaultOrganism ${ncbiTaxonId}  --seqSoTerm '${soTerm}' --validationLog @@dataDir@@/final/validation.log --bioperlTreeOutput @@dataDir@@/final/bioperlTree.out --seqIdColumn source_id --naSequenceSubclass ExternalNASequence --postprocessingDirective SET_TRANSCRIPT_IDS --postprocessingDir @@dataDir@@/final/ </pluginArgs>
    </datasetLoader>
  </datasetClass>
  
    <datasetClass class="NoPreprocess_primary_genome_features" category="genome" datasetFileHint="">
    <purpose>Load the primary annotation data in GFF3 format. And There are no unpack steps for preprocessing GFF3 files inside the dataset class. The required preprocessing steps for GFF3 files have been done in manual delivery directory.</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="version">&version;</prop>
    <prop name="soTerm">[chromosome, supercontig, contig] &soTerm;</prop>
    <prop name="source">The source where the annotation file get from, such as GenBank, GeneDB, Broad, and etc.</prop>
    <prop name="mapFile">The map file used to load the annotation and used in the ISF testing, such as ApiCommonData/Load/lib/xml/isf/sangerGFF2Gus.xml</prop>

    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_primary_genome_features_RSRC"
              version="${version}"
	      parentDatasetName="${organismAbbrev}_primary_genome_RSRC"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              type="genome"
              scope="organism"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${soTerm}_${source}_gff3/${version}/final/">
	<descriptionOfFinal>The final/ dir must contains two files: genome.gff and chromosomeMap.txt. The genome.gff is an output of precessed GFF file. See the example dir for preprocessing steps. The chromosomeMap.txt file is a tab delimited txt file with three columns: sequence ID, chromosome name, and chromosome order number.  This file should be empty unless the soTerm is 'chromosome'</descriptionOfFinal>
        <example dir="NoPreprocess_primary_genome_features"></example>
      </manualGet>
 

      <pluginArgs>--extDbName %PARENT_DATASET_NAME% --extDbRlsVer %PARENT_DATASET_VERSION% --mapFile @@gusHome@@/lib/xml/isf/${mapFile} --inputFileOrDir @@dataDir@@/final/genome.gff --inputFileExtension "gff" --chromosomeMapFile @@dataDir@@/../${organismAbbrev}_primary_genome_RSRC/final/chromosomeMap.txt --fileFormat gff3 --soExtDbSpec "SO_RSRC|%" --defaultOrganism ${ncbiTaxonId} --seqSoTerm '${soTerm}' --validationLog @@dataDir@@/final/validation.log --bioperlTreeOutput @@dataDir@@/final/bioperltree.out --seqIdColumn source_id --naSequenceSubclass ExternalNASequence --postprocessingDirective SET_TRANSCRIPT_IDS --postprocessingDir @@dataDir@@/final/</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="NoPreprocess_secondary_genome_features" category="genome" datasetFileHint="">
    <purpose>Load the complementary genome annotation data in GFF3 format. This is a complementary class for NoPreprocess_primary_genome_features class. Same as the NoPreprocess_primary_genome_features class, there are no unpack steps for preprocessing GFF3 files inside the dataset class. All preprocessing steps for GFF3 file have been done in manual delivery directory. </purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="version">&version;</prop>
    <prop name="soTerm">[supercontig, contig, random_sequence] &soTerm;</prop>
    <prop name="name">The source where the annotation file get from, such as GenBank, GeneDB, Broad, and etc.</prop>
    <prop name="mapFile">The map file used to load the annotation and used in the ISF testing, such as ApiCommonData/Load/lib/xml/isf/sangerGFF2Gus.xml</prop>

    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${soTerm}_genome_features_RSRC"
              version="${version}"
              parentDatasetName="${organismAbbrev}_primary_genome_RSRC"
              plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              type="genome"
              scope="organism"
              organismAbbrev="${organismAbbrev}">

    <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${soTerm}_${name}_gff3/${version}/final/">
      <descriptionOfFinal>The final/ dir must contains two files: genome.gff and chromosomeMap.txt. The genome.gff is an output of precessed GFF file. See the example dir for preprocessing steps. The chromosomeMap.txt file in this dir should be empty</descriptionOfFinal>
        <example dir="NoPreprocess_secondary_genome_features"></example>
    </manualGet>

    <pluginArgs>--extDbName %PARENT_DATASET_NAME% --extDbRlsVer %PARENT_DATASET_VERSION% --mapFile @@gusHome@@/lib/xml/isf/${mapFile} --inputFileOrDir @@dataDir@@/final/genome.gff --inputFileExtension "gff" --chromosomeMapFile @@dataDir@@/../${organismAbbrev}_secondary_genome_RSRC/final/chromosomeMap.txt --fileFormat gff3 --soExtDbSpec "SO_RSRC|%" --defaultOrganism ${ncbiTaxonId} --seqSoTerm '${soTerm}' --validationLog @@dataDir@@/final/validation.log --bioperlTreeOutput @@dataDir@@/final/bioperlTree.out --seqIdColumn source_id --naSequenceSubclass ExternalNASequence --postprocessingDirective SET_TRANSCRIPT_IDS --postprocessingDir @@dataDir@@/final/</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="NoPreprocess_organelle_genome_features" category="genome" datasetFileHint="">
    <purpose>Load the organelle genome annotation data in GFF3 format. Same as the NoPreprocess_primary_genome_features class, there are no unpack steps for preprocessing GFF3 files inside the dataset class. All preprocessing steps for GFF3 file have been done in manual delivery directory. </purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="version">&version;</prop>
    <prop name="soTerm">[mitochondrial_chromosome, apicoplast_chromosome] &soTerm;</prop>
    <prop name="name">The source where the annotation file get from, such as GenBank, GeneDB, Broad, and etc.</prop>
    <prop name="mapFile">The map file used to load the annotation and used in the ISF testing, such as ApiCommonData/Load/lib/xml/isf/sangerGFF2Gus.xml</prop>

    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${soTerm}_${name}_features_RSRC"
              version="${version}"
	      parentDatasetName="${organismAbbrev}_primary_genome_RSRC"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              scope="organism"
              type="organellar_genome"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${soTerm}_${name}_gff3/${version}/final/">
	<descriptionOfFinal>The final/ dir contain one file, genome.gff. The genome.gff is an output of precessed GFF file. See the example dir for preprocessing steps.</descriptionOfFinal>
        <example dir="NoPreprocess_organelle_genome_features"></example>
      </manualGet>

      <pluginArgs>--extDbName %PARENT_DATASET_NAME% --extDbRlsVer %PARENT_DATASET_VERSION% --mapFile @@gusHome@@/lib/xml/isf/${mapFile} --inputFileOrDir @@dataDir@@/final/genome.gff --inputFileExtension "gff" --fileFormat gff3 --soExtDbSpec "SO_RSRC|%" --defaultOrganism ${ncbiTaxonId} --seqSoTerm '${soTerm}' --validationLog @@dataDir@@/final/validation.log --bioperlTreeOutput @@dataDir@@/final/bioperlTree.out --seqIdColumn source_id --naSequenceSubclass ExternalNASequence --postprocessingDirective SET_TRANSCRIPT_IDS --postprocessingDir @@dataDir@@/final/</pluginArgs>
    </datasetLoader>
  </datasetClass>
  
<!-- FungiDB datasets: deprecated 2013-07-17 in favor of NoPreprocess_primary_genome_features and doing the processing to .gff manually. -->
  <datasetClass class="GTF_primary_genome_features" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="version">&version;</prop>
    <prop name="soTerm">[chromosome, supercontig, contig] &soTerm;</prop>
    <prop name="idPrefix"/>
    <prop name="source"/>

    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_primary_genome_features_RSRC"
              version="${version}"
	      parentDatasetName="${organismAbbrev}_primary_genome_RSRC"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              type="genome"
              scope="organism"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${soTerm}_${source}_gff3/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>

      <unpack>gtf2gff3_3level -p ${idPrefix} @@dataDir@@/final/genome.gtf > @@dataDir@@/final/genome.gff3</unpack>

      <unpack>preprocessGFF3 --input_gff @@dataDir@@/final/genome.gff3 --output_gff @@dataDir@@/final/genome.gff</unpack>    

      <pluginArgs>--extDbName %PARENT_DATASET_NAME% --extDbRlsVer %PARENT_DATASET_VERSION% --mapFile @@gusHome@@/lib/xml/isf/genericGFF2Gus.xml --inputFileOrDir @@dataDir@@/final/genome.gff --inputFileExtension "gff"  --fileFormat gff3 --soExtDbSpec "SO_RSRC|%" --defaultOrganism ${ncbiTaxonId}  --seqSoTerm '${soTerm}' --validationLog @@dataDir@@/final/validation.log --bioperlTreeOutput @@dataDir@@/final/bioperlTree.out --seqIdColumn source_id --naSequenceSubclass ExternalNASequence --postprocessingDirective SET_TRANSCRIPT_IDS --postprocessingDir @@dataDir@@/final/</pluginArgs>
    </datasetLoader>
  </datasetClass>
  
    <datasetClass class="GFF_primary_genome_features" category="genome" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="version">&version;</prop>
    <prop name="soTerm">[chromosome, supercontig, contig] &soTerm;</prop>
    <prop name="source"/>
    <prop name="mapFile"/>

    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_primary_genome_features_RSRC"
              version="${version}"
	      parentDatasetName="${organismAbbrev}_primary_genome_RSRC"
              type="genome"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              scope="organism"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${soTerm}_${source}_gff3/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>

      <unpack>preprocessGFF3 --input_gff @@dataDir@@/final/genome.gff3 --output_gff @@dataDir@@/final/genome.gff</unpack>    

      <pluginArgs>--extDbName %PARENT_DATASET_NAME% --extDbRlsVer %PARENT_DATASET_VERSION% --mapFile @@gusHome@@/lib/xml/isf/${mapFile} --inputFileOrDir @@dataDir@@/final/genome.gff --inputFileExtension "gff" --chromosomeMapFile @@dataDir@@/../${organismAbbrev}_primary_genome_RSRC/final/chromosomeMap.txt --fileFormat gff3 --soExtDbSpec "SO_RSRC|%"  --defaultOrganism ${ncbiTaxonId}  --seqSoTerm '${soTerm}' --validationLog @@dataDir@@/final/validation.log --bioperlTreeOutput @@dataDir@@/final/bioperlTree.out --seqIdColumn source_id --naSequenceSubclass ExternalNASequence --postprocessingDirective SET_TRANSCRIPT_IDS --postprocessingDir @@dataDir@@/final/</pluginArgs>
    </datasetLoader>
  </datasetClass>
  
  <datasetClass class="Broad_GFF_primary_genome_features" category="genome" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="version">&version;</prop>
    <prop name="soTerm">[chromosome, supercontig, contig] &soTerm;</prop>

    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_primary_genome_features_RSRC"
              version="${version}"
	      parentDatasetName="${organismAbbrev}_primary_genome_RSRC"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              scope="organism"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${soTerm}_Broad_gff3/${version}/final/genome.gtf">
        <dir name="final">
        </dir>
      </manualGet>

      <unpack>convertGTFToGFF3 @@dataDir@@/genome.gtf > @@dataDir@@/genome.gff3</unpack>

      <unpack>preprocessGFF3 --input_gff @@dataDir@@/genome.gff3 --output_gff @@dataDir@@/genome.gff</unpack>    

      <pluginArgs>--extDbName %PARENT_DATASET_NAME% --extDbRlsVer %PARENT_DATASET_VERSION% --mapFile @@gusHome@@/lib/xml/isf/broadGFF32Gus.xml --inputFileOrDir @@dataDir@@/genome.gff --inputFileExtension "gff"  --fileFormat gff3 --soExtDbSpec "SO_RSRC|%" --defaultOrganism ${ncbiTaxonId}  --seqSoTerm '${soTerm}' --validationLog @@dataDir@@/validation.log --bioperlTreeOutput @@dataDir@@/bioperlTree.out --seqIdColumn source_id --naSequenceSubclass ExternalNASequence --chromosomeMapFile @@dataDir@@/../${organismAbbrev}_primary_genome_RSRC/final/chromosomeMap.txt</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="NoPreprocess_GTF_primary_genome_features" category="genome" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="version">&version;</prop>
    <prop name="soTerm">[chromosome, supercontig, contig] &soTerm;</prop>

    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_primary_genome_features_RSRC"
              version="${version}"
	      parentDatasetName="${organismAbbrev}_primary_genome_RSRC"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              scope="organism"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${soTerm}_Broad_gff3/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>

      <unpack>convertGTFToGFF3 @@dataDir@@/final/genome.gtf > @@dataDir@@/final/genome.gff3</unpack>

      <unpack>preprocessGFF3 --input_gff @@dataDir@@/final/genome.gff3 --output_gff @@dataDir@@/final/genome.gff</unpack>    

      <pluginArgs>--extDbName %PARENT_DATASET_NAME% --extDbRlsVer %PARENT_DATASET_VERSION% --mapFile @@gusHome@@/lib/xml/isf/broadGFF32Gus.xml --inputFileOrDir @@dataDir@@/final/genome.gff --inputFileExtension "gff"  --fileFormat gff3 --soExtDbSpec "SO_RSRC|%" --defaultOrganism ${ncbiTaxonId}  --seqSoTerm '${soTerm}' --validationLog @@dataDir@@/final/validation.log --bioperlTreeOutput @@dataDir@@/final/bioperlTree.out --seqIdColumn source_id --naSequenceSubclass ExternalNASequence --chromosomeMapFile @@dataDir@@/../${organismAbbrev}_primary_genome_RSRC/final/chromosomeMap.txt --postprocessingDirective SET_TRANSCRIPT_IDS --postprocessingDir @@dataDir@@/final/</pluginArgs>
    </datasetLoader>
  </datasetClass>

<!-- chromosomeMap.txt file with 3 tab delimited columns, source_id,chromosome,chromosome_order_number, must be in final dir for chromosomes -->
  <datasetClass class="fasta_primary_genome_sequence" category="" datasetFileHint="organism">
    <purpose>Load the primary fasta genome sequence</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="table">Ignore this property. It should be removed from the dataset class. You can leave it blank.</prop>
    <prop name="soTerm">[chromosome, supercontig, contig] &soTerm;</prop>
    <prop name="sourceIdRegex">&sourceIdRegex;</prop>
    <prop name="releaseDate">version of the data, in date format 2012-11-29</prop>
 
    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <qaNotes></qaNotes>

    <datasetLoader datasetName="${organismAbbrev}_primary_genome_RSRC" version="${version}"
	      plugin="GUS::Supported::Plugin::LoadFastaSequences"
              scope="organism"
              type="genome"
              organismAbbrev="${organismAbbrev}"
              releaseDate="${releaseDate}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${soTerm}_${name}_fasta/${version}/final/">
        <descriptionOfFinal>The primary genome data should go in this dir. The final/ dir must contain two files: genome.fasta and chromosomeMap.txt.  The definition lines in the fasta file must contain the unique stable public ID for the sequence. And the public ID can be retrieved by the property sourceIdRegex. And the ID will be shown up on the website. The chromosomeMap.txt file is tab delimited with three columns: sequence ID, chromosome name, chromosome order number.  This file should be empty unless the soTerm is 'chromosome'</descriptionOfFinal> 
        <example dir="fasta_primary_genome_sequence.1"></example>
      </manualGet>

      <pluginArgs>--externalDatabaseName %DATASET_NAME% --externalDatabaseVersion %DATASET_VERSION% --ncbiTaxId ${ncbiTaxonId} --sequenceFile @@dataDir@@/final/genome.fasta --chromosomeMapFile @@dataDir@@/final/chromosomeMap.txt --soTermName ${soTerm} --SOExtDbRlsSpec 'SO_RSRC|%' --regexSourceId "${sourceIdRegex}" --tableName "DoTS::ExternalNASequence"</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="fasta_organelle_genome" category="genome" datasetFileHint="">
    <purpose>Load the non-nuclear fasta genome sequence including mitochondrial and apicoplast</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="table">Ignore this property. It should be removed from the dataset class. You can leave it blank.</prop>
    <prop name="soTerm">[mitochondrial_chromosome, apicoplast_chromosome] &soTerm;</prop>
    <prop name="sourceIdRegex">&sourceIdRegex;</prop>
    <prop name="organelle"/>

    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${soTerm}_${name}_RSRC" version="${version}"
	      plugin="GUS::Supported::Plugin::LoadFastaSequences"
	      parentDatasetName="${organismAbbrev}_primary_genome_RSRC"
              scope="organism"
              type="organellar_genome"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${soTerm}_${name}_fasta/${version}/final/genome.fasta">
	<descriptionOfFinal>The non-nuclear genome data including mitochondrial and apicoplast should go in this dir. The final/ dir must contain one file, genome.fasta.  The definition lines in the fasta file must contain the unique stable public ID for the sequence. And the public ID can be retrieved by the property sourceIdRegex. And the ID will be shown up on the website.</descriptionOfFinal> 
        <example dir="fasta_organelle_genome_sequence"></example>
      </manualGet>

      <pluginArgs>--externalDatabaseName %PARENT_DATASET_NAME% --externalDatabaseVersion %PARENT_DATASET_VERSION% --ncbiTaxId ${ncbiTaxonId} --sequenceFile @@dataDir@@/genome.fasta --soTermName ${soTerm} --regexSourceId "${sourceIdRegex}" --tableName "${table}" --SOExtDbRlsSpec 'SO_RSRC|%'</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="fasta_secondary_genome" category="genome" datasetFileHint="">
    <purpose>Load the complementary fasta genome sequence</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="table">Ignore this property. It should be removed from the dataset class. You can leave it blank.</prop>
    <prop name="soTerm">[supercontig, contig, random_sequence] &soTerm;</prop>
    <prop name="sourceIdRegex">&sourceIdRegex;</prop>

    <graphTemplateFile name="genomeSequenceAndFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${soTerm}_${name}_RSRC" version="${version}"
	      plugin="GUS::Supported::Plugin::LoadFastaSequences"
              parentDatasetName="${organismAbbrev}_primary_genome_RSRC"
              scope="organism"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${soTerm}_${name}_fasta/${version}/final/">
	<descriptionOfFinal>A complementary genome data should go in this dir. The final/ dir must contain two files: genome.fasta and chromosomeMap.txt.  The definition lines in the fasta file must contain the unique stable public ID for the sequence. And the public ID can be retrieved by the property sourceIdRegex. And the ID will be shown up on the website. This chromosomeMap.txt file should be empty here.</descriptionOfFinal> 
        <example dir="fasta_secondary_genome_sequence"></example>
      </manualGet>

      <pluginArgs>--externalDatabaseName %PARENT_DATASET_NAME% --externalDatabaseVersion %PARENT_DATASET_VERSION% --ncbiTaxId ${ncbiTaxonId} --sequenceFile @@dataDir@@/final/genome.fasta --chromosomeMapFile @@dataDir@@/final/chromosomeMap.txt --soTermName ${soTerm} --regexSourceId "${sourceIdRegex}" --tableName "${table}" --SOExtDbRlsSpec 'SO_RSRC|%'</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="primaryVirtualGenome" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="version">&version;</prop>
    <prop name="virtualSeqSOTerm"/>
    <prop name="sourceIdPrefix"/>  <!-- optional.  add this prefix to the source ID. put "" in if the value is null -->
    <prop name="genomeVersion"/>

    <graphTemplateFile name="primaryVirtualGenome.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${virtualSeqSOTerm}_primary_virtual_genome_RSRC"
              version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertVirtualSeqFromAgpFile"
              scope="organism"
              type="genome"
              organismAbbrev="${organismAbbrev}">
      
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${virtualSeqSOTerm}_assembly_agp/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--agpFile @@dataDir@@/final/assembly.agp --seqPieceExtDbName ${organismAbbrev}_primary_genome_RSRC --seqPieceExtDbRlsVer ${genomeVersion} --virSeqExtDbName %DATASET_NAME% --virSeqExtDbRlsVer %DATASET_VERSION% --virtualSeqSOTerm ${virtualSeqSOTerm}  --ncbiTaxId ${ncbiTaxonId} --soExtDbRlsName "SO_RSRC"  --sourceIdPrefix "${sourceIdPrefix}" --chromosomeOrderMappingFile @@dataDir@@/final/chromosomeMap.txt</pluginArgs>
    </datasetLoader>
  </datasetClass>

<!--This is a variation on the original class primaryVirtualGenome. This class results in the passing and use of a new argument that allows splitting a genome piece for use in more than one virtual sequence. -->
  <datasetClass class="primaryVirtualGenomeAllowSplits" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="version">&version;</prop>
    <prop name="virtualSeqSOTerm"/>
    <prop name="sourceIdPrefix"/>  <!-- optional.  add this prefix to the source ID. put "" in if the value is null -->
    <prop name="genomeVersion"/>

    <graphTemplateFile name="primaryVirtualGenome.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${virtualSeqSOTerm}_primary_virtual_genome_RSRC"
              version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertVirtualSeqFromAgpFile"
              scope="organism"
              type="genome"
              organismAbbrev="${organismAbbrev}">
      
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${virtualSeqSOTerm}_assembly_agp/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--agpFile @@dataDir@@/final/assembly.agp --seqPieceExtDbName ${organismAbbrev}_primary_genome_RSRC --seqPieceExtDbRlsVer ${genomeVersion} --virSeqExtDbName %DATASET_NAME% --virSeqExtDbRlsVer %DATASET_VERSION% --virtualSeqSOTerm ${virtualSeqSOTerm}  --ncbiTaxId ${ncbiTaxonId} --soExtDbRlsName "SO_RSRC"  --sourceIdPrefix "${sourceIdPrefix}" --chromosomeOrderMappingFile @@dataDir@@/final/chromosomeMap.txt --allowSplits</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="secondaryVirtualGenome" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="version">&version;</prop>
    <prop name="virtualSeqSOTerm"/>
    <prop name="sourceIdPrefix"/>  <!-- optional.  add this prefix to the source ID. put "" in if the value is null -->
    <prop name="genomeVersion"/>

    <graphTemplateFile name="primaryVirtualGenome.xml"/>
    <datasetLoader datasetName="${organismAbbrev}_${virtualSeqSOTerm}_secondary_virtual_genome_RSRC"
              version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertVirtualSeqFromAgpFile"
              scope="organism"
              type="genome"
              organismAbbrev="${organismAbbrev}">
      
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${virtualSeqSOTerm}_assembly_agp/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--agpFile @@dataDir@@/final/assembly.agp --seqPieceExtDbName ${organismAbbrev}_primary_virtual_genome_RSRC --seqPieceExtDbRlsVer ${genomeVersion} --virSeqExtDbName %DATASET_NAME% --virSeqExtDbRlsVer  %DATASET_VERSION% --virtualSeqSOTerm ${virtualSeqSOTerm}  --ncbiTaxId ${ncbiTaxonId} --soExtDbRlsName "SO_RSRC"  --sourceIdPrefix "${sourceIdPrefix}" --chromosomeOrderMappingFile @@dataDir@@/final/chromosomeMap.txt</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="insertAGPPiece" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="version">&version;</prop>
    <prop name="assembledLevel"/>
    <graphTemplateFile name="organismSpecificOnTopLevelGenome.xml"/> 
    
    <datasetLoader datasetName="${organismAbbrev}_${assembledLevel}_AGP_Piece_RSRC"
              version="${version}"
          plugin="ApiCommonData::Load::Plugin::InsertAGPPiece"
              scope="organism"
              type="genome"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genome/${assembledLevel}_assembly_agp/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>                        
      <pluginArgs>--agpFile @@dataDir@@/final/assembly.agp --AGPPieceExtDbName %DATASET_NAME% --AGPPieceExtDbRlsVer %DATASET_VERSION%</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <!-- Category: genomeFeature -->
  <!-- NOTE: THIS CLASS IS NOT TO BE USED FOR THE PRIMARY ANNOTATION -->
  <datasetClass class="unofficialGeneFeatures_GFF2" category="" datasetFileHint="">
    <purpose>Gene features that are not provided by the annotation center</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="mapFile"/>
    <prop name="gff2GroupTag"/>
    <prop name="genomeVersion"/>


    <graphTemplateFile name="unofficialGeneFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_unofficialGeneFeature_${name}_GFF2_RSRC"
              version="${version}"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              scope="organism"
              type="feature"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genomeFeature/${name}_GFF/${version}/final/features.gff">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--extDbName %DATASET_NAME% --extDbRlsVer %DATASET_VERSION% --seqExtDbName ${organismAbbrev}_primary_genome_RSRC --seqExtDbRlsVer ${genomeVersion} --mapFile @@gusHome@@/lib/xml/isf/${mapFile} --inputFileOrDir @@dataDir@@/features.gff --fileFormat gff2  --gff2GroupTag "${gff2GroupTag}" --soExtDbSpec "SO_RSRC|%" --defaultOrganism ${ncbiTaxonId} --naSequenceSubclass ExternalNASequence --seqIdColumn source_id  --bioperlTreeOutput @@dataDir@@/bioperlTree.out --validationLog @@dataDir@@/validation.log --notOfficialAnnotation --postprocessingDirective SET_TRANSCRIPT_IDS --postprocessingDir @@dataDir@@/</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="unofficialGeneFeatures_GFF3" category="" datasetFileHint="">
    <purpose>Gene features that are not provided by the annotation center</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="mapFile"/>
    <prop name="genomeVersion"/>


    <graphTemplateFile name="unofficialGeneFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_unofficialGeneFeature_${name}_GFF3_RSRC"
              version="${version}"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              scope="organism"
              type="feature"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genomeFeature/${name}_GFF/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--extDbName %DATASET_NAME% --extDbRlsVer %DATASET_VERSION% --seqExtDbName ${organismAbbrev}_primary_genome_RSRC --seqExtDbRlsVer ${genomeVersion} --mapFile @@gusHome@@/lib/xml/isf/${mapFile} --inputFileOrDir @@dataDir@@/final/features.gff --fileFormat gff3 --soExtDbSpec "SO_RSRC|%" --defaultOrganism ${ncbiTaxonId} --naSequenceSubclass ExternalNASequence --seqIdColumn source_id  --bioperlTreeOutput @@dataDir@@/final/bioperlTree.out --validationLog @@dataDir@@/final/validation.log --notOfficialAnnotation --postprocessingDirective SET_TRANSCRIPT_IDS --postprocessingDir @@dataDir@@/final/</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="unofficialGeneFeatures_embl" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="mapFile"/>
    <prop name="genomeVersion"/>


    <graphTemplateFile name="unofficialGeneFeatures.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_unofficialGeneFeature_${name}_embl_RSRC"
              version="${version}"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              scope="organism"
              type="feature"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genomeFeature/${name}_embl/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--extDbName %DATASET_NAME% --extDbRlsVer %DATASET_VERSION% --seqExtDbName ${organismAbbrev}_primary_genome_RSRC --seqExtDbRlsVer ${genomeVersion} --mapFile @@gusHome@@/lib/xml/isf/${mapFile} --inputFileOrDir @@dataDir@@/final --inputFileExtension "embl" --fileFormat embl --soExtDbSpec "SO_RSRC|%" --defaultOrganism ${ncbiTaxonId} --naSequenceSubclass ExternalNASequence --seqIdColumn source_id  --bioperlTreeOutput @@dataDir@@/bioperlTree.out --validationLog @@dataDir@@/validation.log --notOfficialAnnotation</pluginArgs>  
    </datasetLoader>
  </datasetClass>



  <!-- Category: genomeFeature -->
  <!-- NOTE: THIS CLASS IS NOT TO BE USED FOR GENES -->
  <datasetClass class="genomeFeatures_GFF2" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="mapFile"/>
    <prop name="gff2GroupTag"/>
    <prop name="genomeVersion"/>


    <graphTemplateFile name="organismSpecificMiscNoAlias.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_genomeFeature_${name}_GFF2_RSRC"
              version="${version}"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              scope="organism"
              type="feature"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genomeFeature/${name}_GFF/${version}/final/features.gff">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--extDbName %DATASET_NAME% --extDbRlsVer %DATASET_VERSION% --seqExtDbName ${organismAbbrev}_primary_genome_RSRC --seqExtDbRlsVer ${genomeVersion} --mapFile @@gusHome@@/lib/xml/isf/${mapFile} --inputFileOrDir @@dataDir@@/features.gff --fileFormat gff2  --gff2GroupTag "${gff2GroupTag}" --soExtDbSpec "SO_RSRC|%" --defaultOrganism ${ncbiTaxonId} --naSequenceSubclass ExternalNASequence --seqIdColumn source_id  --bioperlTreeOutput @@dataDir@@/bioperlTree.out</pluginArgs>
    </datasetLoader>
  </datasetClass>


<!-- Category: genomeFeature -->
  <!-- NOTE: THIS CLASS IS FOR FEATURES THAT ARE ON THE VIRTUAL SEQS -->
  <datasetClass class="virtualSeq_GFF2" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName"/>
    <prop name="organismAbbrev"/>
    <prop name="ncbiTaxonId"/>
    <prop name="name"/>
    <prop name="version"/>
    <prop name="mapFile"/>
    <prop name="gff2GroupTag"/>
    <prop name="virtualGenomeName"/>
    <prop name="virtualGenomeVersion"/>

    <graphTemplateFile name="organismSpecificMiscNoAlias.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_virtualSeq_${name}_GFF2_RSRC"
              version="${version}"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              scope="organism"
              type="feature"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genomeFeature/${name}_GFF/${version}/final/features.gff">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--extDbName %DATASET_NAME% --extDbRlsVer %DATASET_VERSION% --seqExtDbName ${virtualGenomeName} --seqExtDbRlsVer ${virtualGenomeVersion} --mapFile @@gusHome@@/lib/xml/isf/${mapFile} --inputFileOrDir @@dataDir@@/features.gff --fileFormat gff2  --gff2GroupTag "${gff2GroupTag}" --soExtDbSpec "SO_RSRC|%" --defaultOrganism ${ncbiTaxonId} --naSequenceSubclass VirtualSequence --seqIdColumn source_id  --bioperlTreeOutput @@dataDir@@/bioperlTree.out</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <!-- Category: genomeFeature -->
  <datasetClass class="genomeFeatures_GFF3" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="mapFile"/>
    <prop name="genomeVersion"/>


    <graphTemplateFile name="organismSpecificMiscNoAlias.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_genomeFeature_${name}_GFF3_RSRC"
              version="${version}"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              scope="organism"
              type="feature"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genomeFeature/${name}_GFF/${version}/final/features.gff">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--extDbName %DATASET_NAME% --extDbRlsVer %DATASET_VERSION% --seqExtDbName ${organismAbbrev}_primary_genome_RSRC --seqExtDbRlsVer ${genomeVersion} --mapFile @@gusHome@@/lib/xml/isf/${mapFile} --inputFileOrDir @@dataDir@@/features.gff --fileFormat gff3 --soExtDbSpec "SO_RSRC|%" --defaultOrganism ${ncbiTaxonId} --naSequenceSubclass ExternalNASequence --seqIdColumn source_id  --bioperlTreeOutput @@dataDir@@/bioperlTree.out</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="updateEviganSecondaryScore" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="organismSpecificMiscNoAlias.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_updateEviganSecondaryScore_RSRC"
              version="${version}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="feature"
              subType="alternate_gene_model"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

     <unpack>updateEviganSecondaryScore.pl --evigan_ext_db_rls_spec "${organismAbbrev}_genomeFeature_${name}_GFF2_RSRC|${version}"</unpack>
     <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>




  <datasetClass class="unidbComponentProject" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="workflowVersion"/>

    <graphTemplateFile name="unidb.xml"/>
    <datasetLoader datasetName="${projectName}_${workflowVersion}_UniDB_RSRC"
              version="${workflowVersion}"
	            plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="global"
              type=""
              subType=""
              organismAbbrev="">

      <manualGet fileOrDir="${projectName}/unidb/${workflowVersion}/final">
        <dir name="final">
        </dir>
      </manualGet>
      <getAndUnpackOutput file="@@dataDir@@/final/forceSkipDatasets" />
      <getAndUnpackOutput file="@@dataDir@@/final/forceLoadDatasets" />
     <pluginArgs></pluginArgs>
    </datasetLoader>
  </datasetClass>


  <!-- Category: ESTs -->

  <!-- NOTE: this dataset class only gets the sequences from a dbEST mirror database, it does not map
       them to the genome.  See transcriptsFromReferenceStrain
       ONLY INCLUDE IF A REFERENCE STRAIN
  -->

  <datasetClass class="referenceStrain-dbEST" category="" datasetFileHint="">
    <purpose>Gets the sequences from a dbEST mirror database and loads into your database instance.A less desirable alternative for dbEST ESTs is to get file(s) from NCBI dbEST in fasta format and use the class referenceStrain-ESTsFromFasta. Use these classes ONLY FOR REFERENCE STRAINS. This class does not map the ESTs to the genomes, use the class transcriptsFromReferenceStrain for each organism, including the reference strain, to map ESTs to the genome.</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="speciesNcbiTaxonId">&speciesNcbiTaxonId;</prop>

    <graphTemplateFile name="ESTs.xml"/>

    <qaNotes>Run query:select d.name, dr.version, count(*)  from dots.est e, dots.nasequence ns, sres.externaldatabase d, SRES.externaldatabaserelease dr
where e.na_sequence_id = ns.na_sequence_id and ns.external_database_release_id = dr.external_database_release_id and dr.external_database_id = d.external_database_id group by d.name,dr.version order by d.name; 
Compare to: The number of ESTs available by querying NCBI dbEST, http://www.ncbi.nlm.nih.gov/genbank/dbest/dbest_access </qaNotes>

    <datasetLoader datasetName="${organismAbbrev}_dbEST_RSRC" version="TODAY"
	      plugin="GUS::Supported::Plugin::dbEST"
              scope="species"
              type="EST"
              organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <unpack>getSubTaxa --ncbiTaxId ${speciesNcbiTaxonId} --outputFile @@dataDir@@/taxonIdFile --gusConfigFile @@workflowDataDir@@/${organismAbbrev}/${organismAbbrev}_gus.config</unpack>

      <unpack>createPropFile --file @@dataDir@@/dbestProp --propList "dbestLogin:@@dbestLogin@@,dbestPswd:@@dbestPswd@@"</unpack>

      <pluginArgs>--span 500 --taxonFile @@dataDir@@/taxonIdFile --extDbName %DATASET_NAME% --extDbRlsVer %DATASET_VERSION% --SOExtDbRlsSpec "SO_RSRC|%" --dbestLoginFile @@dataDir@@/dbestProp --dbestConnect "@@dbestConnect@@" --do_not_update</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <!-- NOTE: this dataset class only gets the sequences, it does not map
       them to the genome.  See transcriptsFromReferenceStrain
       ONLY INCLUDE IF A REFERENCE STRAIN
  -->

  <datasetClass class="referenceStrain-ESTsFromFasta" category="" datasetFileHint="">
    <purpose>Gets and loads ESTs from a fasta file in manual delivery. The defline contains the EST id.</purpose>
    
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="version">Required. The version number or date assigned to this data.</prop>
    <prop name="name">Required. Meaningful name given to the dataset indicating the source of the data, e.g. Watanabe_EstLibrary </prop>
    <prop name="sourceIdRegex">Required. A regular expression whose pattern matches a substring in the definition line allowing the EST id to be identified, e.g.>(\w+) </prop>
    <prop name="soTerm">Required. Appropriate sequence ontology term_name. Consult the database, sres.sequenceontology.term_name, e.g. transcript. See http://www.sequenceontology.org/ for sequence ontology information. </prop>
    <prop name="isPutativeFullLength">Required.true or false True:Computational techniques can be used to extend and refine EST sequences and produce predictions of full length transcript sequences. False:Unembellished EST sequences.</prop>
    <prop name="libraryVector">Not required.The cloning vector (plasmid, cosmid, phage, etc) used to create the EST library.</prop>
    <prop name="libraryStage">Not required. Developmental or life cycle stage of the organism from which the cloned RNA was derived. </prop>
    <prop name="libraryName">Not required.Name given to the library.</prop>
    <prop name="libraryDesc">Not required.Brief description of the library e.g. P. falciparum 3D7 parasites were cultured either in a candle jar (XPFn, XPF2n) or in the mixed gas consisting of 3% oxygen, 5% carbon dioxide and 92% nitrogen using blood type A erythrocytes and frozen human plasma.</prop>
    <prop name="contactName">Not required.Name of person who provided or created the library or who can answer questions about the library</prop>
    <prop name="contactAddress1">Not required.Address to use to contact above name. Often this is the institution or laboratory name. e.g. Seattle Biomedical Research Institute</prop>    
    <prop name="contactAddress2">Not required.Additional space for address. Often the street and city, etc. e.g. 307 Westlake Avenue N., Suite 500 Seattle, WA 98109-5219  </prop>

    <graphTemplateFile name="ESTs.xml"/>

    <qaNotes>Run query:select d.name, dr.version, count(*)  from dots.est e, dots.nasequence ns, sres.externaldatabase d, SRES.externaldatabaserelease dr
where e.na_sequence_id = ns.na_sequence_id and ns.external_database_release_id = dr.external_database_release_id and dr.external_database_id = d.external_database_id group by d.name,dr.version order by d.name; 
Compare to: the number of ESTs in the file corresponding to the specific dataset</qaNotes>

    <datasetLoader datasetName="${organismAbbrev}_EST_${name}_sequences_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::LoadEstsFromFastaFile"
              scope="species"
              type="EST"
              organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/EST/${name}/${version}/final/ests.fasta">
        <descriptionOfFinal>The final directory should contain the single data file named ests.fasta.</descriptionOfFinal>
        <example dir="referenceStrain-ESTsFromFasta"></example>
      </manualGet>
      <pluginArgs>--sourceIdRegex "${sourceIdRegex}" --fastaFile @@dataDir@@/ests.fasta --externalDatabaseName %DATASET_NAME% --externalDatabaseVer %DATASET_VERSION%  --SOTermName '${soTerm}' --SOExtDbRlsSpec 'SO_RSRC|%' --ncbiTaxId ${ncbiTaxonId} --libraryVector '${libraryVector}' --putativeFullLength ${isPutativeFullLength} --libraryStage '${libraryStage}' --libraryName '${libraryName}' --libraryDesc "${libraryDesc}" --contactName "${contactName}" --contactAddress1 "${contactAddress1}" --contactAddress2 "${contactAddress2}" </pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="referenceStrain-GenbankEST" category="" datasetFileHint="">
    <purpose>Gets the sequences from Genbank via Entrez API and loads them into your database instance. Only for reference strains. This class does not map the ESTs to the genomes, use the class transcriptsFromReferenceStrain for each organism, including the reference strain, to map ESTs to the genome.</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>

    <graphTemplateFile name="ESTs.xml"/>

    <qaNotes>Run script: auditESTsVersusGenbank --dbinstance [this instance] --organism &organismAbbrev;</qaNotes>

    <datasetLoader datasetName="${organismAbbrev}_GenbankEST_RSRC" version="TODAY"
	      plugin="ApiCommonData::Load::Plugin::LoadESTsFromGenbank"
              scope="species"
              type="EST"
              organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--extDbRlsSpec "%DATASET_NAME%|%DATASET_VERSION%" --SOExtDbRlsSpec "SO_RSRC|%" --ncbiTaxonId ${ncbiTaxonId}</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <!-- This class gets its data from ESTs and transcripts loaded by the
       reference strain.  It finds all of them in the database and maps them to
       our genome.  The reference strain DOES need to include an instance
       of this class so that its transcripts get mapped to its genome  -->

  <datasetClass class="transcriptsFromReferenceStrain" category="EST" datasetFileHint="">
    <purpose>This class gets its data from ESTs and transcripts loaded by the
       reference strain.  It finds all of them in the database and maps them to
       our genome.  The reference strain DOES need to include an instance
       of this class so that its transcripts get mapped to its genome</purpose>
    <prop name="referenceStrainOrganismAbbrev">&referenceStrainOrganismAbbrev;</prop>

    <graphTemplateFile name="mapTranscriptsToGenome.xml"/>
    <qaNotes>Run Query: select tn.name, count(*) from dots.blatalignment b, dots.nasequence ns,sres.taxonname tn, dots.est e where e.na_sequence_id = b.query_na_sequence_id and b.target_na_sequence_id = ns.na_sequence_id and b.target_taxon_id = tn.taxon_id and tn.name_class = 'scientific name' and b.is_best_alignment = 1 group by tn.name;
    Compare the number for the organism(s) of interest to the numbers obtained using the query:select d.name, dr.version, count(*)  from dots.est e, dots.nasequence ns, sres.externaldatabase d, SRES.externaldatabaserelease dr
where e.na_sequence_id = ns.na_sequence_id and ns.external_database_release_id = dr.external_database_release_id and dr.external_database_id = d.external_database_id group by d.name,dr.version order by d.name</qaNotes>
  </datasetClass>


  <!-- Category: IEDB epitopes -->

  <!--  get all the epitope sequences. Note this is only called from the GenomicsGlobal workflow
        and loads all epitope sequences
  -->
  <datasetClass class="all_epitope_sequences_IEDB" category="" datasetFileHint="">
    <purpose></purpose>

    <datasetLoader datasetName="all_epitopes_IEDB_RSRC"
                   version="TODAY"
                   plugin="GUS::Supported::Plugin::LoadFastaSequences"
                   scope="global"
                   type="epitope"
                   >

      <wgetArgs url="https://www.iedb.org/downloader.php?file_name=doc/iedb_export.zip">--tries=5 --no-directories --no-host-directories --output-document=@@dataDir@@/iedb_export.zip</wgetArgs>

      <unpack>mkdir -p @@dataDir@@/xml</unpack>
      <unpack>unzip -d @@dataDir@@/xml @@dataDir@@/iedb_export.zip</unpack>
      <unpack>rm @@dataDir@@/iedb_export.zip</unpack>

      <!-- Sanitize xml files and get them ready for processing
          1. remove illegal characters from the text content so we can successfully parse the xml files
          2. remove xmlns from references to make it easier to traverse the document with simple xpath expressions.
       -->
      <unpack><![CDATA[find @@dataDir@@/xml -type f -name '*.xml' | xargs xargs -p 2 sed -i -E -e "s/[\x01-\x08]|\x0b|\x0c|[\x0E-\x1F]//g" -e "s/<References(.*)>/<References>/g"]]></unpack>

      <!-- Process all xml files in the input directory and generate a fasta file containing
           unique epitopes from all organisms unfiltered
      -->
      <unpack>iedbMakeFastaFileFromXML --input_dir @@dataDir@@/xml --outputfile @@dataDir@@/iedb_unique_epitopes_all_organisms.fasta</unpack>

      <unpack>rm -rf @@dataDir@@/xml</unpack>

      <getAndUnpackOutput file="@@dataDir@@/iedb_unique_epitopes_all_organisms.fasta"/>

      <!-- sourceId|name|ncbiTaxId|accession -->
      <pluginArgs><![CDATA[--seqFileDir @@dataDir@@ --externalDatabaseName %DATASET_NAME% --externalDatabaseVersion %DATASET_VERSION% --soTermName "epitope" --SOExtDbRlsSpec 'SO_RSRC|%' --regexNcbiTaxId  ">[^|]*\|[^|]*\|([^|]*)" --regexSourceId ">(\d+)|" --tableName "DoTS::MotifAASequence" --logFrequency 100000 --regexDesc ">(.+)" ]]></pluginArgs>
    </datasetLoader>
  </datasetClass>

  <!--  get the epitope sequences and process into a fasta file. Do not load the sequences though.
        the mapping step will use this fasta file and only load the mappings into the org-specific database..
        (this class does not map epitopes. see epitopesFromReferenceStrain)
        ONLY INCLUDE IF A REFERENCE STRAIN
 -->
  <datasetClass class="referenceStrain-epitope_sequences_IEDB" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>

    <graphTemplateFile name="epitopes.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_epitope_IEDB_RSRC"
                   version="TODAY"
                   plugin="ApiCommonData::Load::Plugin::LoadNothing"
                   scope="species"
                   type="epitope"
                   organismAbbrev="${organismAbbrev}">

      <wgetArgs url="https://www.iedb.org/downloader.php?file_name=doc/iedb_export.zip">--tries=5 --no-directories --no-host-directories --output-document=@@dataDir@@/iedb_export.zip</wgetArgs>

      <unpack>mkdir -p @@dataDir@@/xml</unpack>
      <unpack>unzip -d @@dataDir@@/xml @@dataDir@@/iedb_export.zip</unpack>
      <unpack>rm @@dataDir@@/iedb_export.zip</unpack>

      <!-- Sanitize xml files and get them ready for processing
          1. remove all illegal characters from the text content so we can successfully parse the xml files
          2. remove xmlns from references to make it easier to search for tags using perl libxml.
       -->
      <unpack><![CDATA[find @@dataDir@@/xml -type f -name '*.xml' | xargs -p 2 sed -i -E -e "s/[\x01-\x08]|\x0b|\x0c|[\x0E-\x1F]//g" -e "s/<References(.*)>/<References>/g"]]></unpack>
      <!-- Process all xml files in the input directory and generate a fasta file containing
      -->>
      <unpack>iedbMakeFastaFileFromXML --input_dir @@dataDir@@/xml --outputfile @@dataDir@@/iedb_unique_epitopes_all_organisms.fasta</unpack>

      <unpack>rm -rf @@dataDir@@/xml</unpack>

      <getAndUnpackOutput file="@@dataDir@@/iedb_unique_epitopes_all_organisms.fasta"/>

      <pluginArgs></pluginArgs>
    </datasetLoader>
  </datasetClass>


  <!-- This class gets its data from Epitopes loaded by the
       reference strain.  It finds all of them in the database and maps them to
       our genome.  The reference strain DOES need to include an instance
       of this class so that its transcripts get mapped to its genome  -->

  <datasetClass class="epitopesFromReferenceStrain" category="epitope" datasetFileHint="">
    <purpose></purpose>
    <prop name="referenceStrainOrganismAbbrev">&referenceStrainOrganismAbbrev;</prop>

    <graphTemplateFile name="mapEpitopes.xml"/>

  </datasetClass>

  <datasetClass class="rRNAReference" category="" datasetFileHint="">
    <purpose>Assign OTUs to experimental rRNA sequences</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="microbiomeRoot.xml"/>

    <datasetLoader datasetName="rRNAReference_RSRC"
	      version="${version}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="global"
              type="sres"
             >

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>
      <unpack> mkdir -pv @@dataDir@@ </unpack>
      <unpack> cp @@manualDeliveryDir@@/${projectName}/common/rRNAReference/${name}/${version}/final/training_set.${version}.fa.gz @@dataDir@@/trainingSet.fa.gz </unpack>
      <unpack> cp @@manualDeliveryDir@@/${projectName}/common/rRNAReference/${name}/${version}/final/species_assignment.${version}.fa.gz @@dataDir@@/speciesAssignment.fa.gz </unpack>

      <pluginArgs></pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="EukMarkersReference" category="" datasetFileHint="">
    <purpose>Reference to align WGS reads against</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="microbiomeRoot.xml"/>

    <datasetLoader datasetName="EukMarkersReference_RSRC"
	      version="${version}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="global"
              type="sres"
             >

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>
      <unpack> mkdir -pv @@dataDir@@ </unpack>
      <unpack> cp @@manualDeliveryDir@@/${projectName}/common/EukMarkersReference/${name}/${version}/final/refdb.1.bt2 @@dataDir@@</unpack>
      <unpack> cp @@manualDeliveryDir@@/${projectName}/common/EukMarkersReference/${name}/${version}/final/refdb.2.bt2 @@dataDir@@</unpack>
      <unpack> cp @@manualDeliveryDir@@/${projectName}/common/EukMarkersReference/${name}/${version}/final/refdb.3.bt2 @@dataDir@@</unpack>
      <unpack> cp @@manualDeliveryDir@@/${projectName}/common/EukMarkersReference/${name}/${version}/final/refdb.4.bt2 @@dataDir@@</unpack>
      <unpack> cp @@manualDeliveryDir@@/${projectName}/common/EukMarkersReference/${name}/${version}/final/refdb.rev.1.bt2 @@dataDir@@</unpack>
      <unpack> cp @@manualDeliveryDir@@/${projectName}/common/EukMarkersReference/${name}/${version}/final/refdb.rev.2.bt2 @@dataDir@@</unpack>
      <unpack> cp @@manualDeliveryDir@@/${projectName}/common/EukMarkersReference/${name}/${version}/final/marker-to-taxon-id.tsv @@dataDir@@</unpack>
      <pluginArgs></pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="MicrobiomeStudy" category="" datasetFileHint="">
    <purpose>Copy the manual delivery files for a study. One study is what corresponds to one study card, one presenter, and one sheet of sample details on MicrobiomeDB - which can involve multiple analyses</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="name"/>
    <prop name="version"/>
    <prop name="samplesInfoFileName"/>
    <prop name="sampleToWgsFastqFileName"/>
    <prop name="runDADA2"/>
    <prop name="runWGS"/>

    <graphTemplateFile name="microbiomeRoot.xml"/>

    <datasetLoader datasetName="otuDADA2_${name}_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::LoadNothing"
              type="population_biology"
              scope="global"
            >
      <manualGet fileOrDir="${projectName}/common/MicrobiomeStudy/${name}/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>
      <unpack>mv @@dataDir@@/final @@dataDir@@/staging </unpack>
      <unpack>if [ $( find -L @@manualDeliveryDir@@/${projectName}/common/MicrobiomeStudy/${name}/${version}/final/ | wc -l ) -ne $( find -L @@dataDir@@/staging/ | wc -l ) ] ; then echo "Not all copied?"; exit 1; fi </unpack>
      <unpack>if test "${runDADA2}" = true ; then mkdir @@dataDir@@/DADA2_${name} ; fi </unpack>
      <unpack>if test "${runWGS}" = true ; then mkdir @@dataDir@@/Humann_${name} ; fi </unpack>
      <unpack>if test "${runWGS}" = true ; then mkdir @@dataDir@@/Eukdetect_${name} ; fi </unpack>
      <unpack>if test -d @@dataDir@@/staging/16s ; then mv @@dataDir@@/staging/16s/ @@dataDir@@/DADA2_${name}/fastqsFromManualDelivery/ ; elif test "${runDADA2}" = true ; then mv @@dataDir@@/staging/ @@dataDir@@/DADA2_${name}/fastqsFromManualDelivery/ ; mkdir @@dataDir@@/staging/; fi </unpack>
      <unpack>if test "${runDADA2}" = true ; then find @@dataDir@@/DADA2_${name}/fastqsFromManualDelivery -type f -not \( -name '*.fq.gz' -o -name '*.fq' -o -name '*.fastq.gz' -o -name '*.fastq' \) -delete  ; fi </unpack>
      <unpack>if test "${runDADA2}" = true ; then rmdir -v --ignore-fail-on-non-empty @@dataDir@@/DADA2_${name}/fastqsFromManualDelivery; fi</unpack>
      <unpack>if test "${samplesInfoFileName}" ; then cp @@manualDeliveryDir@@/${projectName}/common/MicrobiomeStudy/${name}/${version}/final/${samplesInfoFileName} @@dataDir@@/DADA2_${name}/${samplesInfoFileName} ; fi </unpack>
      <unpack>if test "${sraSampleAndRunIdsFileName}" ; then cp @@manualDeliveryDir@@/${projectName}/common/MicrobiomeStudy/${name}/${version}/final/${sraSampleAndRunIdsFileName} @@dataDir@@/DADA2_${name}/${sraSampleAndRunIdsFileName} ; fi </unpack>
      <unpack>if test "${sampleToWgsFastqFileName}" ; then cp @@dataDir@@/staging/${sampleToWgsFastqFileName} @@dataDir@@/Humann_${name}/${sampleToWgsFastqFileName} ; fi </unpack>
      <unpack>if test "${sampleToWgsFastqFileName}" ; then mv @@dataDir@@/staging/${sampleToWgsFastqFileName} @@dataDir@@/Eukdetect_${name}/${sampleToWgsFastqFileName} ; fi </unpack>

      <unpack>rmdir -v @@dataDir@@/staging</unpack>
      <pluginArgs></pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="MicrobiomeStudyEda" category="" datasetFileHint="">
    <purpose>Copy the ISA sheet and the result files for a study. Fail if the files are not right </purpose>
    <prop name="name"/>
    <prop name="version"/>
    <prop name="sampleDetailsDir"/>
    <prop name="name"/>

    <graphTemplateFile name="microbiomeRootEda.xml"/>

    <datasetLoader datasetName="MicrobiomeStudyEDA_${name}_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::LoadNothing"
              type="population_biology"
              scope="global"
            >
    <manualGet fileOrDir="common/empty"/>
      <unpack>ln -s @@manualDeliveryDir@@/${projectName}/common/MicrobiomeStudyEda/${name}/${version}/final @@dataDir@@/</unpack>
      <unpack>if test -e @@dataDir@@/final/owlOverride.csv ; then getEntityAttributesFromOwl.pl -x @@dataDir@@/final/owlOverride.csv > @@dataDir@@/owlAttributes.txt; fi</unpack>
      <pluginArgs></pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="MicrobiomeOwlEda" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="name">&name;</prop>

    <graphTemplateFile name="microbiomeRootEda.xml"/>

    <datasetLoader datasetName="OntologyTerm_${name}_RSRC" version="dontcare"
                   plugin="GUS::Supported::Plugin::InsertOntologyTermsAndRelationships"
                   scope="global"
                   type="sres"
                   >

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <unpack>mkdir -pv @@dataDir@@</unpack>
      <unpack>if test -f @@dataDir@@/${name}.owl ; then unlink @@dataDir@@/${name}.owl ; fi</unpack>
      <unpack>if test -f @@dataDir@@/${name}.eda.txt ; then unlink @@dataDir@@/${name}.eda.txt ; fi</unpack>
      <unpack>ln -sv @@gusHome@@/ontology/Microbiome/${name}.owl @@dataDir@@/${name}.owl</unpack>
      <unpack>getEntityAttributesFromOwl.pl @@gusHome@@/ontology/Microbiome/${name}.owl &gt; @@dataDir@@/${name}.eda.txt</unpack>
      <pluginArgs>--inFile  @@dataDir@@/${name}.owl --owlReader ApiCommonData::Load::OwlReader --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%' --relTypeExtDbRlsSpec 'Ontology_Relationship_Types_RSRC|%' --loadAnnotationProperties 1 </pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="CommonTermsOwlEda" category="" datasetFileHint="">
    <purpose></purpose>

    <graphTemplateFile name="microbiomeRootEda.xml"/>

    <datasetLoader datasetName="OntologyTerm_EuPathIsa_RSRC" version="dontcare"
                   plugin="GUS::Supported::Plugin::InsertOntologyTermsAndRelationships"
                   scope="global"
                   type="sres"
                   >

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--inFile @@gusHome@@/ontology/release/production/eupath_isa.owl --owlReader ApiCommonData::Load::OwlReader --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%' --relTypeExtDbRlsSpec 'Ontology_Relationship_Types_RSRC|%'</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="OnlineObiOwlEda" category="" datasetFileHint="">
    <purpose></purpose>

    <graphTemplateFile name="microbiomeRootEda.xml"/>

    <datasetLoader datasetName="OBO_Ontology_OBI_RSRC" version="dontcare"
                   plugin="GUS::Supported::Plugin::InsertOntologyTermsAndRelationships"
                   scope="global"
                   type="sres"
                   >
      <wgetArgs url="http://purl.obolibrary.org/obo/OBI.owl">--tries=5 --no-directories --no-host-directories --accept=@@dataDir@@/OBI.owl </wgetArgs>
      <pluginArgs>--inFile @@dataDir@@/OBI.owl --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%' --relTypeExtDbRlsSpec 'Ontology_Relationship_Types_RSRC|%'</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="BUSCO" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="buildNumber">which build number (eg 49)</prop>

    <graphTemplateFile name="organismSpecificMiscNoAlias.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_BUSCO_RSRC" version="dontcare"
                   plugin="ApiCommonData::Load::Plugin::InsertBUSCO"
                   scope="organism"
                   type=""
                   organismAbbrev="${organismAbbrev}"
                   >
      <wgetArgs url="ftp://ftp-private.ebi.ac.uk:/EBIout/build_${buildNumber}/busco_scores/${projectName}/${organismAbbrev}/">--cut-dirs 6 --no-host-directories  --recursive --no-parent --ftp-user @@ebiFtpUser@@ --ftp-password @@ebiFtpPassword@@</wgetArgs>
      <pluginArgs>--genomeFile @@dataDir@@/genome_busco_short_summary.txt --proteinFile @@dataDir@@/protein_busco_short_summary.txt --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%' --orgAbbrev ${organismAbbrev}</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="lineageTaxonLinkingTable" category="" datasetFileHint="">
    <purpose>Create a lineage taxon linking table after the taxonomy and the results are in the database</purpose>

    <graphTemplateFile name="microbiomeRoot.xml"/>
   
    <datasetLoader datasetName="LineageTaxonLinkingTable_RSRC" version="dontcare"
              plugin="ApiCommonData::Load::LineageTaxonLinkingTable"
              type="sres"
              scope="global"
            >
      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>
      <pluginArgs></pluginArgs>
    </datasetLoader>
  </datasetClass>

  <!-- Category: dbxrefs -->
  <datasetClass class="dbxref_simple" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="columnSpec"/>
    <prop name="target"/>  <!-- NASequence, AAFeature, NAFeature -->
    <prop name="url"/>  <!-- must use CDATA -->
    <prop name="urlUsesSecondaryId"/>  <!-- true or false -->
    <prop name="genomeVersion"/>
    <prop name="viewName"/>   <!-- GeneFeature,Transcript,TranslatedAAFeature,ExternalAASequence,TranslatedAASequence,ExternalNASequence,VirtualSequence -->

    <graphTemplateFile name="dbXRefs.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_dbxref_${name}_RSRC"
	      version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertDBxRefs"
              scope="organism"
              type="dbxref"
              externalDbIdUrlUseSecondaryId="${urlUsesSecondaryId}"
              organismAbbrev="${organismAbbrev}">

      <externalDbIdUrl><![CDATA[${url}]]></externalDbIdUrl>
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/dbxref/${name}/${version}/final/mapping.txt">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--DbRefMappingFile @@dataDir@@/mapping.txt --extDbName %DATASET_NAME% --extDbReleaseNumber %DATASET_VERSION% --columnSpec "${columnSpec}" --tableName DbRef${target} --viewName "${viewName}" --geneExternalDatabaseSpec '${organismAbbrev}_primary_genome_RSRC|${genomeVersion}' --organismAbbrev ${organismAbbrev}</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="dbxref_unity" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="url"/>   <!-- must use CDATA -->
    <prop name="genomeVersion"/>

    <graphTemplateFile name="dbXRefs.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_dbxref_unity_${name}_RSRC"
	      version="TODAY"
	      plugin="ApiCommonData::Load::Plugin::InsertDBxRefs"
              scope="organism"
              type="dbxref"
              externalDbIdUrlUseSecondaryId="false"
              organismAbbrev="${organismAbbrev}">

      <externalDbIdUrl><![CDATA[${url}]]></externalDbIdUrl>
      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <unpack>makeSrcIdFile --organismAbbrev "${organismAbbrev}" --outputFile @@dataDir@@/mapping.txt</unpack>

      <pluginArgs>--DbRefMappingFile @@dataDir@@/mapping.txt --extDbName %DATASET_NAME% --extDbReleaseNumber %DATASET_VERSION% --columnSpec "primary_identifier" --viewName GeneFeature --tableName DbRefNAFeature --geneExternalDatabaseSpec '${organismAbbrev}_primary_genome_RSRC|${genomeVersion}' --organismAbbrev ${organismAbbrev}</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="dbxref_gene2ApiLoc" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="projectName">&projectName;</prop>
    <prop name="version">&version;</prop>
    <prop name="ApiLocOrganism"/>   <!-- organism name as found on the ApiLoc site. -->


    <graphTemplateFile name="dbXRefs.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_dbxref_ApiLoc_RSRC"
	      version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertDBxRefs"
              scope="organism"
              type="dbxref"
              externalDbIdUrlUseSecondaryId="false"
              organismAbbrev="${organismAbbrev}">

      <externalDbIdUrl><![CDATA[http://apiloc.biochem.unimelb.edu.au/apiloc/apiloc/gene/${ApiLocOrganism}/EXTERNAL_ID_HERE]]></externalDbIdUrl>
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/dbxref/gene2ApiLoc/${version}/final/${organismAbbrev}.html">
        <dir name="final">
        </dir>
      </manualGet>

      <unpack>makeDbxRefsFromApiLocHtml @@dataDir@@/${organismAbbrev}.html "${ApiLocOrganism}" > @@dataDir@@/dbxrefs.txt</unpack>

      <pluginArgs>--DbRefMappingFile @@dataDir@@/dbxrefs.txt --extDbName %DATASET_NAME% --extDbReleaseNumber %DATASET_VERSION% --columnSpec "primary_identifier" --viewName GeneFeature --tableName "DbRefNAFeature"  --organismAbbrev ${organismAbbrev}</pluginArgs>
    </datasetLoader>
  </datasetClass>

<!-- Gene synonyms -->

<datasetClass class="dbxref_synonym" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="projectName">&projectName;</prop>
    <prop name="version">&version;</prop>
    <prop name="name">&name;</prop>

    <graphTemplateFile name="dbXRefs.xml"/>
 
    <datasetLoader datasetName="${organismAbbrev}_dbxref_${name}_synonym_RSRC"
	      version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertDBxRefs"
              scope="organism"
              externalDbIdType="synonym"
              type="dbxref"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/function/synonym/${name}/${version}/final/synonyms.txt">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--DbRefMappingFile @@dataDir@@/synonyms.txt --extDbName %DATASET_NAME% --extDbReleaseNumber %DATASET_VERSION% --columnSpec "primary_identifier" --viewName GeneFeature --tableName "DbRefNAFeature"  --organismAbbrev ${organismAbbrev}</pluginArgs>
    </datasetLoader>
  </datasetClass> 

  <datasetClass class="dbxref_gene2PubmedFromNcbi" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="genomeVersion"/>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="dbXRefs.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_dbxref_gene2PubmedFromNcbi_RSRC"
	      version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertDBxRefs"
              scope="organism"
              type="dbxref"
              externalDbIdUrlUseSecondaryId="false"
              organismAbbrev="${organismAbbrev}">

      <externalDbIdUrl><![CDATA[http://www.ncbi.nlm.nih.gov/sites/entrez?cmd=PureSearch&db=pubmed&term=EXTERNAL_ID_HERE[UID]]]></externalDbIdUrl>

      <manualGet fileOrDir="common/dbxref/gene2PubmedFromNcbi/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>

      <unpack>ncbiGenePubmed2DbRefsFile --gene2pubmedFile @@dataDir@@/final/gene2pubmed.gz --geneInfoFile @@dataDir@@/final/gene_info.gz --taxId ${ncbiTaxonId} --gusConfigFile @@workflowDataDir@@/${organismAbbrev}/${organismAbbrev}_gus.config > @@dataDir@@/gene2PubmedFromNcbi.tab</unpack>

      <unpack>rm -f @@dataDir@@/gene_info.gz</unpack>

      <unpack>rm -f @@dataDir@@/gene2pubmed.gz</unpack>

      <pluginArgs>--DbRefMappingFile @@dataDir@@/gene2PubmedFromNcbi.tab --extDbName %DATASET_NAME% --extDbReleaseNumber %DATASET_VERSION% --columnSpec "primary_identifier,secondary_identifier" --tableName "DbRefNAFeature"  --viewName GeneFeature --geneExternalDatabaseSpec '${organismAbbrev}_primary_genome_RSRC|${genomeVersion}'  --organismAbbrev ${organismAbbrev}</pluginArgs>

    </datasetLoader>
  </datasetClass>


  <!-- depends on gene2Entrez -->
  <datasetClass class="dbxref_gene2Uniprot" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="genomeVersion"/>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="dbXRefs.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_dbxref_gene2Uniprot_RSRC"
	      version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertDBxRefs"
              externalDbIdType="alternate id"
              scope="organism"
              type="dbxref"
              externalDbIdUrlUseSecondaryId="false"
              organismAbbrev="${organismAbbrev}">

      <externalDbIdUrl><![CDATA[http://www.uniprot.org/uniprot/EXTERNAL_ID_HERE]]></externalDbIdUrl>

      <manualGet fileOrDir="common/dbxref/gene2Uniprot/${version}/final/idmapping_selected.tab.gz">
        <dir name="final">
        </dir>
      </manualGet>

      <!-- need to use the gene2entrez file to get map of NCBI ids -->
      <unpack>uniprotIdMap2DbRefsFile @@dataDir@@/idmapping_selected.tab.gz @@dataDir@@/../${organismAbbrev}_dbxref_gene2Entrez_RSRC/gene2entrez.tab > @@dataDir@@/gene2uniprot.tab</unpack>

      <pluginArgs>--DbRefMappingFile @@dataDir@@/gene2uniprot.tab --extDbName %DATASET_NAME% --extDbReleaseNumber %DATASET_VERSION% --columnSpec "primary_identifier,secondary_identifier,remark" --tableName "DbRefNAFeature"  --viewName GeneFeature --geneExternalDatabaseSpec '${organismAbbrev}_primary_genome_RSRC|${genomeVersion}'  --organismAbbrev ${organismAbbrev}</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <!-- Category: gene aliases -->

  <datasetClass class="aliases" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="version">&version;</prop>
    <prop name="name">&name;</prop>
    <prop name="columnSpec"/>
    <prop name="url"/>
    <prop name="urlUsesSecondaryId"/>  <!-- true or false -->
    <prop name="target"/>  <!-- NASequence, AAFeature, NAFeature -->
    <prop name="idType"/>  <!-- previous id, alternate id -->
    <prop name="viewName"/> <!--GeneFeature,Transcript,TranslatedAAFeature,ExternalAASequence,TranslatedAASequence,ExternalNASequence,VirtualSequence -->

    <graphTemplateFile name="aliases.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${name}_${target}_aliases_RSRC"
	      version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertDBxRefs"
              externalDbIdType="${idType}"
              externalDbIdIsAnAlias="true"
              scope="organism"
              type="alias"
              externalDbIdUrlUseSecondaryId="${urlUsesSecondaryId}"
              organismAbbrev="${organismAbbrev}">

      <externalDbIdUrl><![CDATA[${url}]]></externalDbIdUrl>
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/alias/${name}/${version}/final/aliases.txt">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--DbRefMappingFile @@dataDir@@/aliases.txt --extDbName %DATASET_NAME% --extDbReleaseNumber %DATASET_VERSION% --columnSpec "${columnSpec}" --tableName DbRef${target} --viewName "${viewName}" --organismAbbrev ${organismAbbrev}</pluginArgs>

    </datasetLoader>
  </datasetClass>

  <!-- ONLY INCLUDE IF THIS ORGANISM'S GENOME IS IN GENBANK -->
  <datasetClass class="dbxref_gene2Entrez" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="genomeVersion"/>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="aliases.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_dbxref_gene2Entrez_RSRC"
	      version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertDBxRefs"
              externalDbIdType="alternate id"
              externalDbIdIsAnAlias="true"
              externalDbIdUrlUseSecondaryId="false"
              scope="organism"
              type="dbxref"
              organismAbbrev="${organismAbbrev}">

      <externalDbIdUrl><![CDATA[http://www.ncbi.nlm.nih.gov/sites/entrez?db=gene&cmd=search&term=EXTERNAL_ID_HERE]]></externalDbIdUrl>
      <manualGet fileOrDir="common/alias/gene2Entrez/${version}/final/gene_info.gz">
        <dir name="final">
        </dir>
      </manualGet>

      <unpack>ncbiGeneInfo2DbRefsFile @@dataDir@@/gene_info.gz ${ncbiTaxonId} speciesTaxa @@workflowDataDir@@/${organismAbbrev}/${organismAbbrev}_gus.config > @@dataDir@@/gene2entrez.tab</unpack>

      <unpack>rm -f @@dataDir@@/gene_info.gz</unpack>

      <pluginArgs>--DbRefMappingFile @@dataDir@@/gene2entrez.tab --extDbName %DATASET_NAME% --extDbReleaseNumber %DATASET_VERSION% --columnSpec "primary_identifier,secondary_identifier,remark" --tableName "DbRefNAFeature"  --viewName GeneFeature --geneExternalDatabaseSpec '${organismAbbrev}_primary_genome_RSRC|${genomeVersion}' --organismAbbrev ${organismAbbrev}</pluginArgs>

    </datasetLoader>
  </datasetClass>


  <!-- Category: SNPs -->

  <!-- FIX WORKFLOW: need to change getAndAnalyzeSnps to use SNPs.gff -->
  <datasetClass class="SNPs_GFF" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="SNPs.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_SNP_${name}_gff_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="SNP"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/SNP/${name}/${version}/final/SNPs.gff">
        <dir name="final">
        </dir>
      </manualGet>
      <getAndUnpackOutput file="@@dataDir@@/SNPs.gff"/>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>


 <datasetClass class="SNPs_HTS_Experiment" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="hasPairedEnds"/>
    <prop name="isColorspace"/>
    <prop name="snpPercentCutoff"/>

    <graphTemplateFile name="SNPs_HTS.xml"/>
   
    <datasetLoader datasetName="${organismAbbrev}_HTS_SNP_${name}_RSRC" version="${version}"
          plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="isolates"
              subType="HTS_SNP"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <!-- delete empty final/ dir created by experiment graph for mirroring.  samples will mirror their own files. -->
      <unpack>rm -rf @@dataDir@@/final</unpack>
      <!-- since mirroring is already done, now we can make a non-empty final dir -->
      <unpack>ln -s @@manualDeliveryDir@@/${projectName}/${organismAbbrev}/SNP/${name}/${version}/final/ @@dataDir@@</unpack>

      <getAndUnpackOutput dir="@@dataDir@@/final" />
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>



  <datasetClass class="SNPs_HTS_Sample" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName"/>
    <prop name="snpStrainAbbrev"/>

    <graphTemplateFile name="htsSnpSamples.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${experimentName}_${snpStrainAbbrev}_HTS_SNPSample_RSRC" version="dontcare"
          plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="isolates"
              subType="HTS_SNP"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <getAndUnpackOutput file="@@dataDir@@/../${organismAbbrev}_HTS_SNP_${experimentName}_RSRC/final/${snpStrainAbbrev}" />
      <getAndUnpackOutput file="@@dataDir@@/../${organismAbbrev}_HTS_SNP_${experimentName}_RSRC/final/${snpStrainAbbrev}.paired" />

      <!-- these are needed for colorspace -->
      <getAndUnpackOutput file="@@dataDir@@/../${organismAbbrev}_HTS_SNP_${experimentName}_RSRC/final/${snpStrainAbbrev}.qual" />
      <getAndUnpackOutput file="@@dataDir@@/../${organismAbbrev}_HTS_SNP_${experimentName}_RSRC/final/${snpStrainAbbrev}.qual.paired" />

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="SNPs_HTS_Sample_QuerySRA" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName"/>
    <prop name="snpStrainAbbrev"/>
    <prop name="sraQueryString"/>
 
    <graphTemplateFile name="htsSnpSamples.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${experimentName}_${snpStrainAbbrev}_HTS_SNPSample_RSRC" version="dontcare"
          plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="isolates"
              subType="HTS_SNP"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>



  <!-- Category: microarrayPlatform -->

  <datasetClass class="microarrayPlatform" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop> 
    <prop name="version">&version;</prop>
    <prop name="isAffymetrixGeneArray"/>
    <prop name="isNimbleGenGeneArray"/>
    <prop name="vendorMappingFileName"/> <!-- for nimblegen, the xys file will declare a "designname" which should be used here -->
    <prop name="probeRows"/>
    <prop name="probeCols"/>
    <prop name="limitNU"/>
    <prop name="variableLengthReads"/>
    <prop name="numInsertions"/>

    <graphTemplateFile name="gsnap.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_microarrayPlatform_${name}_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression_platform"
              subType="array"
              organismAbbrev="${organismAbbrev}"
	      >

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/microarrayPlatform/${name}/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>

      <!-- for nimblegen, we require additional file named geneProbeMapping.ndf -->
      <getAndUnpackOutput dir="@@dataDir@@/final"/>
      <getAndUnpackOutput file="@@dataDir@@/final/probes.fsa"/>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="microarrayPlatformWithProviderMapping" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop> 
    <prop name="version">&version;</prop>
    <prop name="isAffymetrixGeneArray"/>
    <prop name="isNimbleGenGeneArray"/>
    <prop name="providedMappingFileName"/>

    <graphTemplateFile name="gsnap.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_microarrayPlatform_${name}_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression_platform"
              subType="array"
              organismAbbrev="${organismAbbrev}"
	      >

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/microarrayPlatform/${name}/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>

      <getAndUnpackOutput dir="@@dataDir@@/final"/>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>



  <datasetClass class="chipChipPlatform" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="hasPairedEnds"/>

    <graphTemplateFile name="genomicArrayStudies.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_chipChipPlatform_${name}_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression_platform"
              subType="chip_chip"
              organismAbbrev="${organismAbbrev}"
	      >

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/microarrayPlatform/${name}/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>


      <getAndUnpackOutput dir="@@dataDir@@/final"/>
      <getAndUnpackOutput file="@@dataDir@@/final/probes.fsa"/>


      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <!-- Category: microarrayExpression -->

  <!-- manual delivery and plugin or step class must be upgraded see redmine #4257 -->
  <datasetClass class="microarrayExpressionExperiment" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName"/>
    <prop name="experimentVersion"/>
    <prop name="microarrayPlatformName"/>
    <prop name="microarrayPlatformVersion"/>
    <prop name="doExpressionAnalysis"/>
    <prop name="usesAffymetrixGeneArray"/>
    <prop name="usesNimbleGenGeneArray"/>

    <graphTemplateFile name="gsnap.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_microarrayExpression_${experimentName}_RSRC" version="${experimentVersion}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="array"
              organismAbbrev="${organismAbbrev}"
	      >
      
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/microarrayExpression/${experimentName}/${experimentVersion}/final">
        <dir name="final">
        </dir>
      </manualGet>

      <getAndUnpackOutput dir="@@dataDir@@/final"/>
      <getAndUnpackOutput file="@@dataDir@@/final/analysisConfig.xml"/>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>

    </datasetLoader>
  </datasetClass>

  <datasetClass class="rtpcrProfiles" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name"/>
    <prop name="version"/>
    <prop name="hasTimeSeries"/>

    <graphTemplateFile name="genericProfile.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_rtpcr_${name}_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="rtpcr"
              organismAbbrev="${organismAbbrev}"
	      >
      
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/rtpcrExpression/${name}/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>

      <getAndUnpackOutput dir="@@dataDir@@/final"/>
      <getAndUnpackOutput file="@@dataDir@@/final/analysisConfig.xml"/>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>

    </datasetLoader>
  </datasetClass>


  <!-- Category: microarrayExpression -->

  <!-- manual delivery must include two files:   -->
  <!--   geneProbeMapping.txt (an empty file)  -->
  <!--   geneProbeMappingVendor (the cdf or ndf file)   -->
  <datasetClass class="microarrayExpressionExperimentWithProviderProbeMapping" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName"/>
    <prop name="experimentVersion"/>
    <prop name="doExpressionAnalysis"/>
    <prop name="usesAffymetrixGeneArray"/>
    <prop name="usesNimbleGenGeneArray"/>

    <graphTemplateFile name="gsnap.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_microarrayExpression_${experimentName}_RSRC" version="${experimentVersion}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="array"
              organismAbbrev="${organismAbbrev}"
	      >
      
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/microarrayExpression/${experimentName}/${experimentVersion}/final">
        <dir name="final">
        </dir>
      </manualGet>

      <getAndUnpackOutput dir="@@dataDir@@/final"/>
      <getAndUnpackOutput file="@@dataDir@@/final/analysisConfig.xml"/>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>

    </datasetLoader>
  </datasetClass>


  <!-- Category: ChIP Chip-->

  <datasetClass class="chipChipExperiment" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName"/>
    <prop name="experimentVersion"/>
    <prop name="chipChipPlatformName"/>
    <prop name="chipChipPlatformVersion"/>
    <prop name="peakFinderArgs"/>
    <prop name="loadPeakCalls"/>

    <graphTemplateFile name="genomicArrayStudies.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_chipChipExper_${experimentName}_RSRC" version="${experimentVersion}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="chip_chip"
              organismAbbrev="${organismAbbrev}"
	      >

     <manualGet fileOrDir="${projectName}/${organismAbbrev}/chipChip/${experimentName}/${experimentVersion}/final">
        <dir name="final">
        </dir>
      </manualGet>

     <getAndUnpackOutput dir="@@dataDir@@/final" />

     <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>

    </datasetLoader>
  </datasetClass>


  <!-- the files containing the sample data are assumed to be normalized -->
  <datasetClass class="chipChipSample" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName"/>
    <prop name="sampleName"/>
    <!-- The props below should be loaded as metadata, not protocol params -->
<!--    <prop name="LifeCycleStage"/> -->
<!--    <prop name="Antibody"/> -->
<!--    <prop name="Genotype"/> -->
<!--    <prop name="Replicate"/> -->
<!--    <prop name="Strain"/> -->
<!--    <prop name="Treatment"/> -->
<!--    <prop name="CellType"/> -->
 
    <graphTemplateFile name="chipChipSamples.xml"/>

      <!-- we load a fake resource here so we can make a getAndUnpackOutput -->
      <!-- to declare existence of sample file that is acquired by experiment, for test mode -->
    <datasetLoader datasetName="${organismAbbrev}_${experimentName}_${sampleName}_chipChipSample_RSRC" version="dontcare"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="chip_chip"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>
      <getAndUnpackOutput file="@@dataDir@@/../${organismAbbrev}_chipChipExper_${experimentName}_RSRC/final/${sampleName}.txt" />

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="chipChipMetaData" category="" datasetFileHint="">
    <purpose></purpose>
	  <prop name="organismAbbrev"/>
	  <prop name="experimentName"/>
	  <prop name="experimentVersion"/>
	  <prop name="projectName">&projectName;</prop>
    
    <graphTemplateFile name="studyMetadata.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_ChipChip_metaData_${experimentName}_RSRC" version="${experimentVersion}"
          plugin="ApiCommonData::Load::Plugin::InsertStudyMetaData"
              scope="organism"
              type="metadata"
              subType="chip-chip"
          >

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/chipChip/${experimentName}/${experimentVersion}/metadata/sampleMetaData.txt">
        <dir name="metadata">
        </dir>
      </manualGet>
      <pluginArgs>--file @@dataDir@@/sampleMetaData.txt --studyExtDbRlsSpec '${organismAbbrev}_ChipChip_${experimentName}_RSRC|${experimentVersion}'</pluginArgs>
    </datasetLoader>

  </datasetClass>



  <!-- NOTE:  because the data files are so large, we don't copy into our
       workflow data dir, but use a symlink into manual deliv instead -->

  <!-- final/ dir must have a file per sample, with name identical to the 
       sample name.  if there are paired ends reads, each sample will also
       have a samplename.paired file -->
  <datasetClass class="rnaSeqExperiment" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="limitNU">Limits the number of ambiguous mappers to a max of given number, [1-30]. It is usually the largest gene family in the organism.</prop>
    <prop name="hasPairedEnds">Data is paired end, [false|true]. Check with data provider.</prop>
    <prop name="isStrandSpecific">Data is strand specific, [false|true]. Check with data provider.</prop>
    <prop name="alignWithCdsCoordinates">Use CDS model for alignment, [false|true]. Use false if not sure what to use.</prop>
<!--    <prop name="doDegSeq">only want to set to true is data provider wants DEGSeq ran on dataset without replicates. Check with data provider.</prop> -->
    <graphTemplateFile name="hisat.xml"/>
    <qaNotes>To begin with QA, check if symbolic links of analysisConfig.xml and a FASTQ file for each sample are created under @@dataDir@@/final. Next, go to @@websiteFilesDir@@/${projectName}/@@version@@/real/webServices/${projectName}/release-CURRENT/${organismAbbrev}/bigwig/${organismAbbrev}_${name}_rnaSeq_RSRC, get normalized bigwig files, and visualize the rnaSeq alignment coverages by GBrowse track. Lastly, query the tables: ApiDB.ProfileElement, ApiDB.Profile, ApiDB.ProfileElementName and ApiDB.ProfileSet, to check if the reasonable number of intensity profiles are loaded. In the case of time series rnaSeq, also check the tables: RAD.AnalysisInput, RAD.AnalysisResultImp, RAD.Anaalysis, RAD.LogicalGroupLink and RAD.LogicalGroup to find out if the the reasonalble number of differentially expressed genes are loaded.</qaNotes>
   <!-- Inquiry: Always follow naming convention -->
    <datasetLoader datasetName="${organismAbbrev}_${name}_rnaSeq_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="rnaseq"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <descriptionOfFinal>The final/ dir must contain the following files: analysisConfig.xml and a FASTQ file for each sample in the experiment. The analysisConfig.xml privides properties for creating expression profiles of all samples in the experiment. The name of FASTQ file must be consistent with "sampleName" defined in "rnaSeqSample". To make analysisConfig.xml, please check the google doc: "Analysis Config Breakdown"</descriptionOfFinal>
        <example dir="rnaSeqExperiment.1"></example>
        <example dir="rnaSeqExperiment.paired-end"></example>
        <dir name="final">
        </dir>
      </manualGet>
      <unpack>ln -s @@manualDeliveryDir@@/${projectName}/${organismAbbrev}/rnaSeq/${name}/${version}/final/ @@dataDir@@/final</unpack>

      <getAndUnpackOutput dir="@@dataDir@@/final" />
      <getAndUnpackOutput file="@@dataDir@@/final/analysisConfig.xml"/>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>

  <datasetClass class="rnaSeqExperimentNextflow" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="hasPairedEnds">Data is paired end false|true</prop>
    <prop name="isStrandSpecific">Data is strand false|true</prop>
    <prop name="isCds">Count against CDS only false|true</prop>
    <prop name="isSRA">list of RSA to be used false|true</prop>

    <graphTemplateFile name="hisat.xml"/>
    <qaNotes>To begin with QA, check if symbolic links of analysisConfig.xml and a FASTQ file for each sample are created under @@dataDir@@/final. Next, go to @@websiteFilesDir@@/${projectName}/@@version@@/real/webServices/${projectName}/release-CURRENT/${organismAbbrev}/bigwig/${organismAbbrev}_${name}_rnaSeq_RSRC, get normalized bigwig files, and visualize the rnaSeq alignment coverages by GBrowse track. Lastly, query the tables: ApiDB.ProfileElement, ApiDB.Profile, ApiDB.ProfileElementName and ApiDB.ProfileSet, to check if the reasonable number of intensity profiles are loaded. In the case of time series rnaSeq, also check the tables: RAD.AnalysisInput, RAD.AnalysisResultImp, RAD.Anaalysis, RAD.LogicalGroupLink and RAD.LogicalGroup to find out if the the reasonalble number of differentially expressed genes are loaded.</qaNotes>
    
       <datasetLoader datasetName="${organismAbbrev}_${name}_rnaSeqNextflow_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="rnaseq"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <descriptionOfFinal>The final/ dir must contain the following files: analysisConfig.xml and a FASTQ file for each sample in the experiment or a tsv file (sraSampleList.tsv) that contain the list of samples to be analyse. The analysisConfig.xml privides properties for creating expression profiles of all samples in the experiment. The name of FASTQ file and sraSampleList.tsv must be consistent with "sampleName" defined in "rnaSeqSample". To make analysisConfig.xml, please check the google doc: "Analysis Config Breakdown", to make sraSampleList.tsv see ..... </descriptionOfFinal>
        <dir name="final">
        </dir>
      </manualGet>
      <unpack>ln -s @@manualDeliveryDir@@/${projectName}/${organismAbbrev}/rnaSeq/${name}/${version}/final/ @@dataDir@@/final</unpack>

      <getAndUnpackOutput dir="@@dataDir@@/final" />
      <getAndUnpackOutput file="@@dataDir@@/final/analysisConfig.xml"/>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>

  <datasetClass class="ebiRnaSeqExperiment" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="isStrandSpecific">Data is strand specific, [false|true]. Check with data provider.</prop>
    <prop name="ebiOrganismName">matches ebi ftp directory name</prop>
    <prop name="ebiVersion">matches ebi ftp directory name</prop>



    <graphTemplateFile name="ebiRNASeq.xml"/>
    <qaNotes>TODO:  Similar to rnaSeqExperiment</qaNotes>

    <datasetLoader datasetName="${organismAbbrev}_${name}_ebi_rnaSeq_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="rnaseq"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <descriptionOfFinal>The final/ dir must contain the following files: analysisConfig.xml. The analysisConfig.xml privides properties for creating expression profiles of all samples in the experiment.  To make analysisConfig.xml, please check the google doc: "Analysis Config Breakdown"</descriptionOfFinal>
        <dir name="final">
        </dir>
      </manualGet>
      <unpack>ln -s @@manualDeliveryDir@@/${projectName}/${organismAbbrev}/rnaSeq/${name}/${version}/final/ @@dataDir@@/final</unpack>

      <getAndUnpackOutput dir="@@dataDir@@/final" />
      <getAndUnpackOutput file="@@dataDir@@/final/analysisConfig.xml"/>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>



  <!--dataset class for updating RNAseq profiles after patch builds-->
  <datasetClass class="ebiRnaSeqExperimentPatch" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="isStrandSpecific">Data is strand specific, [false|true]. Check with data provider.</prop>
    <prop name="ebiOrganismName">matches ebi ftp directory name</prop>
    <prop name="ebiVersion">matches ebi ftp directory name</prop>

    <graphTemplateFile name="ebiRNASeq.xml"/>
    <qaNotes>TODO:  Similar to rnaSeqExperiment</qaNotes>

    <datasetLoader datasetName="${organismAbbrev}_${name}_ebi_rnaSeq_patch_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="rnaseq"
              organismAbbrev="${organismAbbrev}">

      <!--uses same analysis config as the full load so no need to fetch-->
      <manualGet fileOrDir="common/empty">
      </manualGet>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>



 <datasetClass class="ebiVCFfile" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="ebiOrganismName">matches ebi ftp directory name</prop>
    <prop name="ebiVersion">matches ebi ftp directory name</prop>


    <graphTemplateFile name="ebiVCFfile.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${name}_ebi_VCF_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="isolates"
              organismAbbrev="${organismAbbrev}">

        <manualGet fileOrDir="common/empty">
           <dir name="final"/> 
  <!--         <dir name="@@dataDir@@"/>  -->
        </manualGet>
 
       <unpack>ln -s @@manualDeliveryDir@@/${projectName}/${organismAbbrev}/VCFFiles/${name}/${version}/final/  @@dataDir@@/final</unpack>

        <getAndUnpackOutput dir="@@dataDir@@/final"/>
        <getAndUnpackOutput file="@@dataDir@@/final/${name}.vcf.gz"/>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>




<datasetClass class="ebiGFF3file" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="ebiOrganismName">matches ebi ftp directory name</prop>
    <prop name="ebiVersion">matches ebi ftp directory name</prop>


    <graphTemplateFile name="ebiGFF3file.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${name}_ebi_GFF3_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="gene_annotation"
              organismAbbrev="${organismAbbrev}">

        <manualGet fileOrDir="common/empty">
           <dir name="final"/>
  <!--         <dir name="@@dataDir@@"/>  -->
        </manualGet>

       <unpack>ln -s @@manualDeliveryDir@@/${projectName}/${organismAbbrev}/GFF3Files/${name}/${version}/final/  @@dataDir@@/final</unpack>

        <getAndUnpackOutput dir="@@dataDir@@/final"/>
        <getAndUnpackOutput file="@@dataDir@@/final/${name}.gff3.gz"/>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>




 <datasetClass class="rnaSeqSample" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName">Name of rnaSeq experiment, it should be consistent with "name" defined in "rnaSeqExperiment".</prop>
    <prop name="sampleName">Unique name of samples in rnaSeq experiment. One name per sample, and the name must be consistent with the FASTQ file name under final/ dir.</prop>
 
    <graphTemplateFile name="rnaSeqSamples.xml"/>
    <qaNotes></qaNotes>
      <!-- we load a fake resource here so we can make a getAndUnpackOutput -->
      <!-- to declare existence of sample file that is acquired by experiment, for test mode -->
    <datasetLoader datasetName="${organismAbbrev}_${experimentName}_${sampleName}_rnaSeqSample_RSRC" version="dontcare"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="rnaseq"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <getAndUnpackOutput file="@@dataDir@@/../${organismAbbrev}_${experimentName}_rnaSeq_RSRC/final/${sampleName}" />

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>


  </datasetClass>



  <datasetClass class="rnaSeqSample_QuerySRA" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName">Name of rnaSeq experiment, it should be consistent with "name" defined in "rnaSeqExperiment".</prop>
    <prop name="sampleName">Unique name of samples in rnaSeq experiment. One name per sample, and the name must be consistent with the FASTQ file name under final/ dir.</prop>
    <prop name="sraQueryString"/>
 
    <graphTemplateFile name="rnaSeqSamples.xml"/>
    <qaNotes></qaNotes>
    <datasetLoader datasetName="${organismAbbrev}_${experimentName}_${sampleName}_rnaSeqSample_RSRC" version="dontcare"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="rnaseq"
              organismAbbrev="${organismAbbrev}">


      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>


  </datasetClass>



  <datasetClass class="rnaSeqExperimentNoTranscripts" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="limitNU"/>
    <prop name="hasVariableLengthReads"/> 
    <prop name="numInsertions"/>
    <prop name="hasPairedEnds"/>
    <prop name="isStrandSpecific"/>

    <graphTemplateFile name="gsnap.xml"/>
   <!-- Inquiry: Always follow naming convention -->
    <datasetLoader datasetName="${organismAbbrev}_${name}_rnaSeq_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="rnaseq"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>
      <unpack>ln -s @@manualDeliveryDir@@/${projectName}/${organismAbbrev}/rnaSeq/${name}/${version}/final/ @@dataDir@@/final</unpack>

      <getAndUnpackOutput dir="@@dataDir@@/final" />
      <getAndUnpackOutput file="@@dataDir@@/final/analysisConfig.xml"/>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>


  <datasetClass class="rnaSeqSampleNoTranscripts" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName"/>
    <prop name="sampleName"/>
 
    <graphTemplateFile name="rnaSeqOrChipSeqSamples.xml"/>

      <!-- we load a fake resource here so we can make a getAndUnpackOutput -->
      <!-- to declare existence of sample file that is acquired by experiment, for test mode -->
    <datasetLoader datasetName="${organismAbbrev}_${experimentName}_${sampleName}_rnaSeqSample_RSRC" version="dontcare"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="rnaseq"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <getAndUnpackOutput file="@@dataDir@@/../${organismAbbrev}_${experimentName}_rnaSeq_RSRC/final/${sampleName}" />

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>


  </datasetClass>



  <datasetClass class="chipSeqExperiment" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="hasPairedEnds"/>
    <prop name="extraBowtieParams"/>
    <prop name="experimentType">[histonemod, tfbinding, mnase, faire, dnase] The type of experiment, controlled vocabulary. All samples in the same experiment MUST be of the same type (e.g. you cannot have some faire and some mnase samples in the same experiment).</prop>

    <graphTemplateFile name="chipSeqExperiment.xml"/>
   <!-- Inquiry: Always follow naming convention -->
    <datasetLoader datasetName="${organismAbbrev}_${name}_chipSeq_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="chipseq"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>
      <unpack>ln -s @@manualDeliveryDir@@/${projectName}/${organismAbbrev}/chipSeq/${name}/${version}/final/ @@dataDir@@/final</unpack>

      <getAndUnpackOutput dir="@@dataDir@@/final" />
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>




  <datasetClass class="chipSeqSample" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName"/>
    <prop name="sampleName"/>
    <prop name="inputName">The name of the sample in the same experiment which can serve as control for this one, if such a control exists (leave empty if there is no control). If this sample is itself a control, you MUST repeat its sample name here (do not leave empty).</prop>
    <prop name="fragmentLength">If known, the fragment length. Else, leave empty</prop>

    <graphTemplateFile name="chipSeqSamples.xml"/>

      <!-- we load a fake resource here so we can make a getAndUnpackOutput -->
      <!-- to declare existence of sample file that is acquired by experiment, for test mode -->
    <datasetLoader datasetName="${organismAbbrev}_${experimentName}_${sampleName}_chipSeqSample_RSRC" version="dontcare"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="chipseq"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <!-- FASTQ FILES expected -->
      <getAndUnpackOutput file="@@dataDir@@/../${organismAbbrev}_${experimentName}_chipSeq_RSRC/final/${sampleName}" />

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>


  <datasetClass class="chipSeqSample_QuerySRA" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName"/>
    <prop name="sampleName"/>
    <prop name="sraQueryString"/>
    <prop name="inputName">The name of the sample in the same experiment which can serve as control for this one, if such a control exists (leave empty if there is no control). If this sample is itself a control, you MUST repeat its sample name here (do not leave empty).</prop>
    <prop name="fragmentLength">If known, the fragment length. Else, leave empty</prop>

    <graphTemplateFile name="chipSeqSamples.xml"/>

      <!-- we load a fake resource here so we can make a getAndUnpackOutput -->
      <!-- to declare existence of sample file that is acquired by experiment, for test mode -->
    <datasetLoader datasetName="${organismAbbrev}_${experimentName}_${sampleName}_chipSeqSample_RSRC" version="dontcare"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="chipseq"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass> 


  <!-- NOTE: this dataset class only gets the sequences, it does not map
       them to the genome.  For that use clonedInsertEndsFromReferenceStrain
       ONLY INCLUDE IF A REFERENCE STRAIN
  -->

  <datasetClass class="referenceStrain-clonedInsertEnds" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="soTermName"/>
    <prop name="sourceIdRegex">&sourceIdRegex;</prop>
    <prop name="secondaryIdRegex"/>

    <graphTemplateFile name="organismSpecificMiscNoAlias.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${name}_clonedInsertEnds_RSRC" version="${version}"
	      plugin="GUS::Supported::Plugin::LoadFastaSequences"
              scope="species"
              type="aligned_sequence"
              organismAbbrev="${organismAbbrev}"
	      >

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/dnaSeq/${name}/${version}/final/seqs.fasta">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--externalDatabaseName %DATASET_NAME% --externalDatabaseVersion %DATASET_VERSION% --ncbiTaxId ${ncbiTaxonId} --sequenceFile @@dataDir@@/seqs.fasta --soTermName ${soTermName} --regexSourceId "${sourceIdRegex}" --regexSecondaryId "${secondaryIdRegex}" --tableName "DoTS::ExternalNASequence" --SOExtDbRlsSpec 'SO_RSRC|%'</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <!-- This class gets its data from cloned insert ends loaded by the
       reference strain.  It finds them in the database and maps them to
       our genome.  The reference strain DOES need to include an instance
       of this class for each dataset, so that it gets mapped  -->

  <datasetClass class="clonedInsertEndsFromReferenceStrain" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="referenceStrainOrganismAbbrev">&referenceStrainOrganismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="organismSpecificMiscNoAlias.xml"/>

  </datasetClass>


  <datasetClass class="transcript_sequences" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="soTermName"/>
    <prop name="sourceIdRegex">&sourceIdRegex;</prop>

    <graphTemplateFile name="organismSpecificMiscNoAlias.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${name}_transcript_sequences_RSRC" version="${version}"
	      plugin="GUS::Supported::Plugin::LoadFastaSequences"
              scope="species"
              type="aligned_sequence"
              organismAbbrev="${organismAbbrev}"
	      >

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/dnaSeq/${name}/${version}/final/seqs.fasta">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--externalDatabaseName %DATASET_NAME% --externalDatabaseVersion %DATASET_VERSION% --ncbiTaxId ${ncbiTaxonId} --sequenceFile @@dataDir@@/seqs.fasta --soTermName ${soTermName} --regexSourceId "${sourceIdRegex}" --tableName "DoTS::ExternalNASequence" --SOExtDbRlsSpec 'SO_RSRC|%'</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <!-- GOT TO HERE -->


  <!-- Category: SAGE tags -->


  <!-- Category: product names -->

  <datasetClass class="productNames" category="" datasetFileHint="">
    <purpose>Note: this should include product names for organelles as well</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
 
    <graphTemplateFile name="productNames.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_function_${name}_product_names_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertProductFromTabFile"
              scope="organism"
              type="gene_annotation"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/function/${name}_product_names/${version}/final/products.txt">
        <dir name="final">
        </dir>
      </manualGet>
      <unpack> processProductAddPreferred.pl --inputFile "@@dataDir@@/products.txt" --outputFile "@@dataDir@@/processed_products.txt" --assignedBy ${name}</unpack>
      <pluginArgs>--file @@dataDir@@/processed_products.txt --organismAbbrev ${organismAbbrev}</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="GeneImage" category="gene_image" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="version">&version;</prop>
    <prop name="name">&name;</prop>

	<!-- TODO test miniflow - need to set this to back organism specific xml -->
	<!-- <graphTemplateFile name="miniflow.xml"/> -->
	<graphTemplateFile name="organismSpecificMisc.xml"/>

    <datasetLoader plugin="ApiCommonData::Load::Plugin::InsertNAFeatureImage"
              datasetName="${organismAbbrev}_${name}_GeneImage_RSRC"
              version="${version}"
              scope="organism"
              type="subcellular_localization"
              organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/geneimage/${name}_GeneImage/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>
      <getAndUnpackOutput dir="@@dataDir@@/final"/>
      <getAndUnpackOutput dir="@@dataDir@@/final/images"/>
      <pluginArgs>--file @@dataDir@@/final/geneimage.tab --extDBName "%DATASET_NAME%" --extDBVer "%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>



  <datasetClass class="Cellxgene" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="version">&version;</prop>
    <prop name="name">&name;</prop>

  	<graphTemplateFile name="organismSpecificMisc.xml"/>

    <datasetLoader plugin="ApiCommonData::Load::Plugin::InsertCellxgene"
              datasetName="${organismAbbrev}_${name}_cellxgene_RSRC"
              version="${version}"
              scope="organism"
              type="transcript_expression"
              subType="scrnaseq"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/scRNASeq/${name}/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>
      <getAndUnpackOutput file="@@dataDir@@/final/cellxgene.h5ad"/>
      <getAndUnpackOutput file="@@dataDir@@/final/gene_mapping.txt"/>
      <pluginArgs>--file @@dataDir@@/final/gene_mapping.txt --extDbRlsSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>




  <datasetClass class="NAFeaturePhenotypeImage" category="phenotype" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="version">&version;</prop>
    <prop name="name">&name;</prop>

    <graphTemplateFile name="organismSpecificMisc.xml"/> 

    <datasetLoader plugin="ApiCommonData::Load::Plugin::InsertNAFeaturePhenotype"
              datasetName="${organismAbbrev}_${name}_NAFeaturePhenotypeImage_RSRC"
              version="${version}"
              scope="organism"
              type="phenotype"
              organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/phenotype/${name}/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>
      <getAndUnpackOutput dir="@@dataDir@@/final"/>
      <getAndUnpackOutput dir="@@dataDir@@/final/images"/>
      <pluginArgs>--file @@dataDir@@/final/phenotype_results.tab --extDBName "%DATASET_NAME%" --extDBVer "%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="NAFeaturePhenotypeGeneric" category="phenotype" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="version">&version;</prop>
    <prop name="name">&name;</prop>

    <graphTemplateFile name="organismSpecificMisc.xml"/> 

    <datasetLoader plugin="ApiCommonData::Load::Plugin::InsertNAFeaturePhenotype"
              datasetName="${organismAbbrev}_${name}_NAFeaturePhenotypeGeneric_RSRC"
              version="${version}"
              scope="organism"
              type="phenotype"
              organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/phenotype/${name}/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>
      <getAndUnpackOutput dir="@@dataDir@@/final"/>
      <pluginArgs>--file @@dataDir@@/final/phenotype_results.tab --extDBName "%DATASET_NAME%" --extDBVer "%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="GeneOntologyAssociations" category="gene_annotation" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="version">&version;</prop>
    <prop name="name">&name;</prop>

    <graphTemplateFile name="organismSpecificMisc.xml"/>

    <datasetLoader plugin="ApiCommonData::Load::Plugin::InsertGOAssociationsSimple"
              datasetName="${organismAbbrev}_${name}_GOAssociations_RSRC"
              version="${version}"
              scope="organism"
              organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/function/${name}_GOAssociations/${version}/final/associations.gas">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--externalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%" --inputFile @@dataDir@@/associations.gas --goExtDbRlsName "GO_RSRC" --goEvidenceCodeExtDbRlsName "GO_evidence_codes_RSRC" --seqIdSql "SELECT g.source_id, taf.aa_sequence_id FROM dots.genefeature g, dots.transcript t, dots.translatedAAFeature taf WHERE g.na_feature_id = t.parent_id AND t.na_feature_id = taf.na_feature_id UNION all select t.source_id, taf.aa_sequence_id from dots.transcript t, dots.translatedAAFeature taf where t.na_feature_id = taf.na_feature_id UNION all SELECT taf.source_id, taf.aa_sequence_id FROM dots.translatedAAFeature taf order by SOURCE_ID" --targetTable "DoTS::TranslatedAASequence" --lineOfEvidence "${name}" --inputIdColumn id --tolerateMissingSeqs --skipBadGOTerms @@dataDir@@/badGOTerms.log</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="EnzymeCommissionAssociations" category="gene_annotation" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="version">&version;</prop>
    <prop name="name">&name;</prop>

    <graphTemplateFile name="organismSpecificMisc.xml"/>

    <datasetLoader plugin="GUS::Community::Plugin::InsertECMapping"
              datasetName="${organismAbbrev}_${name}_ECAssociations_RSRC"
              version="${version}"
              scope="organism"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/function/${name}_ECAssociations/${version}/final/ec.txt">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--ECMappingFile @@dataDir@@/ec.txt --evidenceCode "${name}" --aaSeqLocusTagMappingSql "select aa_sequence_id from dots.TranslatedAAFeature  where source_id = ?"</pluginArgs>
    </datasetLoader>

  </datasetClass>

<!--Input files have gene feature ID to EC number mappings, such as, Hagai_ECAssociations-->

  <datasetClass class="ECAssocGeneFeatureMappings" category="gene_annotation" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="version">&version;</prop>
    <prop name="name">&name;</prop>

    <graphTemplateFile name="organismSpecificMisc.xml"/>

    <datasetLoader plugin="GUS::Community::Plugin::InsertECMapping"
              datasetName="${organismAbbrev}_${name}_ECAssociations_RSRC"
              version="${version}"
              scope="organism"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/function/${name}_ECAssociations/${version}/final/ec.txt">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--ECMappingFile @@dataDir@@/ec.txt --evidenceCode "${name}" --aaSeqLocusTagMappingSql "select taf.aa_sequence_id from dots.Transcript t, dots.TranslatedAAFeature taf, dots.GeneFeature gf where gf.source_id = ? and gf.na_feature_id = t.parent_id and t.na_feature_id = taf.na_feature_id"</pluginArgs>
    </datasetLoader>

  </datasetClass>




  <datasetClass class="ECAssocFromUniprot" category="gene_annotation" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="version">&version;</prop>
    <prop name="speciesNcbiTaxonId">&speciesNcbiTaxonId;</prop>

    <graphTemplateFile name="organismSpecificMisc.xml"/>

    <datasetLoader plugin="GUS::Community::Plugin::InsertECMapping"
              datasetName="${organismAbbrev}_Uniprot_ECAssociations_RSRC"
              version="${version}"
              scope="organism"
              organismAbbrev="${organismAbbrev}">
  
     <wgetArgs url="rest.uniprot.org/uniprotkb/search?query=organism_id%3a${speciesNcbiTaxonId}&amp;force=yes&amp;format=tsv&amp;fields=accession,gene_names,organism_name,ec"> --output-document=@@dataDir@@/ecAssocFromUniprot.tab --content-disposition </wgetArgs>
     
     <unpack>printOrgSpecificGeneToEC --infile @@dataDir@@/ecAssocFromUniprot.tab --outfile @@dataDir@@/${organismAbbrev}LocTagToEC.tab --orgAbbrev ${organismAbbrev}</unpack>     

      <pluginArgs>--ECMappingFile @@dataDir@@/${organismAbbrev}LocTagToEC.tab --evidenceCode "Uniprot" --aaSeqLocusTagMappingSql "select taf.aa_sequence_id from dots.Transcript t, dots.TranslatedAAFeature taf, dots.GeneFeature gf where gf.source_id = ? and gf.na_feature_id = t.parent_id and t.na_feature_id = taf.na_feature_id"</pluginArgs>
    </datasetLoader>

  </datasetClass>
  

  <!-- Category: comments -->

  <datasetClass class="comments" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
 
    <graphTemplateFile name="organismSpecificMisc.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${name}_comments_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertNaFeatCommentFromTabFile"
              scope="organism"
              type="gene_annotation"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/comment/${name}/${version}/final/comments.txt">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--file @@dataDir@@/comments.txt  --organismAbbrev ${organismAbbrev}</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <!-- Category: isolates -->

  <!-- NOTE: this dataset class only gets the isolates, it does not map
       them to the genome.  See isolatesFromFamilyRepresentative
       ONLY INCLUDE IF A REFERENCE STRAIN
  -->

  <datasetClass class="familyRepresentative-isolatesGenbank" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
 
    <graphTemplateFile name="isolatesFromNonHtsSequencing.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_isolates_genbank_RSRC" version="TODAY"
	      plugin="ApiCommonData::Load::Plugin::InsertSequenceTypedIsolatesFromGenBank"
              scope="species"
              organismAbbrev="${organismAbbrev}"
              type="isolates"
              subType="sequencing_typed"
	      >

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <!-- get the file from genbank, using organismAbbrev to find familyNcbiTaxonIds in Organism table -->
      <unpack>getIsolatesFromGenbank @@dataDir@@/isolates.gb "${organismAbbrev}"</unpack>

      <unpack>fixIsolateSequences --seq_file @@dataDir@@/isolates.gb --fixed_seq_file @@dataDir@@/isolates_fixed_1.gb --removed_seq_file @@dataDir@@/isolates_excluded.gb</unpack>

      <unpack>sed "s/SOURCE\tplastid/SOURCE\t/" @@dataDir@@/isolates_fixed_1.gb | sed "s/SOURCE\tapicoplast/SOURCE\t/" | sed "s/SOURCE\tmitochondrion/SOURCE\t/" > @@dataDir@@/isolates_fixed_2.gb</unpack>

      <pluginArgs>--extDbName %DATASET_NAME% --extDbRlsVer %DATASET_VERSION% --inputFile @@dataDir@@/isolates_fixed_2.gb</pluginArgs>
    </datasetLoader>
  </datasetClass>



  <!-- NOTE: update isolates loaded from Genbank files with additional information provided by provider -->

  <datasetClass class="updateIsolatesInfo" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="isolatesFromNonHtsSequencing.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_updateIsolatesInfo_RSRC"
              version="${version}"
	      plugin="ApiCommonData::Load::Plugin::UpdateTgondiiIsolatesFromDardre"
              scope="species"
              type="isolates"
              subType="sequencing_typed"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/isolate/${name}/${version}/final/updates.txt">
        <dir name="final">
        </dir>
      </manualGet>

     <pluginArgs>--extDbRlsSpec "%DATASET_NAME%|%DATASET_VERSION%" --inputFile @@dataDir@@/updates.txt </pluginArgs>
    </datasetLoader>
  </datasetClass>


  <!-- NOTE: this dataset class only gets the isolates, it does not map
       them to the genome.  See isolatesFromFamilyRepresentative
       ONLY INCLUDE IF A FAMILY REPRESENTATIVE

  -->

  <datasetClass class="familyRepresentative-isolateSequencesFasta" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="sourceIdRegex">&sourceIdRegex;</prop>

    <graphTemplateFile name="isolatesFromNonHtsSequencing.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_isolates_${name}_RSRC" version="${version}"
	      plugin="GUS::Supported::Plugin::LoadFastaSequences"
              scope="species"
              type="isolates"
              subType="sequencing_typed"
              organismAbbrev="${organismAbbrev}"
	      >

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/isolate/${name}/${version}/final/isolates.fasta">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--externalDatabaseName %DATASET_NAME% --externalDatabaseVersion %DATASET_VERSION% --ncbiTaxId ${ncbiTaxonId} --sequenceFile @@dataDir@@/isolates.fasta --soTermName region --regexSourceId "${sourceIdRegex}" --tableName "DoTS::ExternalNASequence" --SOExtDbRlsSpec 'SO_RSRC|%'</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <!-- the ncbi taxon ID is not important.  isolate strain info is provided by dedicated isolate info tables -->
  <datasetClass class="familyRepresentative-isolateFeaturesGFF2" category="isolates" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="ncbiTaxonId">&ncbiTaxonId;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="mapFile"/>
 
    <graphTemplateFile name="isolatesFromNonHtsSequencing.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_isolates_${name}_features_RSRC" version="${version}"
	      plugin="GUS::Supported::Plugin::InsertSequenceFeatures"
              scope="species"
	      parentDatasetName="${organismAbbrev}_isolates_${name}_RSRC"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/isolate/${name}/${version}/final/isolates.gff">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs> --extDbName %PARENT_DATASET_NAME% --extDbRlsVer %PARENT_DATASET_VERSION% --mapFile @@gusHome@@/lib/xml/isf/${mapFile} --inputFileOrDir @@dataDir@@/isolates.gff --fileFormat gff2 --gff2GroupTag locus_tag --naSequenceSubclass ExternalNASequence --seqIdColumn source_id --soExtDbSpec "SO_RSRC|%" --defaultOrganism ${ncbiTaxonId} --bioperlTreeOutput @@dataDir@@/bioperlTree.out</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <!-- NOTE: this dataset does not get the isolates, but it does map
       them to the genome.  It extracts the sequences from the database
  -->

  <datasetClass class="isolatesFromFamilyRepresentative" category="isolates" datasetFileHint="">
    <purpose></purpose>
    <prop name="familyRepOrganismAbbrev"/>
    <prop name="name">&name;</prop>
 
    <graphTemplateFile name="organismSpecificMiscNoAlias.xml"/>
  </datasetClass>



  <!-- NOTE: this class is specific to Crypto and is used to assign "is_reference" status to some isolates  -->

  <datasetClass class="isolatesUpdateIsReference" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="isolatesFromNonHtsSequencing.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_isolateIsReference_RSRC"
              version="${version}"
             plugin="ApiCommonData::Load::Plugin::InsertIsolateReferenceCharacteristics"
              scope="species"
              type="isolates"
              subType="sequencing_typed"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/isolate/${name}/${version}/final/reference_isolates.txt">
        <dir name="final">
        </dir>
      </manualGet>

     <pluginArgs>--accFile @@dataDir@@/reference_isolates.txt --extDbSpec "${organismAbbrev}_isolates_genbank_RSRC|%"</pluginArgs>
    </datasetLoader>
  </datasetClass>

  
    <datasetClass class="massSpecFromMgf" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="genomeVersion"/>

    <graphTemplateFile name="MassSpecFromMgf.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_massSpec_${name}_RSRC" version="${version}"
		  plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="protein_expression"
              organismAbbrev="${organismAbbrev}"
	      >

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>
	        <!-- delete empty final/ dir created by experiment graph for mirroring.  samples will mirror their own files. -->
      <unpack>rm -rf @@dataDir@@/final</unpack>
      <!-- since mirroring is already done, now we can make a non-empty final dir -->
      <unpack>ln -s @@manualDeliveryDir@@/${projectName}/${organismAbbrev}/massSpec/${name}/${version}/final/ @@dataDir@@</unpack>

      <getAndUnpackOutput dir="@@dataDir@@/final" />	 
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>	  
    </datasetLoader>
  </datasetClass>

    <datasetClass class="massSpecFromMgf_Sample" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName"/>
    <prop name="sampleName"/>

    <graphTemplateFile name="massSpecSamples.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${experimentName}_${sampleName}_MassSpecSample_RSRC" version="dontcare"
          plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="protein_expression"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <getAndUnpackOutput file="@@dataDir@@/../${organismAbbrev}_MassSpec_${experimentName}_RSRC/final/${sampleName}.mgf" />
 
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>
  
  <datasetClass class="massSpecPreprocessed" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="genomeVersion"/>
    <prop name="fileNameRegex"/>

    <graphTemplateFile name="massSpec.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_massSpec_${name}_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertMassSpecFeaturesAndSummaries"
              scope="organism"
              type="protein_expression"
              organismAbbrev="${organismAbbrev}"
	      >

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/massSpec/${name}/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--inputDir @@dataDir@@/final --externalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%" --geneExternalDatabaseSpec '${organismAbbrev}_primary_genome_RSRC|${genomeVersion}' --organismAbbrev ${organismAbbrev} --fileNameRegex '${fileNameRegex}'</pluginArgs>
    </datasetLoader>
  </datasetClass>

<datasetClass class="massSpecPreprocessedNoOrfs" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="genomeVersion"/>
    <prop name="fileNameRegex"/>

    <graphTemplateFile name="massSpec.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_massSpec_${name}_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertMassSpecFeaturesAndSummaries"
              scope="organism"
              type="protein_expression"
              organismAbbrev="${organismAbbrev}"
	      >

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/massSpec/${name}/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--inputDir @@dataDir@@/final --externalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%" --geneExternalDatabaseSpec '${organismAbbrev}_primary_genome_RSRC|${genomeVersion}' --organismAbbrev ${organismAbbrev} --fileNameRegex '${fileNameRegex}'</pluginArgs>
    </datasetLoader>
  </datasetClass>



  <datasetClass class="orthomclPhyletic" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="comparativeGenomics.xml"/>

    <datasetLoader datasetName="OrthoMCL_Phyletic_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertPhylogeneticProfile"
              scope="global"
              type="orthology"
              >

      <manualGet fileOrDir="common/orthology/orthoMCL/${version}/orthomclGroups.txt">
        <dir name="final">
        </dir>
      </manualGet>
      <pluginArgs>--projectName ${projectName} --groupsFile @@dataDir@@/orthomclGroups.txt</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="orthomcl" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="comparativeGenomics.xml"/>

    <datasetLoader datasetName="OrthoMCL_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertOrthologousGroups"
              scope="global"
              type="orthology"
              >

      <manualGet fileOrDir="common/orthology/orthoMCL/${version}/orthomclGroups.txt">
        <dir name="final">
        </dir>
      </manualGet>
      <pluginArgs>--projectName ${projectName} --OrthologFile @@dataDir@@/orthomclGroups.txt --AnalysisName 'OrthoMCL-based Orthology Predictions' --AnalysisDescription 'OrthoMCL-based Orthology Predictions' --ElementResultTable "DoTS::GeneFeature"</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="orthomclTree" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="comparativeGenomics.xml"/>

    <datasetLoader datasetName="OrthoMCLTree_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertOrthomclTaxon"
              scope="global"
              type="orthology"
              >

      <!-- use non-standard approach here to get two individual files rather
           than the whole dir, which has some very large files we don't need -->
      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>
      <unpack>cp @@manualDeliveryDir@@/common/orthology/orthoMCL/%DATASET_VERSION%/orthomclClades.txt @@dataDir@@</unpack>
      <unpack>cp @@manualDeliveryDir@@/common/orthology/orthoMCL/%DATASET_VERSION%/orthomclTaxons.txt @@dataDir@@</unpack>

      <pluginArgs>--cladeFile @@dataDir@@/orthomclClades.txt --speciesFile @@dataDir@@/orthomclTaxons.txt</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="geneOntology" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>
    <datasetLoader datasetName="GO_RSRC" version="${version}"
      plugin="GUS::Supported::Plugin::InsertGeneOntology"
              scope="global"
              type="function"
              >
    <manualGet fileOrDir="common/ontology/geneOntology/${version}/final/gene_ontology.obo">
        <dir name="final">
        </dir>
    </manualGet>
    <pluginArgs>--oboFile @@dataDir@@/gene_ontology.obo --extDbRlsName %DATASET_NAME% --extDbRlsVer %DATASET_VERSION% --calcTransitiveClosure</pluginArgs>
  </datasetLoader>
  </datasetClass>

  <datasetClass class="geneOntologySlim" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>
    <datasetLoader datasetName="GOSlim_RSRC" version="${version}"
      plugin="ApiCommonData::Load::Plugin::InsertGeneOntologySlim"
              scope="global"
              type="function"
              >
    <manualGet fileOrDir="common/ontology/geneOntology/${version}/final/gene_ontology.obo">
        <dir name="final">
        </dir>
    </manualGet>
    <pluginArgs>--oboFile @@dataDir@@/gene_ontology.obo --extDbRlsName %DATASET_NAME% --extDbRlsVer %DATASET_VERSION%</pluginArgs>
  </datasetLoader>
  </datasetClass>

  <datasetClass class="enzymeDB" category="" datasetFileHint="">
    <purpose></purpose>
    <datasetLoader datasetName="enzymeDB_RSRC" version="TODAY"
      plugin="GUS::Community::Plugin::LoadEnzymeDatabase"
              scope="global"
              type="function"
              >
    <wgetArgs url="ftp://ftp.expasy.org/databases/enzyme/">--tries=5 --mirror --no-parent --no-directories --no-host-directories --cut-dirs=3 --include list  --accept=enzclass.txt,enzyme.dat</wgetArgs>
    <pluginArgs>--InPath @@dataDir@@ --enzymeDbName %DATASET_NAME% --enzymeDbRlsVer %DATASET_VERSION%</pluginArgs>
  </datasetLoader>
  </datasetClass>

  <datasetClass class="alphaFold" category="" datasetFileHint="">
    <purpose>Load AlphaFold</purpose>
    <prop name="version">&version;</prop>
    <prop name="projectName">&projectName;</prop>
    
    <graphTemplateFile name="project.xml"/>

    <datasetLoader datasetName="alphaFold_RSRC" version="${version}"
      plugin="ApiCommonData::Load::Plugin::InsertAlphaFold"
      scope="global"
      type="function">
      <wgetArgs url="http://ftp.ebi.ac.uk/pub/databases/alphafold/accession_ids.csv">--tries=5</wgetArgs>
      <getAndUnpackOutput file="@@dataDir@@/accession_ids.csv"/>
      <pluginArgs>--inputFile @@dataDir@@/accession_ids.csv --extDbSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="PDBProteinSequences" category="" datasetFileHint="">
    <purpose></purpose>
    <datasetLoader datasetName="PDBProteinSequences_RSRC" version="TODAY"
      plugin="GUS::Supported::Plugin::LoadFastaSequences"
              scope="global"
              type="external_sequences"
              >
    <wgetArgs url="ftp://ftp.wwpdb.org/pub/pdb/derived_data/pdb_seqres.txt.gz">--tries=5 --mirror --no-parent --no-directories --no-host-directories --cut-dirs=3 --output-document=@@dataDir@@/pdb_seqres.txt.gz</wgetArgs>
    <unpack>gunzip @@dataDir@@/pdb_seqres.txt.gz</unpack>
    <unpack>filterPdbFile --inputFile @@dataDir@@/pdb_seqres.txt --outputFile  @@dataDir@@/pdb.fsa.tmp</unpack>
    <unpack><![CDATA[cat @@dataDir@@/pdb.fsa.tmp | perl -e 'while(<>) { s/J|O/X/g if /^[^>]/; print;}' > @@dataDir@@/pdb.fsa]]></unpack>
    <unpack>rm @@dataDir@@/pdb.fsa.tmp</unpack>
    <unpack>xdformat -p @@dataDir@@/pdb.fsa</unpack>
    <getAndUnpackOutput file="@@dataDir@@/pdb.fsa"/>   
    <pluginArgs>--externalDatabaseName %DATASET_NAME% --externalDatabaseVersion %DATASET_VERSION% --sequenceFile  @@dataDir@@/pdb.fsa --SOTermName 'polypeptide' --SOExtDbRlsSpec 'SO_RSRC|%' --noSequence --regexSourceId  '>(\w+)\s+mol:protein' --regexDesc 'length:\d+\s+(.+)$' --tableName "DoTS::ExternalAASequence"</pluginArgs>
  </datasetLoader>
  </datasetClass>

  <datasetClass class="taxonomy" category="" datasetFileHint="">
    <purpose></purpose>
  <datasetLoader datasetName="taxonomy_RSRC" version="TODAY"
      plugin="GUS::Supported::Plugin::LoadTaxon"
              scope="global"
              type="sres"
              >
    <wgetArgs url="ftp://ftp.ncbi.nih.gov/pub/taxonomy/">--tries=5 --mirror --no-parent --no-directories --no-host-directories --cut-dirs=2 --include list --accept=taxdump.tar.gz</wgetArgs>
    <unpack>$currDir=`pwd`; cd @@dataDir@@ ; tar -xzf taxdump.tar.gz ; rm -f taxdump.tar ; cd $currDir</unpack>
    <pluginArgs>--names @@dataDir@@/names.dmp --nodes @@dataDir@@/nodes.dmp --gencode @@dataDir@@/gencode.dmp --merged @@dataDir@@/merged.dmp --verbose</pluginArgs>
  </datasetLoader>
  </datasetClass>

  <datasetClass class="temporaryTaxon" category="" datasetFileHint="">
    <purpose></purpose>
    <datasetLoader datasetName="temporaryTaxon_RSRC" version="TODAY"
                   plugin="GUS::Supported::Plugin::LoadTemporaryTaxon"
                   scope="global"
                   type="sres"
    >
      <unpack>$currDir=`pwd`; cd @@dataDir@@ ; git clone git@github.com:VEuPathDB/ApiCommonDatasets.git ; cd $currDir</unpack>
      <unpack>extractTemporaryTaxaFromDatasets --inputDir @@dataDir@@/ApiCommonDatasets/Datasets/lib/xml --outputFile @@dataDir@@/organismsWithTempIds.txt</unpack>
      <pluginArgs>--inputFile @@dataDir@@/organismsWithTempIds.txt </pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="gadm" category="" datasetFileHint="">
    <purpose></purpose>
  <datasetLoader datasetName="gadm_RSRC" version="410"
                 plugin="ApiCommonData::Load::Plugin::LoadNothing"
                 scope="global"
                 type="sres"
                 >
    <wgetArgs url="https://geodata.ucdavis.edu/gadm/gadm4.1/gadm_410-gpkg.zip">--accept=@@dataDir@@/gadm_410-gpkg.zip --continue --connect-timeout=120</wgetArgs>
    <unpack>unzip -d @@dataDir@@ @@dataDir@@/gadm_410-gpkg.zip</unpack>
    <unpack>loadGadm.bash @@dataDir@@ gadm @@gadmPort@@ @@dataDir@@/gadm_410.gpkg</unpack>
    <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
  </datasetLoader>
  </datasetClass>

  <datasetClass class="gadmForProject" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>   
  <datasetLoader datasetName="${projectName}_gadm_RSRC" version="410"
                 plugin="ApiCommonData::Load::Plugin::LoadNothing"
                 scope="global"
                 type="sres"
                 >
    <wgetArgs url="https://geodata.ucdavis.edu/gadm/gadm4.1/gadm_410-gpkg.zip">--accept=@@dataDir@@/gadm_410-gpkg.zip</wgetArgs>
    <unpack>unzip -d @@dataDir@@ @@dataDir@@/gadm_410-gpkg.zip</unpack>
    <unpack>loadGadm.bash @@dataDir@@ gadm @@gadmPort@@ @@dataDir@@/gadm_410.gpkg</unpack>
    <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
  </datasetLoader>
  </datasetClass>


  <datasetClass class="updatePDBTaxon" category="" datasetFileHint="">
    <purpose></purpose>
  <datasetLoader datasetName="updatePDBTaxon_RSRC" version="TODAY"
      plugin="ApiCommonData::Load::Plugin::UpdateTaxonFieldFromFile"
              scope="global"
              type="external_sequences"
              >
    <wgetArgs url="ftp://ftp.wwpdb.org/pub/pdb/derived_data/index/source.idx">--tries=5 --mirror --no-parent --no-directories --no-host-directories --cut-dirs=4 --output-document=@@dataDir@@/source.idx</wgetArgs>
    <unpack>processSourceIdxFile --inFile @@dataDir@@/source.idx --outFile @@dataDir@@/source.idx.processed</unpack>
    <pluginArgs>--fileName @@dataDir@@/source.idx.processed --sourceIdRegex  '^(\w+)' --taxonNameRegex '^\w+\s+(.+)' --sourceIdSubstringLength 4  --extDbRlsName 'PDBProteinSequences_RSRC'  --tableName 'DoTS::ExternalAASequence'</pluginArgs>
  </datasetLoader>
  </datasetClass>

  <datasetClass class="sequenceOntology" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>
  <datasetLoader datasetName="SO_RSRC" version="${version}"
              plugin="GUS::Supported::Plugin::InsertSequenceOntologyOBO"
              scope="global"
              type="sres"
              >
    <manualGet fileOrDir="common/ontology/sequenceOntology/${version}/final/so.obo">
        <dir name="final">
        </dir>
    </manualGet>
    <pluginArgs>--inputFile @@dataDir@@/so.obo --extDbRlsSpec "SO_RSRC|${version}"</pluginArgs>
  </datasetLoader>
  </datasetClass>




  <datasetClass class="ontologyRelationshipTypes" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>   
  <datasetLoader datasetName="Ontology_Relationship_Types_RSRC" version="${version}"
              plugin="GUS::Supported::Plugin::InsertOntologyRelationshipType"
              scope="global"
              type="sres"
              >
    <manualGet fileOrDir="common/ontology/Mged/${version}/final/MgedOntologyRelationshipTypes.tab">
        <dir name="final">
        </dir>
      </manualGet>
    <pluginArgs>--inputFile @@dataDir@@/MgedOntologyRelationshipTypes.tab  --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%'</pluginArgs>
  </datasetLoader>
  </datasetClass>

  <datasetClass class="ontologyRelationshipTypesForProject" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>   
    <prop name="projectName">&projectName;</prop>   
  <datasetLoader datasetName="${projectName}_Ontology_Relationship_Types_RSRC" version="${version}"
              plugin="GUS::Supported::Plugin::InsertOntologyRelationshipType"
              scope="global"
              type="sres"
              >
    <manualGet fileOrDir="common/ontology/Mged/${version}/final/MgedOntologyRelationshipTypes.tab">
        <dir name="final">
        </dir>
      </manualGet>
    <pluginArgs>--inputFile @@dataDir@@/MgedOntologyRelationshipTypes.tab  --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%'</pluginArgs>
  </datasetLoader>
  </datasetClass>



  <datasetClass class="ISA" category="" datasetFileHint="">
    <purpose></purpose>

  <datasetLoader datasetName="ISA_RSRC" version="trunk"
              plugin="ApiCommonData::Load::Plugin::InsertInvestigations"
              scope="global"
              >

    <manualGet fileOrDir="common/empty"/>
    <unpack>ga ApiCommonData::Load::Plugin::Report::CheckInvestigations --metaDataRoot @@gusHome@@/metadata/ApiCommonMetadataRepository/ISA/ --investigationBaseName i_Investigation.txt --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%'</unpack>

    <pluginArgs>--metaDataRoot  @@gusHome@@/metadata/ApiCommonMetadataRepository/ISA/ --investigationBaseName i_Investigation.txt --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%'</pluginArgs>
  </datasetLoader>

  </datasetClass>




  <datasetClass class="ISASimple" category="" datasetFileHint="">
    <purpose></purpose>

  <datasetLoader datasetName="ISASimple_RSRC" version="trunk"
              plugin="ApiCommonData::Load::Plugin::InsertInvestigations"
              scope="global"
              >

    <manualGet fileOrDir="common/empty"/>
    <unpack>ga ApiCommonData::Load::Plugin::Report::CheckInvestigations --metaDataRoot @@gusHome@@/metadata/ApiCommonMetadataRepository/ISA/ --investigationBaseName i_Investigation.xml --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%' --isSimpleConfiguration 1 --ontologyMappingFile @@gusHome@@/config/ontologyMappings.xml --ontologyMappingOverrideFileBaseName ontologyMappingOverride.xml --valueMappingFile @@gusHome@@/config/valueMappings.xml</unpack>

    <pluginArgs>--metaDataRoot  @@gusHome@@/metadata/ApiCommonMetadataRepository/ISA/ --investigationBaseName i_Investigation.xml --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%' --isSimpleConfiguration 1 --ontologyMappingFile @@gusHome@@/config/ontologyMappings.xml --ontologyMappingOverrideFileBaseName ontologyMappingOverride.xml --valueMappingFile @@gusHome@@/config/valueMappings.xml</pluginArgs>
  </datasetLoader>

  </datasetClass>

  <datasetClass class="ISASimpleMicrobiome" category="" datasetFileHint="">
    <purpose></purpose>

  <datasetLoader datasetName="ISASimple_RSRC" version="trunk"
              plugin="ApiCommonData::Load::Plugin::InsertInvestigations"
              scope="global"
              >

    <manualGet fileOrDir="common/empty"/>
    <unpack>ga ApiCommonData::Load::Plugin::Report::CheckInvestigations --metaDataRoot @@gusHome@@/metadata/ApiCommonMetadataRepository/ISA/ --investigationBaseName i_Investigation.xml --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%' --isSimpleConfiguration 1 --ontologyMappingFile @@gusHome@@/config/ontologyMappingsMicrobiome.xml --ontologyMappingOverrideFileBaseName ontologyMappingOverride.xml --valueMappingFile @@gusHome@@/config/valueMappingsMicrobiome.txt</unpack>

    <pluginArgs>--metaDataRoot  @@gusHome@@/metadata/ApiCommonMetadataRepository/ISA/ --investigationBaseName i_Investigation.xml --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%' --isSimpleConfiguration 1 --ontologyMappingFile @@gusHome@@/config/ontologyMappingsMicrobiome.xml --ontologyMappingOverrideFileBaseName ontologyMappingOverride.xml  --valueMappingFile @@gusHome@@/config/valueMappingsMicrobiome.txt</pluginArgs>
  </datasetLoader>

  </datasetClass>


   <datasetClass class="genericProfilesClinEpi" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="technologyType">currently supported values are: zscore or percentile</prop>

    <graphTemplateFile name="clinepiRoot.xml"/>
   
    <datasetLoader datasetName="Profile_${technologyType}_${name}_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::LoadNothing"
              type="generic_profiles"
              subType="${technologyType}"
              scope="global">

      <manualGet fileOrDir="${projectName}/profile/${name}/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>
      <getAndUnpackOutput dir="@@dataDir@@/final"/>
      <getAndUnpackOutput file="@@dataDir@@/final/analysisConfig.xml"/>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>




  <datasetClass class="ISASimpleClinEpi" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="subProjectName"></prop>
    <prop name="groupName"></prop>
    <prop name="studyName"></prop>
    <prop name="version"></prop>
    <prop name="webDisplayOntologyName"></prop>
    <prop name="nameForFilenames"></prop>

    <graphTemplateFile name="clinepiRoot.xml"/>

    <datasetLoader datasetName="ISASimple_${subProjectName}_${groupName}_${studyName}_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="global"
              >

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <unpack>ln -s @@manualDeliveryDir@@/${projectName}/${subProjectName}/${groupName}/${studyName}/${version}/final/ @@dataDir@@/final</unpack>

      <getAndUnpackOutput dir="@@dataDir@@/final" />

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs> 
<!--
      <pluginArgs>::metaDataRoot @@dataDir@@ ::investigationBaseName investigation.xml ::extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%' ::isSimpleConfiguration 1 ::ontologyMappingFile @@dataDir@@/final/ontologyMapping.xml ::ontologyMappingOverrideFileBaseName ontologyMappingOverride.xml ::valueMappingFile @@dataDir@@/final/valueMap.txt ::dateObfuscationFile @@dataDir@@/final/dateObfuscation.txt</pluginArgs>
-->
    </datasetLoader>

  </datasetClass>

  <datasetClass class="MBioNF" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="subProjectName"></prop>
    <prop name="groupName"></prop>
    <prop name="studyName"></prop>
    <prop name="version"></prop>
    <prop name="webDisplayOntologyName"></prop>
    <prop name="nameForFilenames"></prop>

    <graphTemplateFile name="microbiomeRootEda.xml"/>

    <datasetLoader datasetName="MicrobiomeStudyEDA_${studyName}_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="global"
              >

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <unpack>ln -s @@manualDeliveryDir@@/${projectName}/${subProjectName}/${groupName}/${studyName}/${version}/final/ @@dataDir@@/final</unpack>
      <unpack>if test -e @@dataDir@@/final/owlOverride.csv ; then getEntityAttributesFromOwl.pl -x @@dataDir@@/final/owlOverride.csv > @@dataDir@@/owlAttributes.txt; fi</unpack>

      <unpack>
        <!-- # merge owlAttributes, entities, ordinals into @@dataDir/annotationProperties.txt -->
          mergeAnnotationProperties -f @@dataDir@@/owlAttributes.txt @@dataDir@@/final/ @@dataDir@@/annotationProperties.txt
      </unpack>

      <getAndUnpackOutput dir="@@dataDir@@/final" />

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs> 
    </datasetLoader>

  </datasetClass>
  <datasetClass class="ISASimpleNF" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="subProjectName"></prop>
    <prop name="groupName"></prop>
    <prop name="studyName"></prop>
    <prop name="version"></prop>
    <prop name="webDisplayOntologyName"></prop>
    <prop name="nameForFilenames"></prop>

    <graphTemplateFile name="clinepiRoot.xml"/>

    <datasetLoader datasetName="ISASimple_${subProjectName}_${groupName}_${studyName}_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="global"
              >

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <unpack>ln -s @@manualDeliveryDir@@/${projectName}/${subProjectName}/${groupName}/${studyName}/${version}/final/ @@dataDir@@/final</unpack>

      <unpack>
        <!-- # merge owlAttributes, entities, ordinals into @@dataDir/annotationProperties.txt -->
          mergeAnnotationProperties @@dataDir@@/final/ @@dataDir@@/annotationProperties.txt
      </unpack>

      <getAndUnpackOutput dir="@@dataDir@@/final" />

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs> 
    </datasetLoader>

  </datasetClass>

  <datasetClass class="ISASimpleClinEpiPreview" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="subProjectName"></prop>
    <prop name="groupName"></prop>
    <prop name="studyName"></prop>
    <prop name="version"></prop>

    <graphTemplateFile name="clinepiRoot.xml"/>

  <datasetLoader datasetName="ISASimple_${subProjectName}_${groupName}_${studyName}_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="global"
              >


      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <unpack>ln -s @@manualDeliveryDir@@/${projectName}/${subProjectName}/${groupName}/${studyName}/${version}/final/ @@dataDir@@/final</unpack>

      <getAndUnpackOutput dir="@@dataDir@@/final" />

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs> 
  </datasetLoader>

  </datasetClass>

  <datasetClass class="ClinEpiStudyCharacteristics" category="" datasetFileHint="">
  <!-- not currently used (moved to ClinEpiWorkflow template) but left here in case it might be used later -->
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="subProjectName"></prop>
    <prop name="groupName"></prop>
    <prop name="studyName"></prop>
    <prop name="version"></prop>

    <graphTemplateFile name="clinepiRoot.xml"/>

  <datasetLoader datasetName="${subProjectName}_${groupName}_${studyName}_studyCharacteristics_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::InsertStudyCharacteristics"
              scope="global"
              >


      <manualGet fileOrDir="${projectName}/${subProjectName}/${groupName}/${studyName}/${version}/final/studyCharacteristics.txt">
        <dir name="final">
        </dir>
      </manualGet>
      <getAndUnpackOutput dir="@@dataDir@@/studyCharacteristics.txt" />

    <pluginArgs>--file @@dataDir@@/studyCharacteristics.txt --extDbRlsSpec 'ISASimple_${subProjectName}_${groupName}_${studyName}_RSRC|${version}' </pluginArgs>
  </datasetLoader>

  </datasetClass>

  <datasetClass class="dumpMissingGenbankIsolateMappers" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>

    <datasetLoader datasetName="DumpMissingGenbankIsolateMappers_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
	      scope="global"
              >
      <manualGet fileOrDir="common/ontology/genbankIsolatesOntologySynonyms/${version}/final/synonyms.txt">
        <dir name="final">
        </dir>
      </manualGet>

    <unpack>dumpUnmappedIsolateMappers.pl --prev_mapped_file @@dataDir@@/synonyms.txt --output_file @@dataDir@@/unmapped.txt --gusConfigFile @@gusHome@@/config/gus.config</unpack>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>	  
    </datasetLoader>
  </datasetClass>

  <datasetClass class="CrossStudy" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>

    <datasetLoader datasetName="CrossStudy_RSRC" version="dontcare"
              plugin="ApiCommonData::Load::Plugin::LoadNothing"
              type="population_biology"
              scope="dontcare"
              >
      <manualGet fileOrDir="${projectName}/common/CrossStudy/dontcare/final/dontcare.txt">
        <dir name="final">
        </dir>
      </manualGet>
   
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs> 
    </datasetLoader>    
  </datasetClass>

  <!-- will eventually turn into sunbeam -->
  <datasetClass class="snakemakeTest" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="projectName">&projectName;</prop>

    <graphTemplateFile name="microbiomeRoot.xml"/>

    <datasetLoader datasetName="snakemake_${name}_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::LoadNothing"
              type="population_biology"
              scope="global"
            >

      <manualGet fileOrDir="${projectName}/common/${name}/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>
      <getAndUnpackOutput dir="@@dataDir@@/final"/>
      <getAndUnpackOutput file="@@dataDir@@/final/analysisConfig.xml"/>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>

  <datasetClass class="DADA2Taxonomy" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>
    <prop name="projectName">&projectName;</prop>

    <datasetLoader datasetName="DADA2Taxonomy_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="dontcare"
              >
      <manualGet fileOrDir="${projectName}/common/DADA2Taxonomy/${version}/final/DADA2Taxonomy_trainSet.fa.gz">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="OverrideTaxonMapping" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="projectName">&projectName;</prop>

    <datasetLoader datasetName="OverrideTaxonMapping_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="dontcare"
              >
      <manualGet fileOrDir="${projectName}/common/curatedTaxonomy/${name}/${version}/final/taxonMapping.xml">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="oboOntology" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="name">&name;</prop>

    <graphTemplateFile name="oboOntologies.xml"/>

    <datasetLoader datasetName="OBO_Ontology_${name}_RSRC" version="dontcare"
                   plugin="GUS::Supported::Plugin::InsertOntologyTermsAndRelationships"
                   scope="global"
                   type="sres"
                   >
      <wgetArgs url="http://purl.obolibrary.org/obo/${name}.owl">--tries=5 --no-directories --no-host-directories --accept=@@dataDir@@/${name}.owl </wgetArgs>
      <pluginArgs>--inFile @@dataDir@@/${name}.owl --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%' --relTypeExtDbRlsSpec 'Ontology_Relationship_Types_RSRC|%'</pluginArgs>
    </datasetLoader>
  </datasetClass>













<!--This dataset class is created for IDO only. We don't need to load IDO. Only one term in IDO was used in the annotation and this term is available in the EuPath ontology. -->
  <datasetClass class="oboOntologyDummy" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="name">&name;</prop>
    <prop name="url"/>

    <graphTemplateFile name="oboOntologies.xml"/>

    <datasetLoader datasetName="OBO_Ontology_${name}_RSRC" version="dontcare"
                   plugin="ApiCommonData::Load::Plugin::LoadNothing"
                   scope="global"
                   type="sres"
                   >
    <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
    </manualGet>
    
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="OBO_Ontology_fma" category="" datasetFileHint="">
    <purpose></purpose>

  <datasetLoader datasetName="OBO_Ontology_fma_RSRC" version="dontcare"
              plugin="GUS::Supported::Plugin::InsertOntologyTermsAndRelationships"
              scope="global"
              type="sres"
              >

      <wgetArgs url="http://purl.obolibrary.org/obo/fma.owl">--tries=5 --no-directories --no-host-directories --accept=@@dataDir@@/fma.owl </wgetArgs>
      <pluginArgs>--inFile @@dataDir@@/fma.owl --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%' --relTypeExtDbRlsSpec 'Ontology_Relationship_Types_RSRC|%'</pluginArgs>
  </datasetLoader>

  </datasetClass>

  <datasetClass class="updateOboOntologyFma" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="isPreferred"></prop>

    <datasetLoader datasetName="OBO_Ontology_INTERNAL_fma_RSRC" version="dontcare"
                   plugin="GUS::Supported::Plugin::InsertOntologyTermsAndRelationships"
                   scope="global"
                   type="sres"
                   >
      <wgetArgs url="http://purl.obolibrary.org/obo/fma.owl">--tries=5 --no-directories --no-host-directories --accept=@@dataDir@@/fma.owl </wgetArgs>
      <unpack>deleteOntologyRelsAndSynsFromExtDBName.pl --externalDatabaseName 'OBO_Ontology_fma_RSRC' --gusConfigFile @@gusHome@@/config/gus.config</unpack>
      <pluginArgs>--inFile @@dataDir@@/fma.owl --extDbRlsSpec 'OBO_Ontology_fma_RSRC|dontcare' --relTypeExtDbRlsSpec 'Ontology_Relationship_Types_RSRC|%' --isPreferred ${isPreferred}</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="OBO_Ontology_efo" category="" datasetFileHint="">
    <purpose></purpose>

  <datasetLoader datasetName="OBO_Ontology_efo_RSRC" version="dontcare"
              plugin="GUS::Supported::Plugin::InsertOntologyTermsAndRelationships"
              scope="global"
              type="sres"
              >

      <wgetArgs url="http://www.ebi.ac.uk/efo/efo.owl">--tries=5 --no-directories --no-host-directories --accept=@@dataDir@@/efo.owl </wgetArgs>
      <pluginArgs>--inFile @@dataDir@@/efo.owl --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%' --relTypeExtDbRlsSpec 'Ontology_Relationship_Types_RSRC|%'</pluginArgs>
  </datasetLoader>

  </datasetClass>

  <datasetClass class="updateOboOntologyEfo" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="isPreferred"></prop>

    <graphTemplateFile name="updateOntologies.xml"/>

    <datasetLoader datasetName="OBO_Ontology_INTERNAL_efo_RSRC" version="dontcare"
                   plugin="GUS::Supported::Plugin::InsertOntologyTermsAndRelationships"
                   scope="global"
                   type="sres"
                   >
      <wgetArgs url="http://www.ebi.ac.uk/efo/efo.owl">--tries=5 --no-directories --no-host-directories --accept=@@dataDir@@/efo.owl </wgetArgs>
      <unpack>deleteOntologyRelsAndSynsFromExtDBName.pl --externalDatabaseName 'OBO_Ontology_efo_RSRC' --gusConfigFile @@gusHome@@/config/gus.config</unpack>
      <pluginArgs>--inFile @@dataDir@@/efo.owl --extDbRlsSpec 'OBO_Ontology_efo_RSRC|dontcare' --relTypeExtDbRlsSpec 'Ontology_Relationship_Types_RSRC|%' --isPreferred ${isPreferred}</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="ontologyFromTabDelim" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="eupathCuratedOntologies.xml"/>

    <datasetLoader datasetName="Ontology_${name}_RSRC" version="${version}"
                   plugin="GUS::Supported::Plugin::InsertOntologyFromTabDelim"
                   scope="global"
                   type="sres"
                   >

      <manualGet fileOrDir="common/ontology/${name}TabDelim/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>

      <getAndUnpackOutput dir="@@dataDir@@/final"/>
      <getAndUnpackOutput file="@@dataDir@@/final/terms.txt"/>
      <getAndUnpackOutput file="@@dataDir@@/final/relationships.txt"/>

      <pluginArgs>--termFile @@dataDir@@/final/terms.txt --relFile @@dataDir@@/final/relationships.txt --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%'</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="ontologyFromTabDelimForProject" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="name">&name;</prop>
    <prop name="projectName">&projectName;</prop>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="eupathCuratedOntologies.xml"/>

    <datasetLoader datasetName="${projectName}_Ontology_${name}_RSRC" version="${version}"
                   plugin="GUS::Supported::Plugin::InsertOntologyFromTabDelim"
                   scope="global"
                   type="sres"
                   >

      <manualGet fileOrDir="common/ontology/${name}TabDelim/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>

      <getAndUnpackOutput dir="@@dataDir@@/final"/>
      <getAndUnpackOutput file="@@dataDir@@/final/terms.txt"/>
      <getAndUnpackOutput file="@@dataDir@@/final/relationships.txt"/>

      <pluginArgs>--termFile @@dataDir@@/final/terms.txt --relFile @@dataDir@@/final/relationships.txt --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%'</pluginArgs>
    </datasetLoader>
  </datasetClass>

<datasetClass class="ontologyFromOWL" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="name">&name;</prop>
    <prop name="version"/>

    <graphTemplateFile name="eupathCuratedOntologies.xml"/>

    <datasetLoader datasetName="Ontology_${name}_RSRC" version="dontcare"
                   plugin="GUS::Supported::Plugin::InsertOntologyTermsAndRelationships"
                   scope="global"
                   type="sres"
                   >

      <manualGet fileOrDir="common/ontology/${name}OWL/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>

      <getAndUnpackOutput dir="@@dataDir@@/final"/>
       <pluginArgs>--inFile @@dataDir@@/final/${name}.owl --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%' --relTypeExtDbRlsSpec 'Ontology_Relationship_Types_RSRC|%'</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="updateOboOntology" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="name">&name;</prop>
    <prop name="isPreferred"></prop>

    <graphTemplateFile name="updateOntologies.xml"/>

    <datasetLoader datasetName="OBO_Ontology_INTERNAL_${name}_RSRC" version="dontcare"
                   plugin="GUS::Supported::Plugin::InsertOntologyTermsAndRelationships"
                   scope="global"
                   type="sres"
                   >
      <wgetArgs url="http://purl.obolibrary.org/obo/${name}.owl">--tries=5 --no-directories --no-host-directories --accept=@@dataDir@@/${name}.owl </wgetArgs>
      <unpack>deleteOntologyRelsAndSynsFromExtDBName.pl --externalDatabaseName 'OBO_Ontology_${name}_RSRC' --gusConfigFile @@gusHome@@/config/gus.config</unpack>
      <pluginArgs>--inFile @@dataDir@@/${name}.owl --extDbRlsSpec 'OBO_Ontology_${name}_RSRC|dontcare' --relTypeExtDbRlsSpec 'Ontology_Relationship_Types_RSRC|%' --isPreferred ${isPreferred}</pluginArgs>
    </datasetLoader>
  </datasetClass>
  
  <datasetClass class="updateOntologyFromTabDelim" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="isPreferred"></prop>

    <graphTemplateFile name="updateOntologies.xml"/>

    <datasetLoader datasetName="Ontology_INTERNAL_${name}_RSRC" version="${version}"
                   plugin="GUS::Supported::Plugin::InsertOntologyFromTabDelim"
                   scope="global"
                   type="sres"
                   >

      <manualGet fileOrDir="common/ontology/${name}TabDelim/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>

      <unpack>deleteOntologyRelsAndSynsFromExtDBName.pl --externalDatabaseName 'Ontology_${name}_RSRC' --gusConfigFile @@gusHome@@/config/gus.config</unpack>

      <getAndUnpackOutput dir="@@dataDir@@/final"/>
      <getAndUnpackOutput file="@@dataDir@@/final/terms.txt"/>
      <getAndUnpackOutput file="@@dataDir@@/final/relationships.txt"/>

      <pluginArgs>--termFile @@dataDir@@/final/terms.txt --relFile @@dataDir@@/final/relationships.txt --extDbRlsSpec 'Ontology_${name}_RSRC|%' --isPreferred ${isPreferred}</pluginArgs>
    </datasetLoader>
  </datasetClass>


<datasetClass class="updateOntologyFromOWL" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="name">&name;</prop>
    <prop name="version"/>
    <prop name="isPreferred"></prop>

    <graphTemplateFile name="updateOntologies.xml"/>

    <datasetLoader datasetName="Ontology_INTERNAL_${name}_RSRC" version="dontcare"
                   plugin="GUS::Supported::Plugin::InsertOntologyTermsAndRelationships"
                   scope="global"
                   type="sres"
                   >

      <manualGet fileOrDir="common/ontology/${name}OWL/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>

      <unpack>deleteOntologyRelsAndSynsFromExtDBName.pl --externalDatabaseName 'Ontology_${name}_RSRC' --gusConfigFile @@gusHome@@/config/gus.config</unpack>

      <getAndUnpackOutput dir="@@dataDir@@/final"/>
       <pluginArgs>--inFile @@dataDir@@/final/${name}.owl --extDbRlsSpec 'Ontology_${name}_RSRC|%' --relTypeExtDbRlsSpec 'Ontology_Relationship_Types_RSRC|%' --isPreferred ${isPreferred}</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="updateEupathOntologyTerms" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>
    <prop name="isPreferred"></prop>

    <datasetLoader datasetName="OntologyTerm_INTERNAL_EuPath_RSRC" version="dontcare"
                   plugin="GUS::Supported::Plugin::InsertOntologyTermsAndRelationships"
                   scope="global"
                   type="sres"
                   >
      <wgetArgs url="http://purl.obolibrary.org/obo/eupath.owl">--tries=5 --no-directories --no-host-directories --accept=@@dataDir@@/eupath.owl </wgetArgs>
      <unpack>deleteOntologyRelsAndSynsFromExtDBName.pl --externalDatabaseName 'OntologyTerm_EuPath_RSRC' --gusConfigFile @@gusHome@@/config/gus.config</unpack>
      <pluginArgs>--inFile @@dataDir@@/eupath.owl --owlReader ApiCommonData::Load::OwlReader --extDbRlsSpec 'OntologyTerm_EuPath_RSRC|dontcare' --relTypeExtDbRlsSpec 'Ontology_Relationship_Types_RSRC|%' --isPreferred ${isPreferred}</pluginArgs>
    </datasetLoader>
  </datasetClass>




  <datasetClass class="UpdateWebDisplayOntologyClinEpi" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="version">&version;</prop>
    <prop name="name">&name;</prop>
    <prop name="isPreferred"></prop>

    <graphTemplateFile name="clinepiRoot.xml"/>

    <datasetLoader datasetName="OntologyTerm_INTERNAL_${name}_RSRC" version="dontcare"
                   plugin="GUS::Supported::Plugin::InsertOntologyTermsAndRelationships"
                   scope="global"
                   type="sres"
                   >

    <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
    </manualGet>

      <unpack>deleteOntologyRelsAndSynsFromExtDBName.pl --externalDatabaseName 'OntologyTerm_${name}_RSRC' --gusConfigFile @@gusHome@@/config/gus.config</unpack>
      <pluginArgs>--inFile @@gusHome@@/ontology/release/${version}/${name}.owl --owlReader ApiCommonData::Load::OwlReader --extDbRlsSpec 'OntologyTerm_${name}_RSRC|dontcare' --relTypeExtDbRlsSpec 'Ontology_Relationship_Types_RSRC|%' --isPreferred ${isPreferred}</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="updateRepositoryOntologyTerms" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>
    <prop name="name">&name;</prop>
    <prop name="isPreferred"></prop>

    <graphTemplateFile name="updateOntologies.xml"/>

    <datasetLoader datasetName="OntologyTerm_INTERNAL_${name}_RSRC" version="dontcare"
                   plugin="GUS::Supported::Plugin::InsertOntologyTermsAndRelationships"
                   scope="global"
                   type="sres"
                   >

    <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
    </manualGet>

      <unpack>deleteOntologyRelsAndSynsFromExtDBName.pl --externalDatabaseName 'OntologyTerm_${name}_RSRC' --gusConfigFile @@gusHome@@/config/gus.config</unpack>
      <pluginArgs>--inFile @@gusHome@@/ontology/release/${version}/${name}.owl --owlReader ApiCommonData::Load::OwlReader --extDbRlsSpec 'OntologyTerm_${name}_RSRC|dontcare' --relTypeExtDbRlsSpec 'Ontology_Relationship_Types_RSRC|%' --isPreferred ${isPreferred}</pluginArgs>
    </datasetLoader>
  </datasetClass>



  <datasetClass class="ontologySynonyms" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="name">&name;</prop> <!-- genbankIsolates, eupathDisplay --> 
    <prop name="version">&version;</prop>

    <graphTemplateFile name="ontologySynonyms.xml"/>

    <datasetLoader datasetName="Ontology_Synonyms_${name}_RSRC" version="${version}"
                   plugin="GUS::Supported::Plugin::InsertOntologySynonym"
                   scope="global"
                   type="sres"
                   >

      <manualGet fileOrDir="common/ontology/${name}OntologySynonyms/${version}/final/synonyms.txt">
        <dir name="final">
        </dir>
      </manualGet>

      <getAndUnpackOutput file="@@dataDir@@/synonyms.txt"/>

      <pluginArgs>--infile @@dataDir@@/synonyms.txt --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%'</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="geneOntologyEvidenceCodes" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>
  <datasetLoader datasetName="GO_evidence_codes_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::InsertGOEvidenceCodesFromObo"
              scope="global"
              type="sres"
              >
    <manualGet fileOrDir="common/ontology/goEvidenceCodes/${version}/final/evidence_code.obo">
        <dir name="final">
        </dir>
    </manualGet>
    <pluginArgs>--oboFile @@dataDir@@/evidence_code.obo --extDbRlsSpec 'GO_evidence_codes_RSRC|${version}'</pluginArgs>
  </datasetLoader>
  </datasetClass>

  <!-- the interpro data must be installed manually on the cluster -->
  <datasetClass class="interproscanData" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>
  <datasetLoader datasetName="InterproscanData_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::InsertInterproDomainDbs"
              scope="global"
              type="external_sequences"
              >

    <manualGet fileOrDir="common/domain/iprscanData/${version}/iprscan">
        <dir name="final">
        </dir>
      </manualGet>

    <unpack>fixSuperfamily @@dataDir@@/iprscan/data/</unpack>
    <pluginArgs>--inPath @@dataDir@@/iprscan/data/</pluginArgs>
  </datasetLoader>
  </datasetClass>

  <datasetClass class="NRDB" category="" datasetFileHint="">
    <purpose></purpose>
  <datasetLoader datasetName="NRDB_RSRC" version="TODAY"
      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="global"
              type="external_sequences"
              >
    <wgetArgs url="ftp://ftp.ncbi.nih.gov/blast/db/FASTA/">--tries=5 --mirror --no-parent --no-directories --no-host-directories --cut-dirs=3 --accept=nr.gz </wgetArgs>
    <unpack>gunzip @@dataDir@@/nr.gz </unpack>
    <unpack>shortenDefLine --inputFile @@dataDir@@/nr --outputFile @@dataDir@@/nrdb-short-defline.fsa.tmp</unpack>
    <unpack><![CDATA[cat @@dataDir@@/nrdb-short-defline.fsa.tmp | perl -e 'while(<>) { s/J|O/X/g if /^[^>]/; print;}' > @@dataDir@@/nrdb-short-defline.fsa]]></unpack>
    <unpack>rm @@dataDir@@/nrdb-short-defline.fsa.tmp</unpack> 
    <unpack><![CDATA[cat @@dataDir@@/nrdb-short-defline.fsa | perl -e '$flag=0; while(<>){if ($_ =~ />/){if ($_ =~ /sp\|/){$flag=1;}else{$flag=0;}} if ($flag == 1){ print;}}'> @@dataDir@@/nrdb-short-defline-sp.fsa]]></unpack>
    <getAndUnpackOutput file="@@dataDir@@/nrdb-short-defline-sp.fsa"/>
    <getAndUnpackOutput file="@@dataDir@@/nrdb-short-defline.fsa"/>
    <getAndUnpackOutput file="@@dataDir@@/nr"/>
    <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
  </datasetLoader>
  </datasetClass>

  <datasetClass class="blatAlignmentQuality" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>
  <datasetLoader datasetName="blatAlignmentQuality_RSRC" version="${version}"
              plugin="GUS::Supported::Plugin::LoadGusXml"
              scope="global"
              type="sres"
              >
    <manualGet fileOrDir="common/ontology/alignmentQuality/${version}/final/blatalignmentquality.xml">
        <dir name="final">
        </dir>
      </manualGet>
    <pluginArgs>--filename @@dataDir@@/blatalignmentquality.xml</pluginArgs>
  </datasetLoader>
  </datasetClass>


  <datasetClass class="isolateGeographicLocationGPS" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>

    <datasetLoader datasetName="geographicLocationGPS_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::InsertIsolateGPS"
              scope="global"
              type="sres"
              >
      <manualGet fileOrDir="common/ontology/geographicLocations/${version}/final/countryGPS.txt">
        <dir name="final">
        </dir>
      </manualGet>
      <pluginArgs>--isolateGPSFile @@dataDir@@/countryGPS.txt --extDbRlsSpec 'OntologyTerm_EuPath_RSRC|dontcare'</pluginArgs>
    </datasetLoader>
  </datasetClass>




  <datasetClass class="yeastTwoHybrid" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="organismSpecificMisc.xml"/>
    
    <datasetLoader datasetName="${organismAbbrev}_interaction_${name}_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::InsertYeastTwoHybrid"
              type="interaction"
              scope="organism"
              organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/interaction/${name}/${version}/final/interaction_dataset.txt" >
	<dir name="final">
	</dir>
      </manualGet>
      <pluginArgs>--interactionFile @@dataDir@@/interaction_dataset.txt</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="antiCodon" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="version">&version;</prop>
    <prop name="genomeVersion"/>
    <graphTemplateFile name="organismSpecificMisc.xml"/>
    
    <datasetLoader datasetName="${organismAbbrev}_mRNA_anticodon_RSRC"  version="${version}"
              plugin="ApiCommonData::Load::Plugin::InsertAntiCodon"
       	      scope="organism"
              type="sres"
              organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/mRNA/anticodon/${version}/final/antiCodons.txt" >
     	<dir name="final">
	</dir>
     </manualGet>
     <pluginArgs>--data_file @@dataDir@@/antiCodons.txt --genomeDbName '${organismAbbrev}_primary_genome_RSRC' --genomeDbVer '${genomeVersion}' </pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="relatedNaFeature" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <graphTemplateFile name="organismSpecificMisc.xml"/>
   
    <datasetLoader datasetName="${organismAbbrev}_interaction_${name}_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertRelatedNaFeature"
	      scope="organism"
              type="feature"
	      organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/interaction/${name}/${version}/final/above-2-links">
	<dir name="final">
	</dir>
      </manualGet>
      <pluginArgs>--interactionFile @@dataDir@@/above-2-links --extDbName %DATASET_NAME% --extDbVersion %DATASET_VERSION% --organismAbbrev ${organismAbbrev}</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="phenotype" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <graphTemplateFile name="organismSpecificMisc.xml"/>
   
    <datasetLoader datasetName="${organismAbbrev}_phenotype_${name}_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertPhenotype"
	      scope="organism"
              type="phenotype"
	      organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/phenotype/${name}/${version}/final/phenotype.tab">
	<dir name="final">
	</dir>
      </manualGet>
      <pluginArgs>--inputFile @@dataDir@@/phenotype.tab --extDbName %DATASET_NAME% --extDbVer %DATASET_VERSION% --organismAbbrev ${organismAbbrev}</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="crisprPhenotype" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name"/>
    <prop name="version"/>

    <graphTemplateFile name="genericProfile.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_crisprPhenotype_${name}_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="phenotype"
              organismAbbrev="${organismAbbrev}"
	      >
      
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/phenotype/${name}/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>

      <getAndUnpackOutput dir="@@dataDir@@/final"/>
      <getAndUnpackOutput file="@@dataDir@@/final/analysisConfig.xml"/>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>

    </datasetLoader>
  </datasetClass>


  <datasetClass class="isolateSNPsFromChip" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="platform"/>
    <graphTemplateFile name="SNPs.xml"/>
    
    <datasetLoader datasetName="${organismAbbrev}_SNPChip_${name}_RSRC" version="${version}"
        plugin="ApiCommonData::Load::Plugin::LoadNothing"
        scope="organism"
        type="isolates"
        subType="${platform}"
        allowedSubTypes="Broad_3k_array,Broad_75K_array,Broad_barcode,NIH_10k"
        organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/SNP/${name}/${version}/final/isolateSNPs.txt">
      <dir name="final">
      </dir>
      </manualGet>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass> 


  <datasetClass class="predictedAAFeature" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="category"/>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="genomeVersion"/>
    <graphTemplateFile name="organismSpecificMisc.xml"/>
   
    <datasetLoader datasetName="${organismAbbrev}_${category}_${name}_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertPredictedAAFeature"
              type="aa_feature"
	      scope="organism"
	      organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/${category}/${name}/${version}/final/apFile.txt">
	<dir name="final">
	</dir>
      </manualGet>
      <pluginArgs>--inputFile @@dataDir@@/apFile.txt --extDbRelSpec "%DATASET_NAME%|%DATASET_VERSION%" --seqExtDbRelSpec '${organismAbbrev}_primary_genome_RSRC|${genomeVersion}' --category "secretome" --organismAbbrev ${organismAbbrev}</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="singleMotifMultMappings" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="category"/>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="motif"/>
    <prop name="motifName"/>
    <graphTemplateFile name="organismSpecificMisc.xml"/>
   
    <datasetLoader datasetName="${organismAbbrev}_${category}_${name}_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertSingleMotifMultMappings"
              type="aa_feature"
	      scope="organism"
	      organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/${category}/${name}/${version}/final/singleMotifMultMappings.txt">
	<dir name="final">
	</dir>
      </manualGet>
      <pluginArgs>--inputFile @@dataDir@@/singleMotifMultMappings.txt --motif "${motif}" --motifName "${motifName}" --description "motif" --category "secretome" --extDbRelSpec "%DATASET_NAME%|%DATASET_VERSION%" --seqExtDbRelSpec '${organismAbbrev}_primary_genome_RSRC|${genomeVersion}' --organismAbbrev ${organismAbbrev}</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="geneFeatureLODScores" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <graphTemplateFile name="organismSpecificMisc.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_eQTL_${name}_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::InsertGeneFeatureLODScores"
              type="genetic_mapping"
              scope="organism"
              organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/eQTL/${name}/${version}/final/All_LODscores.txt">
        <dir name="final">
        </dir>
      </manualGet>
      <pluginArgs>--file @@dataDir@@/All_LODscores.txt   --extDbName  "%DATASET_NAME%" --extDbVer "%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>



  <datasetClass class="GFF" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="genomeVersion"/>
    <prop name="gffFormat"/>
    <graphTemplateFile name="organismSpecificMiscNoAlias.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${name}_GFF_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::InsertGFF3"
              type="feature"
              scope="organism"
              organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/gff/${name}/${version}/final/${organismAbbrev}_${name}.gff">
        <dir name="final">
        </dir>
      </manualGet>
      <pluginArgs>--file @@dataDir@@/${organismAbbrev}_${name}.gff  --gff3DbName  "%DATASET_NAME%" --gff3DbVer "%DATASET_VERSION%"  --gffFormat ${gffFormat} --seqExtDbName ${organismAbbrev}_primary_genome_RSRC --seqExtDbRlsVer ${genomeVersion}  --soExtDbSpec "SO_RSRC|%"</pluginArgs>
    </datasetLoader>
  </datasetClass>



  <datasetClass class="GFF_topLevel" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="referenceStrainOrganismAbbrev">&referenceStrainOrganismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="gffFormat"/>
    <graphTemplateFile name="organismSpecificOnTopLevelGenome.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${name}_GFF_topLevel_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::InsertGFF3"
              type="feature"
              scope="organism"
              organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/gff/${name}/${version}/final/${organismAbbrev}_${name}.gff">
        <dir name="final">
        </dir>
      </manualGet>
      <pluginArgs>--file @@dataDir@@/${organismAbbrev}_${name}.gff  --gff3DbName  "%DATASET_NAME%" --gff3DbVer "%DATASET_VERSION%"  --gffFormat ${gffFormat} --seqExtDbName ${organismAbbrev}_primary_genome_RSRC   --soExtDbSpec "SO_RSRC|%"</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="massSpecFromProfiles" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <graphTemplateFile name="organismSpecificMisc.xml"/>
   
    <datasetLoader datasetName="${organismAbbrev}_massSpec_${name}_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::InsertStudyResults"
              type="protein_expression"
              scope="organism"
              organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/massSpec/${name}/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>

      <unpack>doTranscriptExpression.pl --xml_file @@dataDir@@/final/analysisConfig.xml --main_directory @@dataDir@@/final --technology_type protein_expression</unpack>
      <pluginArgs>--inputDir @@dataDir@@/final --configFile @@dataDir@@/final/insert_study_results_config.txt --extDbSpec "%DATASET_NAME%|%DATASET_VERSION%" --studyName "Mass Spec Profiles ${name}"</pluginArgs>
    </datasetLoader>
  </datasetClass>

    <datasetClass class="proteinMicroarrayProfiles" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="genericProfile.xml"/>
   
    <datasetLoader datasetName="${organismAbbrev}_microarrayAntibody_${name}_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::LoadNothing"
              type="putative_function"
              subType="immune_response"
              scope="organism"
              organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/microarrayAntibody/${name}/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>
      <getAndUnpackOutput dir="@@dataDir@@/final"/>
      <getAndUnpackOutput file="@@dataDir@@/final/analysisConfig.xml"/>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>


    <!-- This really should be named "genericStudyResult" it doesn't only apply to profiles -->
    <datasetClass class="genericProfiles" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="technologyType">currently supported values are: array,rnaseq,immune_response,quantitative,rtpcr,phenotype</prop>

    <graphTemplateFile name="genericProfile.xml"/>
   
    <datasetLoader datasetName="${organismAbbrev}_${technologyType}_${name}_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::LoadNothing"
              type="generic_profiles"
              subType="${technologyType}"
              scope="organism"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genericProfile/${name}/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>
      <getAndUnpackOutput dir="@@dataDir@@/final"/>
      <getAndUnpackOutput file="@@dataDir@@/final/analysisConfig.xml"/>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>

  <datasetClass class="quantitativeMassSpecProfiles" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name"/>
    <prop name="version"/>
    <prop name="hasTimeSeries"/>

    <graphTemplateFile name="genericProfile.xml"/>
   
    <datasetLoader datasetName="${organismAbbrev}_quantitativeMassSpec_${name}_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::LoadNothing"
              type="protein_expression"
              subType="quantitative"
              scope="organism"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/quantitativeMassSpec/${name}/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>
      <getAndUnpackOutput dir="@@dataDir@@/final"/>
      <getAndUnpackOutput file="@@dataDir@@/final/analysisConfig.xml"/>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>
  <datasetClass class="phylogeneticProfiles" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="version">&version;</prop>
    <prop name="threshold"/>
    <graphTemplateFile name="organismSpecificMisc.xml"/>
    <datasetLoader datasetName="${organismAbbrev}_phylogeny_phylogeneticProfiles_RSRC" version="${version}"
            plugin="GUS::Community::Plugin::InsertPhylogeneticProfiles"
            type="orthology"
            scope="organism"
            organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/phylogeny/PhylogeneticProfiles/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>
      <pluginArgs>--ProfileSetDescription 'the phylogenetic profiles for ${organismAbbrev}' --headerFile @@dataDir@@/final/taxonNameHeaders --profilesDataFile @@dataDir@@/final/phylogenetic-profiles-any-and-target-organism.gz --mutualInformationDataFile @@dataDir@@/final/phylogenetic-profiles-any-and-target-organism.muinfo.gz --tolerateMissingIds 1 --dontLoadScores --threshold "${threshold}" --organismAbbrev ${organismAbbrev}</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="ChromosomeColors" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="organismSpecificMisc.xml"/>
    
    <datasetLoader datasetName="${organismAbbrev}_ChromosomeColors_${name}_RSRC" version="${version}"
        plugin="ApiCommonData::Load::Plugin::InsertRodentChrColors"
        type="genome"
        scope="organism"
        organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/comparativeGenomics/${name}/${version}/final/RMP_Pf_fromKooij.txt">
      <dir name="final">
      </dir>
      </manualGet>
      <pluginArgs>--mappingFile @@dataDir@@/RMP_Pf_fromKooij.txt</pluginArgs>
    </datasetLoader>
  </datasetClass> 


  <datasetClass class="pfalLocationsWithSqlLdr" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <graphTemplateFile name="organismSpecificMiscNoAlias.xml"/>
    
    <datasetLoader datasetName="${organismAbbrev}_LocMapSqlLdr_${name}_RSRC" version="${version}"
        plugin="ApiCommonData::Load::Plugin::InsertPlasmoPfalLocationsWithSqlLdr"
        type="unknown"
        scope="organism"
        organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/SNP/${name}/${version}/final/map_v6.0.sql">
      <dir name="final">
      </dir>
      </manualGet>
      <pluginArgs>--dataFile  @@dataDir@@/map_v6.0.sql</pluginArgs>
    </datasetLoader>
  </datasetClass> 


  <datasetClass class="plasmoMapp" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="organismSpecificMiscNoAlias.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_genomeFeature_${name}_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              type="feature"
	      scope="organism"
	      organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/genomeFeature/${name}/${version}/final">
	<dir name="final">
	</dir>
      </manualGet>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>

    </datasetLoader>
  </datasetClass>


    <datasetClass class="geneName" category="" datasetFileHint="">
      <purpose></purpose>
      <prop name="projectName">&projectName;</prop>
      <prop name="organismAbbrev">&organismAbbrev;</prop>
      <prop name="name">&name;</prop>
      <prop name="version">&version;</prop>
      <prop name="genomeVersion"/>

      <graphTemplateFile name="organismSpecificMisc.xml"/>
      

      <datasetLoader datasetName="${organismAbbrev}_gene_name_${name}_RSRC" version="${version}" 
		plugin="ApiCommonData::Load::Plugin::InsertGeneNamesFromTabFile"
                type="gene_annotation"
		scope="organism"
		organismAbbrev="${organismAbbrev}">

	<manualGet fileOrDir="${projectName}/${organismAbbrev}/function/${name}_gene_names/${version}/final/geneName.txt">
	  <dir name="final">
	  </dir>
	</manualGet>
	<pluginArgs>--file @@dataDir@@/geneName.txt --geneNameDbName '${organismAbbrev}_primary_genome_RSRC' --geneNameDbVer '${genomeVersion}'</pluginArgs>
      </datasetLoader>
    </datasetClass>
    

  <!-- This dataset class load old sequences of genes in ApiDB.OldCodingSequence and old GO ids, EC numbers and product in ApiDB.OldAnnotation-->
  <datasetClass class="insertOldAnnotation" category="" datasetFileHint="">
    <purpose>Gene features that are not provided by the annotation center</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>


    <graphTemplateFile name="organismSpecificMiscNoAlias.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_InsertOldAnnotation_${name}_RSRC"
              version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertOldAnnotation"
              scope="organism"
              type="feature"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/gff/${name}_GFF/${version}/final/features.gff">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--extDbName %DATASET_NAME% --extDbRlsVer %DATASET_VERSION%  --gffFile @@dataDir@@/features.gff</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <!-- NOTE: this class is specific to Crypto and is used to populate apidb.continents  -->
  <datasetClass class="updateIsolatesByContinents" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="organismSpecificMiscNoAlias.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_updateIsolatesByContinents_RSRC"
              version="${version}"
	      plugin="ApiCommonData::Load::Plugin::InsertContinents"
              scope="organism"
              type="isolates"
              subType=""
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/isolate/updateIsolatesByContinents/${version}/final/continents.txt">
        <dir name="final">
        </dir>
      </manualGet>

     <pluginArgs>--continentsFile @@dataDir@@/continents.txt</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <!-- NOTE: this class is specific to Crypto and is add annotatedProduct characteristic for isolates. -->
  <datasetClass class="updateIsolateFeaturesByProductAlias" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="isolatesFromNonHtsSequencing.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_updateIsolateFeaturesByProductAlias_RSRC"
              version="${version}"
	          plugin="ApiCommonData::Load::Plugin::InsertIsolateProductAlias"
              scope="organism"
              type="isolates"
              subType=""
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/isolate/updateIsolateFeaturesByProductAlias/${version}/final/productAlias.txt">
        <dir name="final">
        </dir>
      </manualGet>

     <pluginArgs>--productsFile @@dataDir@@/productAlias.txt --extDbSpec "${organismAbbrev}_isolates_genbank_RSRC|%"</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <!-- NOTE:  because the data files are so large, we don't copy into our
       workflow data dir, but use a symlink into manual deliv instead -->

  <!-- final/ dir must have a file per sample, with name identical to the 
       sample name.  if there are paired ends reads, each sample will also
       have a samplename.paired file -->
  <datasetClass class="rnaSeqSplicedLeaderAndPolyASitesExperiment" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="type"/>

    <graphTemplateFile name="rnaSeqSplicedLeaderAndPolyASitesExperimentTemplate.xml"/>
    <datasetLoader datasetName="${organismAbbrev}_${name}_rnaSeqSplicedLeaderAndPolyASites_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="rnaseq"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>
      <unpack>ln -s @@manualDeliveryDir@@/${projectName}/${organismAbbrev}/splicedLeader_polyASites/${name}/${version}/final/ @@dataDir@@/final</unpack>

      <getAndUnpackOutput dir="@@dataDir@@/final" />
      <getAndUnpackOutput file="@@dataDir@@/final/analysisConfig.xml"/>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>

<!-- type: Splice Site or Poly A -->
  <datasetClass class="rnaSeqSplicedLeaderAndPolyASitesSample" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName"/>
    <prop name="sampleName"/>
    <prop name="type"/>

    <graphTemplateFile name="rnaSeqSplicedLeaderAndPolyASitesSamples.xml"/>

      <!-- we load a fake resource here so we can make a getAndUnpackOutput -->
      <!-- to declare existence of sample file that is acquired by experiment, for test mode -->
    <datasetLoader datasetName="${organismAbbrev}_${experimentName}_${sampleName}_rnaSeqSplicedLeaderAndPolyASitesSample_RSRC" version="dontcare"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="rnaseq"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <getAndUnpackOutput file="@@dataDir@@/../${organismAbbrev}_${experimentName}_rnaSeqSplicedLeaderAndPolyASites_RSRC/final/${sampleName}" />

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>



  <!-- oooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo -->
  <!-- oooooooooooooooooooooooooooo OrthoMCL-DB Specific classes oooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo -->
  <!-- oooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo -->

  <!-- Category:OrthoMCL -->
  <!-- subCategory:proteomes -->


  <datasetClass class="orthomclVectorbaseProteomeForCore" category="OrthoMCL" datasetFileHint="">
    <purpose>Download and load the proteins, to be used in the proteome collection for OrthoMCL, from VectorBase. Files will be processed to obtain the longest protein representative of each gene, to filter out proteins that are less than 10 aa long or that have more than 20 stop codons, and to append the orthomcl abbrev with pipe to the source_id. </purpose>
    <prop name="abbrev"> The unique 4-letter abbreviation used by OrthoMCL for each organism, will be prepended with a pipe to the source_id, e.g. aaeo|NP_212986. </prop>
    <prop name="ncbiTaxonId"> The ncbi_tax_id for the specific strain, obtained from the NCBI Taxonomy database. </prop>
    <prop name="vectorBaseLongName"> The long name in VectorBase for this organism.</prop>
    <prop name="vectorBaseShortName"> The short name in VectorBase for this organism.</prop>
    <prop name="oldAbbrevsList"> List of old orthomcl abbrevs if they differ from the current e.g. 3:pfa, 4:pfa. </prop>
    <prop name="organismName">The name of this organism, just used for log messages</prop>

    <graphTemplateFile name="orthomclGetCoreProteins.xml"/>

    <datasetLoader datasetName="${abbrev}_orthomclProteome_RSRC"
		   version="TODAY"
		   plugin="GUS::Supported::Plugin::LoadFastaSequences"
		   type="proteome"
		   subType="core"
		   scope="dontcare" > 

      <externalDbIdUrl><![CDATA[https://www.vectorbase.org/search/site/EXTERNAL_ID_HERE]]></externalDbIdUrl>

      <wgetArgs url="https://www.vectorbase.org/download/${vectorBaseLongName}peptides${vectorBaseShortName}fagz">--tries=5 --mirror --no-parent --no-directories --no-host-directories --cut-dirs=4 --output-document=@@dataDir@@/vectorbaseProteins.fasta.gz</wgetArgs> 

      <unpack>if [ -e @@dataDir@@/vectorbaseProteins.fasta.gz ]; then gunzip -d @@dataDir@@/vectorbaseProteins.fasta.gz; fi</unpack>

      <unpack>orthomclValidateNcbiTaxonId ${abbrev} ${ncbiTaxonId}</unpack>

      <unpack>findExemplarProteinsFromFasta --fastaFile @@dataDir@@/vectorbaseProteins.fasta --outputFile @@dataDir@@/exemplars.fasta --proteinIdRegex '^>(\S+)' --geneIdRegex '^>(\S{10})' --maxStopCodonPercent 20  --preferredSource sp </unpack>

      <unpack>orthomclMakeVectorbaseAliasesFile ${abbrev} @@dataDir@@/vectorbaseProteins.fasta @@dataDir@@/exemplars.fasta @@dataDir@@/aliases.tab</unpack>

      <unpack>orgAbbrevSourceId --inputFile @@dataDir@@/exemplars.fasta --abbrev ${abbrev} --geneRegex '^>(\S{10})' --outputFile @@dataDir@@/${abbrev}Proteome.fasta</unpack>

      <getAndUnpackOutput file="@@dataDir@@/${abbrev}Proteome.fasta"/>
      <getAndUnpackOutput file="@@dataDir@@/aliases.tab"/>

      <pluginArgs> --externalDatabaseName %DATASET_NAME% --externalDatabaseVersion %DATASET_VERSION% --ncbiTaxId ${ncbiTaxonId}  --sequenceFile "@@dataDir@@/${abbrev}Proteome.fasta" --regexSourceId "^>[^|]+\|(\S+)" --regexSecondaryId "^>(\S+)" --regexName "^>[^|]+\|(\S{10})" --regexDesc "^>\S{10,}\s+([^|]*)\|" --tableName "DoTS::ExternalAASequence"</pluginArgs>

    </datasetLoader>
  </datasetClass>


  <datasetClass class="orthomclVectorbaseProteomeForPeripheral" category="OrthoMCL" datasetFileHint="">
    <purpose>Download and load the proteins, to be used in the proteome collection for OrthoMCL, from VectorBase. Files will be processed to obtain the longest protein representative of each gene, to filter out proteins that are less than 10 aa long or that have more than 20 stop codons, and to append the orthomcl abbrev with pipe to the source_id. </purpose>
    <prop name="abbrev"> The unique 4-letter abbreviation used by OrthoMCL for each organism, will be prepended with a pipe to the source_id, e.g. aaeo|NP_212986. </prop>
    <prop name="orthomclClade">4-letter clade as defined in orthomclClades.txt located in manualDelivery</prop>
    <prop name="ncbiTaxonId"> The ncbi_tax_id for the specific strain, obtained from the NCBI Taxonomy database. </prop>
    <prop name="vectorBaseLongName"> The long name in VectorBase for this organism.</prop>
    <prop name="vectorBaseShortName"> The short name in VectorBase for this organism.</prop>
    <prop name="oldAbbrevsList"> List of old orthomcl abbrevs if they differ from the current e.g. 3:pfa, 4:pfa. </prop>
    <prop name="organismName">The name of this organism, just used for log messages</prop>

    <graphTemplateFile name="orthomclGetPeripheralProteins.xml"/>

    <datasetLoader datasetName="${abbrev}_orthomclPeripheralProteome_RSRC"
		   version="TODAY"
		   plugin="GUS::Supported::Plugin::LoadFastaSequences"
		   type="proteome"
		   subType="peripheral"
		   scope="dontcare" > 

      <externalDbIdUrl><![CDATA[https://www.vectorbase.org/search/site/EXTERNAL_ID_HERE]]></externalDbIdUrl>

      <wgetArgs url="https://www.vectorbase.org/download/${vectorBaseLongName}peptides${vectorBaseShortName}fagz">--tries=5 --mirror --no-parent --no-directories --no-host-directories --cut-dirs=4 --output-document=@@dataDir@@/vectorbaseProteins.fasta.gz</wgetArgs> 

      <unpack>if [ -e @@dataDir@@/vectorbaseProteins.fasta.gz ]; then gunzip -d @@dataDir@@/vectorbaseProteins.fasta.gz; fi</unpack>

      <unpack>orthomclValidateNcbiTaxonId ${abbrev} ${ncbiTaxonId}</unpack>

      <unpack>findExemplarProteinsFromFasta --fastaFile @@dataDir@@/vectorbaseProteins.fasta --outputFile @@dataDir@@/exemplars.fasta --proteinIdRegex '^>(\S+)' --geneIdRegex '^>(\S{10})' --maxStopCodonPercent 20  --preferredSource sp </unpack>

      <unpack>orthomclMakeVectorbaseAliasesFile ${abbrev} @@dataDir@@/vectorbaseProteins.fasta @@dataDir@@/exemplars.fasta @@dataDir@@/aliases.tab</unpack>

      <unpack>orgAbbrevSourceId --inputFile @@dataDir@@/exemplars.fasta --abbrev ${abbrev} --geneRegex '^>(\S{10})' --outputFile @@dataDir@@/${abbrev}Proteome.fasta </unpack>

      <getAndUnpackOutput file="@@dataDir@@/${abbrev}Proteome.fasta"/>
      <getAndUnpackOutput file="@@dataDir@@/aliases.tab"/>

      <pluginArgs> --externalDatabaseName %DATASET_NAME% --externalDatabaseVersion %DATASET_VERSION% --ncbiTaxId ${ncbiTaxonId}  --sequenceFile "@@dataDir@@/${abbrev}Proteome.fasta" --regexSourceId "^>[^|]+\|(\S+)" --regexSecondaryId "^>(\S+)" --regexName "^>[^|]+\|(\S{10})" --regexDesc "^>\S{10,}\s+([^|]*)\|" --tableName "DoTS::ExternalAASequence"</pluginArgs>

    </datasetLoader>
  </datasetClass>


  <datasetClass class="orthomclUniprotReferenceProteomeForCore" category="OrthoMCL" datasetFileHint="">
    <purpose>Download and load the proteins from a Uniprot Reference Proteome, defined as having 1 protein sequence per gene. These proteins will be used in the proteome collection for OrthoMCL. Files will be processed to obtain the longest protein representative of each gene, to filter out proteins that are less than 10 aa long or that have more than 20 stop codons, and to append the orthomcl abbrev with pipe to the source_id. </purpose>
    <prop name="abbrev"> The unique 4-letter abbreviation used by OrthoMCL for each organism, will be prepended with a pipe to the source_id, e.g. aaeo|NP_212986. </prop>
    <prop name="ncbiTaxonId"> The ncbi_tax_id for the specific strain, obtained from the NCBI Taxonomy database. </prop>
    <prop name="proteomeId"> The uniprot proteome ID for this proteome. </prop>
    <prop name="oldAbbrevsList"> List of old orthomcl abbrevs if they differ from the current e.g. 3:pfa, 4:pfa. </prop>
    <prop name="organismName">The name of this organism, just used for log messages</prop>
    <prop name="kingdom">The kingdom that contains this organism (Bacteria, Archaea, or Eukaryota).</prop>

    <graphTemplateFile name="orthomclGetCoreProteins.xml"/>

    <datasetLoader datasetName="${abbrev}_orthomclProteome_RSRC"
		   version="TODAY"
		   plugin="GUS::Supported::Plugin::LoadFastaSequences"
		   type="proteome"
		   subType="core"
		   scope="dontcare" > 

      <externalDbIdUrl><![CDATA[http://www.uniprot.org/uniprot/EXTERNAL_ID_HERE]]></externalDbIdUrl>

      <wgetArgs url="ftp://ftp.uniprot.org/pub/databases/uniprot/current_release/knowledgebase/reference_proteomes/${kingdom}/${proteomeId}_${ncbiTaxonId}.fasta.gz">--tries=5 --mirror --no-parent --no-directories --no-host-directories --cut-dirs=4 --output-document=@@dataDir@@/uniprot.fasta.gz </wgetArgs> 

      <unpack>if [ -e @@dataDir@@/uniprot.fasta.gz ]; then gunzip -d @@dataDir@@/uniprot.fasta.gz; fi</unpack>

      <unpack>orthomclValidateNcbiTaxonId ${abbrev} ${ncbiTaxonId}</unpack>

      <unpack>orthomclMakeCompliantUniprotFasta @@dataDir@@/uniprot.fasta @@dataDir@@/compliant.fasta</unpack>

      <unpack>findExemplarProteinsFromFasta --fastaFile @@dataDir@@/compliant.fasta --outputFile @@dataDir@@/exemplars.fasta --proteinIdRegex '>(\S+)' --geneIdRegex 'gene=(\S+)' --maxStopCodonPercent 20  --preferredSource sp </unpack>

      <unpack>orgAbbrevSourceId --inputFile @@dataDir@@/exemplars.fasta  --abbrev ${abbrev} --geneRegex 'gene=(\S+)' --outputFile @@dataDir@@/${abbrev}Proteome.fasta</unpack>

      <unpack>orthomclMakeUniprotAliasesFile ${abbrev} @@dataDir@@/compliant.fasta @@dataDir@@/exemplars.fasta @@dataDir@@/aliases.tab</unpack>

      <getAndUnpackOutput file="@@dataDir@@/${abbrev}Proteome.fasta"/>
      <getAndUnpackOutput file="@@dataDir@@/aliases.tab"/>

      <pluginArgs> --externalDatabaseName %DATASET_NAME% --externalDatabaseVersion %DATASET_VERSION% --ncbiTaxId ${ncbiTaxonId}  --sequenceFile "@@dataDir@@/${abbrev}Proteome.fasta" --regexSourceId "^>[^|]+\|(\S+)" --regexSecondaryId "^>(\S+)" --regexName "gene=(\S*)" --regexDesc "product=(.*)" --tableName "DoTS::ExternalAASequence"</pluginArgs>

    </datasetLoader>
  </datasetClass>


  <datasetClass class="orthomclUniprotReferenceProteomeForPeripheral" category="OrthoMCL" datasetFileHint="">
    <purpose>Download and load the proteins from a Uniprot Reference Proteome, defined as having 1 protein sequence per gene. These proteins will be used in the proteome collection for OrthoMCL. Files will be processed to obtain the longest protein representative of each gene, to filter out proteins that are less than 10 aa long or that have more than 20 stop codons, and to append the orthomcl abbrev with pipe to the source_id. </purpose>
    <prop name="abbrev"> The unique 4-letter abbreviation used by OrthoMCL for each organism, will be prepended with a pipe to the source_id, e.g. aaeo|NP_212986. </prop>
    <prop name="orthomclClade">4-letter clade as defined in orthomclClades.txt located in manualDelivery</prop>
    <prop name="ncbiTaxonId"> The ncbi_tax_id for the specific strain, obtained from the NCBI Taxonomy database. </prop>
    <prop name="proteomeId"> The uniprot proteome ID for this proteome. </prop>
    <prop name="oldAbbrevsList"> List of old orthomcl abbrevs if they differ from the current e.g. 3:pfa, 4:pfa. </prop>
    <prop name="organismName">The name of this organism, just used for log messages</prop>
    <prop name="kingdom">The kingdom that contains this organism (Bacteria, Archaea, or Eukaryota).</prop>

    <graphTemplateFile name="orthomclGetPeripheralProteins.xml"/>

    <datasetLoader datasetName="${abbrev}_orthomclPeripheralProteome_RSRC"
		   version="TODAY"
		   plugin="GUS::Supported::Plugin::LoadFastaSequences"
		   type="proteome"
		   subType="peripheral"
		   scope="dontcare" > 

      <externalDbIdUrl><![CDATA[http://www.uniprot.org/uniprot/EXTERNAL_ID_HERE]]></externalDbIdUrl>

      <wgetArgs url="ftp://ftp.uniprot.org/pub/databases/uniprot/current_release/knowledgebase/reference_proteomes/${kingdom}/${proteomeId}_${ncbiTaxonId}.fasta.gz">--tries=5 --mirror --no-parent --no-directories --no-host-directories --cut-dirs=4 --output-document=@@dataDir@@/uniprot.fasta.gz </wgetArgs> 

      <unpack>if [ -e @@dataDir@@/uniprot.fasta.gz ]; then gunzip -d @@dataDir@@/uniprot.fasta.gz; fi</unpack>

      <unpack>orthomclValidateNcbiTaxonId ${abbrev} ${ncbiTaxonId}</unpack>

      <unpack>orthomclMakeCompliantUniprotFasta @@dataDir@@/uniprot.fasta @@dataDir@@/compliant.fasta</unpack>

      <unpack>findExemplarProteinsFromFasta --fastaFile @@dataDir@@/compliant.fasta --outputFile @@dataDir@@/exemplars.fasta --proteinIdRegex '>(\S+)' --geneIdRegex 'gene=(\S+)' --maxStopCodonPercent 20  --preferredSource sp </unpack>

      <unpack>orgAbbrevSourceId --inputFile @@dataDir@@/exemplars.fasta  --abbrev ${abbrev} --geneRegex 'gene=(\S+)' --outputFile @@dataDir@@/${abbrev}Proteome.fasta</unpack>

      <unpack>orthomclMakeUniprotAliasesFile ${abbrev} @@dataDir@@/compliant.fasta @@dataDir@@/exemplars.fasta @@dataDir@@/aliases.tab</unpack>

      <getAndUnpackOutput file="@@dataDir@@/${abbrev}Proteome.fasta"/>
      <getAndUnpackOutput file="@@dataDir@@/aliases.tab"/>

      <pluginArgs> --externalDatabaseName %DATASET_NAME% --externalDatabaseVersion %DATASET_VERSION% --ncbiTaxId ${ncbiTaxonId}  --sequenceFile "@@dataDir@@/${abbrev}Proteome.fasta" --regexSourceId "^>[^|]+\|(\S+)" --regexSecondaryId "^>(\S+)" --regexName "geneName=(\S*)" --regexDesc "product=(.*)" --tableName "DoTS::ExternalAASequence"</pluginArgs>

    </datasetLoader>
  </datasetClass>


  <datasetClass class="orthomclPeripheralFromEbi" category="OrthoMCL" datasetFileHint="">
    <purpose>Download and load the proteins, gene names, EC numbers and product descriptions from an Ebi data dump. These proteins will be used in the proteome collection for OrthoMCL. Files will be processed to obtain the longest protein representative of each gene, to filter out proteins that are less than 10 aa long or that have more than 20 stop codons, and to append the orthomcl abbrev with pipe to the source_id. </purpose>
    <prop name="projectName">Vectorbase, for example.</prop>
    <prop name="ebiOrganismName">matches ebi ftp directory name</prop>
    <prop name="ebiVersion">matches ebi ftp directory name</prop>
    <prop name="orthomclAbbrev">The unique 4-letter abbreviation used by OrthoMCL for each organism, will be prepended with a pipe to the source_id, e.g. aaeo|NP_212986.</prop>
    <prop name="orthomclClade">4-letter clade as defined in orthomclClades.txt located in manualDelivery.</prop>
    <prop name="ncbiTaxonId">The ncbi_tax_id for the specific strain, obtained from the NCBI Taxonomy database.</prop>
    <prop name="ebi2gusTag">99, for example</prop>
    <prop name="oldAbbrevsList"> List of old orthomcl abbrevs if they differ from the current e.g. 3:pfa, 4:pfa. </prop>
    <prop name="organismName">The name of this organism, which will be used on the site. If you are replacing a core organism, you should use the same name but append text like (genome build 49). Use %20 (or underscore) for space characters</prop>

    <graphTemplateFile name="orthomclGetPeripheralProteins.xml"/>

    <datasetLoader datasetName="${orthomclAbbrev}_PeripheralFromEbi_RSRC"
		   version="${ebiVersion}"
		   plugin="ApiCommonData::Load::Plugin::LoadNothing"
		   type="orthomclEbi"
		   subType="peripheral"
		   scope="dontcare" > 
      <manualGet fileOrDir="common/empty">
        <descriptionOfFinal></descriptionOfFinal>
        <dir name="final">
        </dir>
      </manualGet>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>


  <datasetClass class="orthomclPeripheralFromVEuPathDB" category="OrthoMCL" datasetFileHint="">
    <purpose>Download and load the proteins, gene names, EC numbers and product descriptions from a VEuPathDB site. These proteins will be used in the proteome collection for OrthoMCL. Files will be processed to obtain the longest protein representative of each gene, to filter out proteins that are less than 10 aa long or that have more than 20 stop codons, and to append the orthomcl abbrev with pipe to the source_id. </purpose>
    <prop name="projectName">VectorBase,Schisto,plasmo for example.</prop>
    <prop name="version">A date or build number that determines the version of the data</prop>
    <prop name="orthomclAbbrev">The unique 4-letter abbreviation used by OrthoMCL for each organism, will be prepended with a pipe to the source_id, e.g. aaeo|NP_212986.</prop>
    <prop name="orthomclClade">4-letter clade as defined in orthomclClades.txt located in manualDelivery.</prop>
    <prop name="ncbiTaxonId">The ncbi_tax_id for the specific strain, obtained from the NCBI Taxonomy database.</prop>
    <prop name="oldAbbrevsList"> List of old orthomcl abbrevs if they differ from the current e.g. 3:pfa, 4:pfa. </prop>
    <prop name="organismName">The name of this organism in VEuPathDB which will be used to get the data and used on the orthomcl site. If you are replacing a core organism, you should use the same name but append text like (genome build 49).</prop>

    <graphTemplateFile name="orthomclGetPeripheralProteins.xml"/>

    <datasetLoader datasetName="${orthomclAbbrev}_PeripheralFromVEuPathDB_RSRC"
		   version="${version}"
		   plugin="ApiCommonData::Load::Plugin::LoadNothing"
		   type="orthomclVEuPathDB"
		   subType="peripheral"
		   scope="dontcare" > 
      <manualGet fileOrDir="common/empty">
        <descriptionOfFinal></descriptionOfFinal>
        <dir name="final">
        </dir>
      </manualGet>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>


  <datasetClass class="orthomclRetireCoreOrganism" category="OrthoMCL" datasetFileHint="">
    <purpose>Change the core organism abbrev, like aaeg, to aaeg-old. This class is used when you don't want to undo a core organism but want to add an updated build as a peripheral. After running this, the aaeg abbrev can be used to load the new version as a peripheral organism.</purpose>
    <prop name="abbrevList">Comma separated list of abbrevs, like: aaeg,pfal,scer</prop>
    <prop name="buildNumber">which build number (eg 49) will this be done for</prop>
    <prop name="skipIfAlreadyDone">yes or true, to skip the abbrev if it has already been changed, as opposed to die</prop>

    <graphTemplateFile name="orthomclRetireCoreTemplate.xml"/>

    <datasetLoader datasetName="${abbrevList}_orthomclRetireCore_RSRC"
		   version="TODAY"
		   plugin="ApiCommonData::Load::Plugin::LoadNothing"
		   type="orthomclRetireCore"
		   subType="core"
		   scope="dontcare" > 
      <manualGet fileOrDir="common/empty">
        <descriptionOfFinal></descriptionOfFinal>
        <dir name="final">
        </dir>
      </manualGet>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>



  <datasetClass class="orthomclUniprotProteomeForCore" category="OrthoMCL" datasetFileHint="">
    <purpose>Download and load the proteins, to be used in the proteome collection for OrthoMCL, from Uniprot. Files will be processed to obtain the longest protein representative of each gene, to filter out proteins that are less than 10 aa long or that have more than 20 stop codons, and to append the orthomcl abbrev with pipe to the source_id. </purpose>
    <prop name="abbrev"> The unique 4-letter abbreviation used by OrthoMCL for each organism, will be prepended with a pipe to the source_id, e.g. aaeo|NP_212986. </prop>
    <prop name="ncbiTaxonId"> The ncbi_tax_id for the specific strain, obtained from the NCBI Taxonomy database. </prop>
    <prop name="proteomeId"> The uniprot proteome ID for this proteome. </prop>
    <prop name="oldAbbrevsList"> List of old orthomcl abbrevs if they differ from the current e.g. 3:pfa, 4:pfa. </prop>
    <prop name="organismName">The name of this organism, just used for log messages</prop>


    <graphTemplateFile name="orthomclGetCoreProteins.xml"/>

    <datasetLoader datasetName="${abbrev}_orthomclProteome_RSRC"
		   version="TODAY"
		   plugin="GUS::Supported::Plugin::LoadFastaSequences"
		   type="proteome"
		   subType="core"
		   scope="dontcare" > 

      <externalDbIdUrl><![CDATA[http://www.uniprot.org/uniprot/EXTERNAL_ID_HERE]]></externalDbIdUrl>

      <wgetArgs url="http://www.uniprot.org/uniprot/?query=taxonomy:${ncbiTaxonId}&amp;format=fasta">--tries=5 --mirror --no-parent --no-directories --no-host-directories --cut-dirs=4 --output-document=@@dataDir@@/uniprot.fasta </wgetArgs> 

      <unpack>orthomclValidateNcbiTaxonId ${abbrev} ${ncbiTaxonId}</unpack>

      <unpack> orthomclMakeCompliantUniprotFasta @@dataDir@@/uniprot.fasta @@dataDir@@/compliant.fasta  ${abbrev} ${ncbiTaxonId}</unpack>

      <unpack>getUniprotGeneIdMap ${ncbiTaxonId} ${proteomeId} @@dataDir@@/proteinGeneMap '${organismName}'</unpack>

      <unpack>findExemplarProteinsFromFasta --fastaFile @@dataDir@@/compliant.fasta --outputFile @@dataDir@@/${abbrev}Proteome.fasta --proteinIdRegex='>\w+\|(\S+)' --proteinToGeneFile @@dataDir@@/proteinGeneMap --maxStopCodonPercent 20  --preferredSource sp </unpack>

      <unpack>orthomclMakeUniprotAliasesFile ${abbrev} @@dataDir@@/compliant.fasta @@dataDir@@/${abbrev}Proteome.fasta @@dataDir@@/aliases.tab</unpack>

      <getAndUnpackOutput file="@@dataDir@@/${abbrev}Proteome.fasta"/>
      <getAndUnpackOutput file="@@dataDir@@/aliases.tab"/>

      <pluginArgs> --externalDatabaseName %DATASET_NAME% --externalDatabaseVersion %DATASET_VERSION% --ncbiTaxId ${ncbiTaxonId}  --sequenceFile "@@dataDir@@/${abbrev}Proteome.fasta" --regexSourceId "^>[^|]+\|(\S+)" --regexSecondaryId "^>(\S+)" --regexName "geneName=(\S*)" --regexDesc "product=(.*)" --tableName "DoTS::ExternalAASequence"</pluginArgs>

    </datasetLoader>
  </datasetClass>


  <datasetClass class="orthomclUniprotProteomeForPeripheral" category="OrthoMCL" datasetFileHint="">
    <purpose>Download and load the proteins, to be used in the proteome collection for OrthoMCL, from Uniprot. Files will be processed to obtain the longest protein representative of each gene, to filter out proteins that are less than 10 aa long or that have more than 20 stop codons, and to append the orthomcl abbrev with pipe to the source_id. </purpose>
    <prop name="abbrev"> The unique 4-letter abbreviation used by OrthoMCL for each organism, will be prepended with a pipe to the source_id, e.g. aaeo|NP_212986. </prop>
    <prop name="orthomclClade">4-letter clade as defined in orthomclClades.txt located in manualDelivery</prop>
    <prop name="ncbiTaxonId"> The ncbi_tax_id for the specific strain, obtained from the NCBI Taxonomy database. </prop>
    <prop name="proteomeId"> The uniprot proteome ID for this proteome. </prop>
    <prop name="oldAbbrevsList"> List of old orthomcl abbrevs if they differ from the current e.g. 3:pfa, 4:pfa. </prop>
    <prop name="organismName">The nanme of this organism, just used for log messages</prop>

    <graphTemplateFile name="orthomclGetPeripheralProteins.xml"/>

    <datasetLoader datasetName="${abbrev}_orthomclPeripheralProteome_RSRC"
		   version="TODAY"
		   plugin="GUS::Supported::Plugin::LoadFastaSequences"
		   type="proteome"
		   subType="peripheral"
		   scope="dontcare" > 

      <externalDbIdUrl><![CDATA[http://www.uniprot.org/uniprot/EXTERNAL_ID_HERE]]></externalDbIdUrl>


      <wgetArgs url="http://www.uniprot.org/uniprot/?query=taxonomy:${ncbiTaxonId}&amp;format=fasta">--tries=5 --mirror --no-parent --no-directories --no-host-directories --cut-dirs=4 --output-document=@@dataDir@@/uniprot.fasta </wgetArgs> 

      <unpack>orthomclValidateNcbiTaxonId ${abbrev} ${ncbiTaxonId}</unpack>

      <unpack> orthomclMakeCompliantUniprotFasta @@dataDir@@/uniprot.fasta @@dataDir@@/compliant.fasta  ${abbrev} ${ncbiTaxonId}</unpack>

      <unpack>getUniprotGeneIdMap ${ncbiTaxonId} ${proteomeId} @@dataDir@@/proteinGeneMap '${organismName}'</unpack>

      <unpack>findExemplarProteinsFromFasta --fastaFile @@dataDir@@/compliant.fasta --outputFile @@dataDir@@/${abbrev}Proteome.fasta --proteinIdRegex '>\w+\|(\S+)' --proteinToGeneFile @@dataDir@@/proteinGeneMap --maxStopCodonPercent 20  --preferredSource sp </unpack>

      <unpack>orthomclMakeUniprotAliasesFile ${abbrev} @@dataDir@@/compliant.fasta @@dataDir@@/${abbrev}Proteome.fasta @@dataDir@@/aliases.tab</unpack>

      <getAndUnpackOutput file="@@dataDir@@/${abbrev}Proteome.fasta"/>
      <getAndUnpackOutput file="@@dataDir@@/aliases.tab"/>

      <pluginArgs> --externalDatabaseName %DATASET_NAME% --externalDatabaseVersion %DATASET_VERSION% --ncbiTaxId ${ncbiTaxonId}  --sequenceFile "@@dataDir@@/${abbrev}Proteome.fasta" --regexSourceId "^>[^|]+\|(\S+)" --regexSecondaryId "^>(\S+)" --regexName "geneName=(\S*)" --regexDesc "product=(.*)" --tableName "DoTS::ExternalAASequence"</pluginArgs>

    </datasetLoader>
  </datasetClass>

  <datasetClass class="orthomclEuPathProteomeForCore" category="" datasetFileHint="">
    <purpose>Download and load the proteins, to be used in the proteome collection for OrthoMCL, from one of the EuPathDB project download directories. Files will be processed to filter out proteins that are less than 10 aa long or that have more than 20 stop codons, and to append the orthomcl abbrev with pipe to the source_id.</purpose>
    <prop name="ncbiTaxonId">The ncbi_tax_id for the specific strain, obtained from the NCBI Taxonomy database. </prop>
    <prop name="ncbiTaxonIdIsAtSpeciesLevel">true if this organism does not have an ncbi tax id, and we are using the species level tax id instead</prop>
    <prop name="project"> The EuPathDB project, e.g. PlasmoDB.</prop>
    <prop name="webSubDir"> The lower case sub-directory of the EuPathDB project, e.g. micro. Used for webservices call.</prop>
    <prop name="version">build number for the EuPathDB project</prop>
    <prop name="organismName">The nanme of this organism, as required by the GenesByTaxon search</prop>
    <prop name="abbrev">The unique 4-letter abbreviation used by OrthoMCL for each organism, will be prepended with a pipe to the source_id, e.g. aaeo|NP_212986. </prop>
    <prop name="oldAbbrevsList"> List of old orthomcl abbrevs if they differ from the current e.g. 3:pfa, 4:pfa. </prop>
    
    <graphTemplateFile name="orthomclGetCoreProteins.xml"/>

    <datasetLoader datasetName="${abbrev}_orthomclProteome_RSRC" 
		   plugin="GUS::Supported::Plugin::LoadFastaSequences"
		   scope="dontcare"
		   type="proteome"
		   subType="core"
		   version="${version}">

      <externalDbIdUrl><![CDATA[http://www.${project}.org/gene/EXTERNAL_ID_HERE]]></externalDbIdUrl>

      <wgetArgs url="https://${project}.org/${webSubDir}/service/answer/report">--tries=5 --mirror --no-parent --no-directories --no-host-directories --cut-dirs=4 --output-document=@@dataDir@@/eupathProteins.xml --post-data '{ "answerSpec": { "questionName": "GeneQuestions.GenesByGeneType", "parameters": {"organism": "${organismName}", "geneType": "protein coding", "includePseudogenes": "No"} }, "formatting": { "format" : "xml", "formatConfig":{ "attributes": ["primary_key","organism","gene_product","protein_sequence"], "attachmentType":"plain"} }}' --header="Content-Type: application/json"</wgetArgs>

      <unpack>orthomclValidateNcbiTaxonId ${abbrev} ${ncbiTaxonId}</unpack>

      <unpack>orthomclUnpackEupathProteins @@dataDir@@/eupathProteins.xml @@dataDir@@/eupathProteins.fasta</unpack>

      <unpack>findExemplarProteinsFromFasta --fastaFile @@dataDir@@/eupathProteins.fasta --outputFile @@dataDir@@/exemplars.fasta --geneIdRegex 'gene=(\S+)' --proteinIdRegex '^>(\S+)' --maxStopCodonPercent 20  --preferredSource sp </unpack>

      <unpack>orthomclMakeEupathAliasesFile ${abbrev} @@dataDir@@/eupathProteins.xml @@dataDir@@/exemplars.fasta @@dataDir@@/aliases.tab</unpack>

      <unpack>orgAbbrevSourceId --inputFile @@dataDir@@/exemplars.fasta  --abbrev ${abbrev} --geneRegex 'gene=(\S+)' --outputFile @@dataDir@@/${abbrev}Proteome.fasta</unpack>

      <getAndUnpackOutput file="@@dataDir@@/${abbrev}Proteome.fasta"/>
      <getAndUnpackOutput file="@@dataDir@@/aliases.tab"/>

      <pluginArgs>--externalDatabaseName %DATASET_NAME% --externalDatabaseVersion "%DATASET_VERSION%" --ncbiTaxId ${ncbiTaxonId} --sequenceFile @@dataDir@@/${abbrev}Proteome.fasta --regexSourceId "^>[^|]+\|(\S+)" --regexSecondaryId "^>(\S+)" --regexDesc "product=(.+)" --tableName "DoTS::ExternalAASequence"</pluginArgs>

    </datasetLoader>
  </datasetClass>

  <datasetClass class="orthomclEuPathProteomeForPeripheral" category="" datasetFileHint="">
    <purpose>Download and load the proteins, to be used in the proteome collection for OrthoMCL, from one of the EuPathDB project download directories. Files will be processed to filter out proteins that are less than 10 aa long or that have more than 20 stop codons, and to append the orthomcl abbrev with pipe to the source_id.</purpose>
    <prop name="ncbiTaxonId">The ncbi_tax_id for the specific strain, obtained from the NCBI Taxonomy database. </prop>
    <prop name="ncbiTaxonIdIsAtSpeciesLevel">true if this organism does not have an ncbi tax id, and we are using the species level tax id instead</prop>
    <prop name="version">build number for the EuPathDB project</prop>
    <prop name="project"> The EuPathDB project, e.g. PlasmoDB.</prop>
    <prop name="webSubDir"> The lower case sub-directory of the EuPathDB project, e.g. micro. Used for webservices call.</prop>
    <prop name="organismName">The name of this organism, as required by the GenesByTaxon search</prop>
    <prop name="abbrev">The unique 4-letter abbreviation used by OrthoMCL for each organism, will be prepended with a pipe to the source_id, e.g. aaeo|NP_212986. </prop>
    <prop name="orthomclClade">4-letter clade as defined in orthomclClades.txt located in manualDelivery</prop>
    <prop name="oldAbbrevsList"> List of old orthomcl abbrevs if they differ from the current e.g. 3:pfa, 4:pfa. </prop>
    
    <graphTemplateFile name="orthomclGetPeripheralProteins.xml"/>

    <datasetLoader datasetName="${abbrev}_orthomclPeripheralProteome_RSRC" 
		   plugin="GUS::Supported::Plugin::LoadFastaSequences"
		   scope="dontcare"
		   type="proteome"
		   subType="peripheral"
		   version="${version}">

      <externalDbIdUrl><![CDATA[http://www.${project}.org/gene/EXTERNAL_ID_HERE]]></externalDbIdUrl>

      <wgetArgs url="https://${project}.org/${webSubDir}/service/answer/report">--tries=5 --mirror --no-parent --no-directories --no-host-directories --cut-dirs=4 --output-document=@@dataDir@@/eupathProteins.xml --post-data '{ "answerSpec": { "questionName": "GeneQuestions.GenesByGeneType", "parameters": {"organism": "${organismName}", "geneType": "protein coding", "includePseudogenes": "No"} }, "formatting": { "format" : "xml", "formatConfig":{ "attributes": ["primary_key","organism","gene_product","protein_sequence"], "attachmentType":"plain"} }}' --header="Content-Type: application/json"</wgetArgs>

      <unpack>orthomclValidateNcbiTaxonId ${abbrev} ${ncbiTaxonId}</unpack>

      <unpack>orthomclUnpackEupathProteins @@dataDir@@/eupathProteins.xml @@dataDir@@/eupathProteins.fasta</unpack>

      <unpack>findExemplarProteinsFromFasta --fastaFile @@dataDir@@/eupathProteins.fasta --outputFile @@dataDir@@/exemplars.fasta --geneIdRegex 'gene=(\S+)' --proteinIdRegex '^>(\S+)' --maxStopCodonPercent 20  --preferredSource sp </unpack>

      <unpack>orthomclMakeEupathAliasesFile ${abbrev} @@dataDir@@/eupathProteins.xml @@dataDir@@/exemplars.fasta @@dataDir@@/aliases.tab</unpack>

      <unpack>orgAbbrevSourceId --inputFile @@dataDir@@/exemplars.fasta --abbrev ${abbrev} --geneRegex 'gene=(\S+)' --outputFile @@dataDir@@/${abbrev}Proteome.fasta</unpack>

      <getAndUnpackOutput file="@@dataDir@@/${abbrev}Proteome.fasta"/>
      <getAndUnpackOutput file="@@dataDir@@/aliases.tab"/>

      <pluginArgs>--externalDatabaseName %DATASET_NAME% --externalDatabaseVersion "%DATASET_VERSION%" --ncbiTaxId ${ncbiTaxonId} --sequenceFile @@dataDir@@/${abbrev}Proteome.fasta --regexSourceId "^>[^|]+\|(\S+)" --regexSecondaryId "^>(\S+)" --regexDesc "product=(.+)" --tableName "DoTS::ExternalAASequence"</pluginArgs>

    </datasetLoader>
  </datasetClass>

  <datasetClass class="orthomclManualDeliveryProteomeForCore" category="" datasetFileHint="">
    <purpose>Download and load the proteins, to be used in the proteome collection for OrthoMCL, from the OrthoMCL manualDelivery directory. File defline should have >source_id\sdefinition which may require preprocessing. Files will be processed to filter out proteins that are less than 10 aa long or that have more than 20 stop codons, and to append the orthomcl abbrev with pipe to the source_id</purpose>
    <prop name="ncbiTaxonId">The ncbi_tax_id for the specific strain, obtained from the NCBI Taxonomy database. </prop>
    <prop name="species">Species name with spaces replaced by underscores e.g. </prop>
    <prop name="version"> Date or version number of file as it appears in manualDelivery.</prop>
    <prop name="abbrev">The unique 4-letter abbreviation used by OrthoMCL for each organism, will be prepended with a pipe to the source_id, e.g. aaeo|NP_212986. </prop>
    <prop name="oldAbbrevsList"> List of old orthomcl abbrevs if they differ from the current e.g. 3:pfa, 4:pfa. </prop>
    
    <graphTemplateFile name="orthomclGetCoreProteins.xml"/>

    <datasetLoader datasetName="${abbrev}_orthomclProteome_RSRC" 
		   plugin="GUS::Supported::Plugin::LoadFastaSequences"
		   scope="dontcare"
		   type="proteome"
		   version="${version}">


      <manualGet fileOrDir="OrthoMCL/proteomes/${species}/${version}/final/proteins.fasta.gz">
        <dir name="final">
        </dir>
      </manualGet>

      <unpack>orthomclValidateNcbiTaxonId ${abbrev} ${ncbiTaxonId}</unpack>

      <unpack>orgAbbrevSourceId --inputFile @@dataDir@@/proteins.fasta.gz --abbrev ${abbrev} --geneRegex "^>(\S+)" --outputFile @@dataDir@@/${abbrev}Proteome.fasta </unpack> 

      <pluginArgs>--externalDatabaseName %DATASET_NAME% --externalDatabaseVersion %DATASET_VERSION% --ncbiTaxId ${ncbiTaxonId} --sequenceFile @@dataDir@@/${abbrev}Proteome.fasta   --regexSourceId "^>[^|]+\|(\S+)" --regexSecondaryId "^>(\S+)" --regexDesc "^>\S+\s+(.*)"  --tableName "DoTS::ExternalAASequence"</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="orthomclPeripheralFromManualDelivery" category="" datasetFileHint="">
    <purpose>Download and load the proteins, to be used in the proteome collection for OrthoMCL, from the OrthoMCL manualDelivery directory. The Fasta file defline should be formatted like: >transcriptOrProteinId gene=geneId product=productDescription. The Fasta will be processed to obtain one protein for each gene, filter out proteins that are less than 10 aa long or that have more than 20 stop codons, and to append the orthomcl abbrev with pipe to the geneId</purpose>
    <prop name="ncbiTaxonId">The ncbi_tax_id for the specific strain, obtained from the NCBI Taxonomy database. </prop>
    <prop name="organismName">Full organism name</prop>
    <prop name="version"> Date or version number of file as it appears in manualDelivery.</prop>
    <prop name="orthomclAbbrev">The unique 4-letter abbreviation used by OrthoMCL for each organism, will be prepended with a pipe to the source_id, e.g. aaeo|NP_212986. </prop>
    <prop name="orthomclClade">4-letter clade as defined in orthomclClades.txt located in manualDelivery</prop>
    <prop name="oldAbbrevsList"> List of old orthomcl abbrevs if they differ from the current e.g. 3:pfa, 4:pfa. </prop>
    
    <graphTemplateFile name="orthomclGetPeripheralProteins.xml"/>

    <datasetLoader datasetName="${orthomclAbbrev}_PeripheralFromManualDelivery_RSRC" 
		   plugin="ApiCommonData::Load::Plugin::LoadNothing"
		   scope="dontcare"
		   type="orthomclManualDelivery"
		   subType="peripheral"
		   version="${version}">

      <manualGet fileOrDir="OrthoMCL/proteomes/${organismName}/${version}/final/proteins.fasta.gz">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="uniprotEcMappings" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="abbrev">The unique 4-letter abbreviation used by OrthoMCL for each organism, will be prepended with a pipe to the source_id, e.g. aaeo|NP_212986. </prop>
    <prop name="ncbiTaxonId">&speciesNcbiTaxonId;</prop>

    <graphTemplateFile name="orthomclEcMappings.xml"/>

    <datasetLoader plugin="GUS::Community::Plugin::InsertECMapping"
              datasetName="${abbrev}_Uniprot_ECAssociations_RSRC"
              version="TODAY"
              scope="dontcare">
  
     <wgetArgs url="https://www.uniprot.org/uniprot/?query=taxonomy%3a${ncbiTaxonId}&amp;format=tab&amp;columns=id,ec"> --output-document=@@dataDir@@/ecAssocFromUniprot.tab --content-disposition </wgetArgs>
     
     <unpack><![CDATA[perl -e 'while(<>) { print "${abbrev}|$_" } ' < @@dataDir@@/ecAssocFromUniprot.tab > @@dataDir@@/ecAssoc.tab ]]></unpack>

      <pluginArgs>--ECMappingFile @@dataDir@@/ecAssoc.tab --evidenceCode "Uniprot" --aaSeqLocusTagMappingSql "select aa_sequence_id from dots.externalaasequence where secondary_identifier = ?"</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="eupathEcMappings" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="abbrev">The unique 4-letter abbreviation used by OrthoMCL for each organism, will be prepended with a pipe to the source_id, e.g. aaeo|NP_212986. </prop>
    <prop name="version">&version;</prop>
    <prop name="project"> The EuPathDB project, e.g. PlasmoDB.</prop>
    <prop name="webSubDir"> The lower case sub-directory of the EuPathDB project, e.g. micro. Used for webservices call.</prop>
    <prop name="organismName">The organism name as required by EuPath organism parameter.  Use %20 for space characters</prop>

    <graphTemplateFile name="orthomclEcMappings.xml"/>

    <datasetLoader plugin="GUS::Community::Plugin::InsertECMapping"
              datasetName="${abbrev}_Eupath_ECAssociations_RSRC"
              version="${version}"
              scope="dontcare">
  
     <wgetArgs url="https://${project}.org/${webSubDir}/webservices/GeneQuestions/GenesByTaxon.xml?organism=${organismName}&amp;o-fields=ec_numbers"> --output-document=@@dataDir@@/ecAssocFromEuPathDB.xml --content-disposition </wgetArgs>

     <unpack>orthomclUnpackEupathDB_EC_XML @@dataDir@@/ecAssocFromEuPathDB.xml @@dataDir@@/ecAssoc.tab ${abbrev}</unpack>
     
      <pluginArgs>--ECMappingFile @@dataDir@@/ecAssoc.tab --evidenceCode "EuPathDB" --aaSeqLocusTagMappingSql "select aa_sequence_id from dots.externalaasequence where secondary_identifier = ?"</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="orthomclVectorbaseEcForCore" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="abbrev">The unique 4-letter abbreviation used by OrthoMCL for each organism, will be prepended with a pipe to the source_id, e.g. aaeo|NP_212986. </prop>
    <prop name="ncbiTaxonId">&speciesNcbiTaxonId;</prop>
    <prop name="biomartDataset">The dataset name in VectorBase to obtain genes for this species.</prop>

    <graphTemplateFile name="orthomclGetCoreProteins.xml"/>

    <datasetLoader plugin="GUS::Community::Plugin::InsertECMapping"
              datasetName="${abbrev}_Vectorbase_ECAssociations_RSRC"
              version="TODAY"
              scope="dontcare">
  
     <wgetArgs url="https://biomart.vectorbase.org/biomart/martservice?query=&lt;?xml version=&apos;1.0&apos; encoding=&apos;UTF-8&apos;?&gt;&lt;Query virtualSchemaName=&apos;vb_mart_1908&apos; formatter=&apos;TSV&apos; header=&apos;0&apos; uniqueRows=&apos;0&apos; count=&apos;&apos; datasetConfigVersion=&apos;0.6&apos;&gt;&lt;Dataset name=&apos;${biomartDataset}&apos; interface=&apos;default&apos;&gt;&lt;Attribute name=&apos;ensembl_gene_id&apos;/&gt;&lt;Attribute name=&apos;kegg_enzyme&apos;/&gt;&lt;/Dataset&gt;&lt;/Query&gt;"> --output-document=@@dataDir@@/ecAssocFromVectorbaseBiomart.tab --content-disposition</wgetArgs>
     
     <unpack>orthomclUnpackVectorbaseEc @@dataDir@@/ecAssocFromVectorbaseBiomart.tab @@dataDir@@/ecAssoc.tab ${abbrev}</unpack>

      <pluginArgs>--ECMappingFile @@dataDir@@/ecAssoc.tab --evidenceCode "VectorBaseBiomart" --aaSeqLocusTagMappingSql "select aa_sequence_id from dots.externalaasequence where secondary_identifier = ?"</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="orthomclVectorbaseEcForPeripheral" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="abbrev">The unique 4-letter abbreviation used by OrthoMCL for each organism, will be prepended with a pipe to the source_id, e.g. aaeo|NP_212986. </prop>
    <prop name="ncbiTaxonId">&speciesNcbiTaxonId;</prop>
    <prop name="biomartDataset">The dataset name in VectorBase to obtain genes for this species.</prop>

    <graphTemplateFile name="orthomclGetPeripheralProteins.xml"/>

    <datasetLoader plugin="GUS::Community::Plugin::InsertECMapping"
              datasetName="${abbrev}_Vectorbase_ECAssociations_RSRC"
              version="TODAY"
              scope="dontcare">
  
     <wgetArgs url="https://biomart.vectorbase.org/biomart/martservice?query=&lt;?xml version=&apos;1.0&apos; encoding=&apos;UTF-8&apos;?&gt;&lt;Query virtualSchemaName=&apos;vb_mart_1908&apos; formatter=&apos;TSV&apos; header=&apos;0&apos; uniqueRows=&apos;0&apos; count=&apos;&apos; datasetConfigVersion=&apos;0.6&apos;&gt;&lt;Dataset name=&apos;${biomartDataset}&apos; interface=&apos;default&apos;&gt;&lt;Attribute name=&apos;ensembl_gene_id&apos;/&gt;&lt;Attribute name=&apos;kegg_enzyme&apos;/&gt;&lt;/Dataset&gt;&lt;/Query&gt;"> --output-document=@@dataDir@@/ecAssocFromVectorbaseBiomart.tab --content-disposition</wgetArgs>
     
     <unpack>orthomclUnpackVectorbaseEc @@dataDir@@/ecAssocFromVectorbaseBiomart.tab @@dataDir@@/ecAssoc.tab ${abbrev}</unpack>

      <pluginArgs>--ECMappingFile @@dataDir@@/ecAssoc.tab --evidenceCode "VectorBaseBiomart" --aaSeqLocusTagMappingSql "select aa_sequence_id from dots.externalaasequence where secondary_identifier = ?"</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="orthomclUniprotEcForCore" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="abbrev">The unique 4-letter abbreviation used by OrthoMCL for each organism, will be prepended with a pipe to the source_id, e.g. aaeo|NP_212986. </prop>
    <prop name="ncbiTaxonId">&speciesNcbiTaxonId;</prop>

    <graphTemplateFile name="orthomclGetCoreProteins.xml"/>

    <datasetLoader plugin="GUS::Community::Plugin::InsertECMapping"
              datasetName="${abbrev}_Uniprot_ECAssociations_RSRC"
              version="TODAY"
              scope="dontcare">
  
     <wgetArgs url="https://www.uniprot.org/uniprot/?query=taxonomy%3a${ncbiTaxonId}&amp;format=tab&amp;columns=id,ec"> --output-document=@@dataDir@@/ecAssocFromUniprot.tab --content-disposition </wgetArgs>
     
     <unpack>orthomclUnpackUniprotEc @@dataDir@@/ecAssocFromUniprot.tab @@dataDir@@/ecAssoc.tab ${abbrev}</unpack>

      <pluginArgs>--ECMappingFile @@dataDir@@/ecAssoc.tab --evidenceCode "Uniprot" --aaSeqLocusTagMappingSql "select aa_sequence_id from dots.externalaasequence where secondary_identifier = ?"</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="orthomclUniprotEcForPeripheral" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="abbrev">The unique 4-letter abbreviation used by OrthoMCL for each organism, will be prepended with a pipe to the source_id, e.g. aaeo|NP_212986. </prop>
    <prop name="ncbiTaxonId">&speciesNcbiTaxonId;</prop>

    <graphTemplateFile name="orthomclGetPeripheralProteins.xml"/>

    <datasetLoader plugin="GUS::Community::Plugin::InsertECMapping"
              datasetName="${abbrev}_Uniprot_ECAssociations_RSRC"
              version="TODAY"
              scope="dontcare">
  
     <wgetArgs url="https://www.uniprot.org/uniprot/?query=taxonomy%3a${ncbiTaxonId}&amp;format=tab&amp;columns=id,ec"> --output-document=@@dataDir@@/ecAssocFromUniprot.tab --content-disposition </wgetArgs>
     
     <unpack>orthomclUnpackUniprotEc @@dataDir@@/ecAssocFromUniprot.tab @@dataDir@@/ecAssoc.tab ${abbrev}</unpack>

      <pluginArgs>--ECMappingFile @@dataDir@@/ecAssoc.tab --evidenceCode "Uniprot" --aaSeqLocusTagMappingSql "select aa_sequence_id from dots.externalaasequence where secondary_identifier = ?"</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="orthomclEuPathEcForCore" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="abbrev">The unique 4-letter abbreviation used by OrthoMCL for each organism, will be prepended with a pipe to the source_id, e.g. aaeo|NP_212986. </prop>
    <prop name="version">&version;</prop>
    <prop name="project"> The EuPathDB project, e.g. PlasmoDB.</prop>
    <prop name="webSubDir"> The lower case sub-directory of the EuPathDB project, e.g. micro. Used for webservices call.</prop>
    <prop name="organismName">The organism name as required by EuPath organism parameter.  Use %20 for space characters</prop>

    <graphTemplateFile name="orthomclGetCoreProteins.xml"/>

    <datasetLoader plugin="GUS::Community::Plugin::InsertECMapping"
              datasetName="${abbrev}_Eupath_ECAssociations_RSRC"
              version="${version}"
              scope="dontcare">
  
     <wgetArgs url="https://${project}.org/${webSubDir}/webservices/GeneQuestions/GenesByTaxon.xml?organism=${organismName}&amp;o-fields=ec_numbers"> --output-document=@@dataDir@@/ecAssocFromEuPathDB.xml --content-disposition </wgetArgs>

     <unpack>orthomclUnpackEupathDB_EC_XML @@dataDir@@/ecAssocFromEuPathDB.xml @@dataDir@@/ecAssoc.tab ${abbrev}</unpack>
     
      <pluginArgs>--ECMappingFile @@dataDir@@/ecAssoc.tab --evidenceCode "EuPathDB" --aaSeqLocusTagMappingSql "select aa_sequence_id from dots.externalaasequence where secondary_identifier = ?"</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="orthomclEuPathEcForPeripheral" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="abbrev">The unique 4-letter abbreviation used by OrthoMCL for each organism, will be prepended with a pipe to the source_id, e.g. aaeo|NP_212986. </prop>
    <prop name="version">&version;</prop>
    <prop name="project"> The EuPathDB project, e.g. PlasmoDB.</prop>
    <prop name="webSubDir"> The lower case sub-directory of the EuPathDB project, e.g. micro. Used for webservices call.</prop>
    <prop name="organismName">The organism name as required by EuPath organism parameter.  Use %20 for space characters</prop>

    <graphTemplateFile name="orthomclGetPeripheralProteins.xml"/>

    <datasetLoader plugin="GUS::Community::Plugin::InsertECMapping"
              datasetName="${abbrev}_Eupath_ECAssociations_RSRC"
              version="${version}"
              scope="dontcare">
  
     <wgetArgs url="https://${project}.org/${webSubDir}/webservices/GeneQuestions/GenesByTaxon.xml?organism=${organismName}&amp;o-fields=ec_numbers"> --output-document=@@dataDir@@/ecAssocFromEuPathDB.xml --content-disposition </wgetArgs>

     <unpack>orthomclUnpackEupathDB_EC_XML @@dataDir@@/ecAssocFromEuPathDB.xml @@dataDir@@/ecAssoc.tab ${abbrev}</unpack>
     
      <pluginArgs>--ECMappingFile @@dataDir@@/ecAssoc.tab --evidenceCode "EuPathDB" --aaSeqLocusTagMappingSql "select aa_sequence_id from dots.externalaasequence where secondary_identifier = ?"</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="orthomclClades" category="" datasetFileHint="">
    <purpose>Retrieve and load the hierarchy of clades file from manual delivery. </purpose>
    <prop name="release">Release number which serves as the subdirectory in manual delivery where the clades file is found.</prop>
    
    <datasetLoader datasetName="orthomclClades_RSRC" 	
	   plugin="ApiCommonData::Load::Plugin::InsertOrthomclTaxon"
		   scope="global"
		   type="taxonomy"
		   version="${release}">

      <manualGet fileOrDir="common/orthology/orthoMCL/${release}">
        <dir name="taxonomy">
        </dir>
      </manualGet>

      <pluginArgs>--cladeFile  @@dataDir@@/${release}/orthomclClades.txt --speciesFile  @@dataDir@@/${release}/orthomclTaxons.txt</pluginArgs>

    </datasetLoader>
  </datasetClass>

  <!-- oooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo -->
  <!-- oooooooooooooooooooooooooooo END OF OrthoMCL-DB Specific classes ooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo -->
  <!-- oooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo -->

  <datasetClass class="PopBio_Study" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="vbId"/>
    <prop name="projectName"/>
    <prop name="version"/>

    <graphTemplateFile name="project.xml"/>

    <datasetLoader datasetName="PopBio_Study_${vbId}_RSRC" version="${version}"
           plugin="ApiCommonData::Load::Plugin::LoadNothing"
           scope="global"
           type="population_biology"
           subType="mapveu"
           >
      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>



  
  <datasetClass class="Pathways" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>
    <prop name="format"/>
    <prop name="source"/>

    <graphTemplateFile name="pathways.xml"/>

    <datasetLoader datasetName="Pathways_${source}_RSRC" version="${version}"
           plugin="ApiCommonData::Load::Plugin::InsertPathways"
           scope="global"
           type="pathway"
           >
      <manualGet fileOrDir="common/pathways/${source}/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>
      <pluginArgs>--pathwaysFileDir @@dataDir@@/final --format ${format} --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%'</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="ReactionsXRefs" category ="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>
    <prop name="source"/>

    <graphTemplateFile name="pathways.xml"/>

    <datasetLoader datasetName="ReactionsXRefs_${source}_RSRC" version="${version}"
        plugin="ApiCommonData::Load::Plugin::InsertReactionXRefs"
        scope="global"
        type="pathway"
        >

        <manualGet fileOrDir="common/pathways/ReactionsXRefs_${source}/${version}/final/">
            <dir name="final"></dir>
        </manualGet>

        <pluginArgs>--input @@dataDir@@/final/xRefs.txt --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%'</pluginArgs>

    </datasetLoader>
  </datasetClass>

  <datasetClass class="eupathOntologyTerms" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>

    <datasetLoader datasetName="OntologyTerm_EuPath_RSRC" version="dontcare"
                   plugin="GUS::Supported::Plugin::InsertOntologyTermsAndRelationships"
                   scope="global"
                   type="sres"
                   >

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>
      <wgetArgs url="http://purl.obolibrary.org/obo/eupath.owl">--tries=5 --no-directories --no-host-directories --accept=@@dataDir@@/eupath.owl </wgetArgs>
      <pluginArgs>--inFile @@dataDir@@/eupath.owl --owlReader ApiCommonData::Load::OwlReader --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%' --relTypeExtDbRlsSpec 'Ontology_Relationship_Types_RSRC|%'</pluginArgs>
    </datasetLoader>
  </datasetClass>



  <datasetClass class="repositoryOntologyTerms" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>
    <prop name="name">&name;</prop>

    <graphTemplateFile name="eupathCuratedOntologies.xml"/>

    <datasetLoader datasetName="OntologyTerm_${name}_RSRC" version="dontcare"
                   plugin="GUS::Supported::Plugin::InsertOntologyTermsAndRelationships"
                   scope="global"
                   type="sres"
                   >

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--inFile @@gusHome@@/ontology/release/${version}/${name}.owl --owlReader ApiCommonData::Load::OwlReader --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%' --relTypeExtDbRlsSpec 'Ontology_Relationship_Types_RSRC|%'</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <!-- temporary.  change this to repositoryOntologyTerms once moved to production dir -->
  <datasetClass class="tempPopbioOntologyTerms" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="name">&name;</prop>

    <graphTemplateFile name="eupathCuratedOntologies.xml"/>

    <datasetLoader datasetName="OntologyTerm_${name}_RSRC" version="dontcare"
                   plugin="GUS::Supported::Plugin::InsertOntologyTermsAndRelationships"
                   scope="global"
                   type="sres"
                   >

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--inFile @@gusHome@@/ontology/popbio/${name}.owl --owlReader ApiCommonData::Load::OwlReader --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%' --relTypeExtDbRlsSpec 'Ontology_Relationship_Types_RSRC|%' --loadAnnotationProperties 1</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="updateTempPopbioOntologyTerms" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="name">&name;</prop>

    <graphTemplateFile name="updateOntologies.xml"/>

    <datasetLoader datasetName="OntologyTerm_UPDATE_${name}_RSRC" version="dontcare"
                   plugin="GUS::Supported::Plugin::InsertOntologyTermsAndRelationships"
                   scope="global"
                   type="sres"
                   >

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--inFile @@gusHome@@/ontology/${name}/${name}.owl --owlReader ApiCommonData::Load::OwlReader --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%' --relTypeExtDbRlsSpec 'Ontology_Relationship_Types_RSRC|%'</pluginArgs>
    </datasetLoader>
  </datasetClass>




  <datasetClass class="WebDisplayOntologyClinEpi" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="version">&version;</prop>
    <prop name="name">&name;</prop>
    <graphTemplateFile name="clinepiRoot.xml"/>

    <datasetLoader datasetName="OntologyTerm_${name}_RSRC" version="dontcare"
                   plugin="GUS::Supported::Plugin::InsertOntologyTermsAndRelationships"
                   scope="global"
                   type="sres"
                   >

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--inFile @@gusHome@@/ontology/release/${version}/${name}.owl --owlReader ApiCommonData::Load::OwlReader --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%' --relTypeExtDbRlsSpec 'Ontology_Relationship_Types_RSRC|%' --loadAnnotationProperties 1 </pluginArgs>
    </datasetLoader>
  </datasetClass>

  <!-- same as WebDisplayOntologyClinEpi but with a sourceFile designation, which does not have to match the name -->
  <datasetClass class="WebDisplayOntologyEDA" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="name">&name;</prop>
    <prop name="sourceFile"></prop>
    <graphTemplateFile name="microbiomeRootEda.xml"/>

    <datasetLoader datasetName="${name}" version="dontcare"
                   plugin="GUS::Supported::Plugin::InsertOntologyTermsAndRelationships"
                   scope="global"
                   type="sres"
                   >

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>
      <unpack>ln -s @@gusHome@@/${sourceFile} @@dataDir@@/${name}.owl</unpack>

      <pluginArgs>--inFile @@gusHome@@/${sourceFile} --owlReader ApiCommonData::Load::OwlReader --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%' --relTypeExtDbRlsSpec 'Ontology_Relationship_Types_RSRC|%' --loadAnnotationProperties 1 </pluginArgs>
    </datasetLoader>
  </datasetClass>

  <!-- dataset class for loading sample metadata -->
  
  <datasetClass class="SnpMetaData" category="" datasetFileHint="">
    <purpose></purpose>
	  <prop name="organismAbbrev"/>
	  <prop name="experimentName"/>
	  <prop name="experimentVersion"/>
	  <prop name="projectName">&projectName;</prop>
    
    <graphTemplateFile name="studyMetadata.xml"/>
   
    <datasetLoader datasetName="${organismAbbrev}_SNP_metaData_${experimentName}_RSRC" version="${experimentVersion}"
          plugin="ApiCommonData::Load::Plugin::InsertStudyMetaData"
              scope="organism"
              type="metadata"
              subType="SNP"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/SNP/${experimentName}/${experimentVersion}/metadata/sampleMetaData.txt">
        <dir name="metadata">
        </dir>
      </manualGet>

      <pluginArgs>--file @@dataDir@@/sampleMetaData.txt --studyExtDbRlsSpec '${organismAbbrev}_HTS_SNP_${experimentName}_RSRC|${experimentVersion}'</pluginArgs>
    </datasetLoader>

  </datasetClass>

    <datasetClass class="proteinMicroarrayMetaData" category="" datasetFileHint="">
    <purpose></purpose>
	  <prop name="organismAbbrev"/>
	  <prop name="experimentName"/>
	  <prop name="experimentVersion"/>
	  <prop name="projectName">&projectName;</prop>
    <graphTemplateFile name="studyMetadata.xml"/>
   
    <datasetLoader datasetName="${organismAbbrev}_immuneResponse_metaData_${experimentName}_RSRC" version="${experimentVersion}"
          plugin="ApiCommonData::Load::Plugin::InsertStudyMetaData"
              scope="organism"
              type="metadata"
              subType="immuneResponse"
              organismAbbrev="${organismAbbrev}"
          >
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/proteinMicroarray/${experimentName}/${experimentVersion}/metadata/sampleMetaData.txt">
        <dir name="metadata">
        </dir>
      </manualGet>


      <pluginArgs>--file @@dataDir@@/sampleMetaData.txt --studyExtDbRlsSpec '${organismAbbrev}_microarrayAntibody_${experimentName}_RSRC|${experimentVersion}'</pluginArgs>

    </datasetLoader>

  </datasetClass>

  <datasetClass class="SNPChipMetaData" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev"/> 
    <prop name="experimentName"/>
    <prop name="experimentVersion"/>
    <prop name="projectName">&projectName;</prop>

    <graphTemplateFile name="studyMetadata.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_SNPChip_metaData_${experimentName}_RSRC" version="${experimentVersion}"
        plugin="ApiCommonData::Load::Plugin::InsertStudyMetaData"
            scope="organism"
            type="metadata"
            subType="SNPChip"
            organismAbbrev="${organismAbbrev}"
    >
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/SNP/${experimentName}/${experimentVersion}/metadata/sampleMetaData.txt">
        <dir name="metadata">
        </dir>
      </manualGet>

      <getAndUnpackOutput dir="@@dataDir@@/metadata"/>
      <getAndUnpackOutput file="@@dataDir@@/metadata/sampleMetaData.txt"/>

      <pluginArgs>--file @@dataDir@@/sampleMetaData.txt --studyExtDbRlsSpec '${organismAbbrev}_SNPChip_${experimentName}_RSRC|${experimentVersion}'</pluginArgs>

    </datasetLoader>
  </datasetClass>
  
  <!-- datasetClasses for chEBI Compounds -->
  <datasetClass class="chEBI_Compounds" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>

    <datasetLoader datasetName="compounds_chEBI_RSRC" version="${version}"
		   plugin="ApiCommonData::Load::Plugin::LoadNothing"
		   scope="global"
		   type="compound"
		   >

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>
      <unpack>ln -s @@manualDeliveryDir@@/common/metabolites/chEBI/${version}/final/ @@dataDir@@/final</unpack>

      <getAndUnpackOutput dir="@@dataDir@@/final" />
      <getAndUnpackOutput file="@@dataDir@@/final/chemical_data.sql"/>
      <getAndUnpackOutput file="@@dataDir@@/final/comments.sql"/>
      <getAndUnpackOutput file="@@dataDir@@/final/compound_origins.sql"/>
      <getAndUnpackOutput file="@@dataDir@@/final/compounds.sql"/>
      <getAndUnpackOutput file="@@dataDir@@/final/database_accession.sql"/>
      <getAndUnpackOutput file="@@dataDir@@/final/names.sql"/>
      <getAndUnpackOutput file="@@dataDir@@/final/references.sql"/>
      <getAndUnpackOutput file="@@dataDir@@/final/relation.sql"/>
      <getAndUnpackOutput file="@@dataDir@@/final/structures.sql"/>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>

    </datasetLoader>
  </datasetClass>

  <!-- datasetClass for HMDB Compounds -->
  <datasetClass class="HMDB_Compounds" category="" datasetFileHint="">
    <purpose>Load HMDB Metabolites</purpose>
    <prop name="version">&version;</prop>

    <datasetLoader datasetName="compounds_HMDB_RSRC" version="${version}"
            plugin="ApiCommonData::Load::Plugin::InsertHMDB"
            scope="global"
            type="compound"
    >

        <manualGet fileOrDir="common/empty">
            <dir name="final"/>
        </manualGet>
        <unpack>ln -s @@manualDeliveryDir@@/common/metabolites/HMDB/${version}/final @@dataDir@@/final</unpack>

        <getAndUnpackOutput dir="@@dataDir@@/final"/>
        <getAndUnpackOutput file="@@dataDir@@/final/hmdb_metabolites.xml"/>
        <getAndUnpackOutput file="@@dataDir@@/final/structures.sdf"/>

        <pluginArgs>--xmlFile @@dataDir@@/final/hmdb_metabolites.xml --sdfFile @@dataDir@@/final/structures.sdf</pluginArgs>
    </datasetLoader>
  </datasetClass>
  


  <!-- datasetClass for Metabolite Profiles - deprecated-->
  <datasetClass class="metaboliteProfiles" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="experimentName"/>
    <prop name="experimentVersion"/>

    <graphTemplateFile name="project.xml"/>
    <datasetLoader datasetName="metaboliteProfiles_${experimentName}_RSRC" version="${experimentVersion}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="global"
              type="metabolite_levels"
              subType="FILL"
              organismAbbrev="">

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>
      <unpack>ln -s @@manualDeliveryDir@@/${projectName}/common/massSpecExperiments/${experimentName}/${experimentVersion}/final/ @@dataDir@@/final</unpack>

      <getAndUnpackOutput dir="@@dataDir@@/final" />
      <getAndUnpackOutput file="@@dataDir@@/final/analysisConfig.xml"/>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="compoundMassSpec" category="" datasetFileHint="">
    <purpose>New class for untargeted metabolomics</purpose>
    <prop name="experimentName"/>
    <prop name="experimentVersion"/>
    <prop name="projectName">&projectName;</prop>

    <graphTemplateFile name="project.xml"/>

    <datasetLoader datasetName="compoundMassSpec_${experimentName}_RSRC" version="${experimentVersion}"
           plugin="ApiCommonData::Load::Plugin::InsertCompoundMassSpec"
           scope="global"
           type="compound"
           subType="metabolite_levels"
           >
      <manualGet fileOrDir="${projectName}/common/metabolites/${experimentName}/${experimentVersion}/final">
        <dir name="final">
        </dir>
      </manualGet>

      <getAndUnpackOutput dir="@@dataDir@@/final" />
      <getAndUnpackOutput file="@@dataDir@@/final/peaks.tab" />
      <getAndUnpackOutput file="@@dataDir@@/final/data.tab" />
      <getAndUnpackOutput file="@@dataDir@@/final/mapping.tab" />

      <pluginArgs>--inputDir @@dataDir@@/final --configFile 'insert_study_results_config.txt' --extDbSpec '%DATASET_NAME%|%DATASET_VERSION%' --studyName 'compoundMassSpec_${experimentName}_RSRC'</pluginArgs>
    </datasetLoader>
  </datasetClass>


 <datasetClass class="originsOfReplicationExperiment" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName"></prop>
    <prop name="experimentVersion"></prop>
    <prop name="hasPairedEnds"/>
    <prop name="isColorspace"/>
    <prop name="removePCRDuplicates">If true samtools rmdup will run after mapping</prop>
    <prop name="coverageWindowSize">This workflow calculates coverage in windows across the genome.  Default window size is 2500 (bp)</prop>
    <prop name="extraBowtieParams">Parameters for Bowtie(2) above and beyond the default can be added verbatim here. "None" if default is ok</prop>

    <graphTemplateFile name="originsOfReplicationExperiment.xml"/>
   
    <datasetLoader datasetName="${organismAbbrev}_originsOfReplication_${experimentName}_RSRC" version="${experimentVersion}"
          plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="resequencing"
              subType="originsOfReplication"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">

        <dir name="final">
        </dir>
      </manualGet>

      <unpack>rm -rf @@dataDir@@/final</unpack>
      <!-- since mirroring is already done, now we can make a non-empty final dir -->
      <unpack>ln -s @@manualDeliveryDir@@/${projectName}/${organismAbbrev}/originsOfReplication/${experimentName}/${experimentVersion}/final/ @@dataDir@@</unpack>

      <getAndUnpackOutput dir="@@dataDir@@/final" />

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>


  <datasetClass class="originsOfReplicationSamples" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName"/>
    <prop name="experimentVersion"/>
    <prop name="sampleName"/>

    <graphTemplateFile name="originsOfReplicationSamples.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${experimentName}_${sampleName}_originsOfReplicationSample_RSRC" version="dontcare"
          plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="resequencing"
              subType="originsOfReplication"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <descriptionOfFinal>The final/ dir must contain four files per sample. These should be sampleName.fsa, sampleName.fsa.paired, sampleName.qual, sampleName.qual.paired.  Fasta files in final/ should have been trimmed of adaptors and filtered for quality if required.  If the reads are not paired-end or quality files are not available, make empty files with the appropriate names</descriptionOfFinal>
        <dir name="final">
        </dir>
      </manualGet>

      <getAndUnpackOutput dir="@@dataDir@@/../final" />
      <getAndUnpackOutput file="@@dataDir@@/../final/${sampleName}.fsa" />
      <getAndUnpackOutput file="@@dataDir@@/../final/${sampleName}.fsa.paired" />

      <getAndUnpackOutput file="@@dataDir@@/../final/${sampleName}.qual" />
      <getAndUnpackOutput file="@@dataDir@@/../final/${sampleName}.qual.paired" />

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>

    </datasetLoader>
  </datasetClass>


<!-- CGH Array -->

  <datasetClass class="cghArrayPlatform" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="hasPairedEnds"/>

    <graphTemplateFile name="genomicArrayStudies.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_cghArrayPlatform_${name}_RSRC" version="${version}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="microarray_platform"
              subType="cgh_array"
              organismAbbrev="${organismAbbrev}"
	      >

      <manualGet fileOrDir="${projectName}/${organismAbbrev}/microarrayPlatform/${name}/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>


      <getAndUnpackOutput dir="@@dataDir@@/final"/>
      <getAndUnpackOutput file="@@dataDir@@/final/probes.fsa"/>


      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>


  <datasetClass class="cghArrayExperiment" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName"/>
    <prop name="experimentVersion"/>
    <prop name="cghArrayPlatformName"/>
    <prop name="cghArrayPlatformVersion"/>

    <graphTemplateFile name="genomicArrayStudies.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_cghArrayExper_${experimentName}_RSRC" version="${experimentVersion}"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="population_biology"
              subType="cgh_array"
              organismAbbrev="${organismAbbrev}"
	      >

     <manualGet fileOrDir="${projectName}/${organismAbbrev}/cghArray/${experimentName}/${experimentVersion}/final">
        <dir name="final">
        </dir>
      </manualGet>

     <getAndUnpackOutput dir="@@dataDir@@/final" />

     <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>

    </datasetLoader>
  </datasetClass>


  <!-- the files containing the sample data are assumed to be normalized -->
  <datasetClass class="cghArraySample" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName"/>
    <prop name="sampleName"/>
 
    <graphTemplateFile name="dnaArraySamples.xml"/>

      <!-- we load a fake resource here so we can make a getAndUnpackOutput -->
      <!-- to declare existence of sample file that is acquired by experiment, for test mode -->
    <datasetLoader datasetName="${organismAbbrev}_${experimentName}_${sampleName}_dnaArraySample_RSRC" version="dontcare"
	      plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="population_biology"
              subType="cgh_array"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>
      <getAndUnpackOutput file="@@dataDir@@/../${organismAbbrev}_cghArrayExper_${experimentName}_RSRC/final/${sampleName}.txt" />

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>

<!--copy and format files from EuPathDB manualDelivery to download sites and web services-->
    <datasetClass class="copyAndFormatDownloadFilesFromManualDelivery" category="" datasetFileHint="">
        <purpose></purpose>
        <prop name="projectName">&projectName;</prop>
        <prop name="relativeManualDeliveryDir"/>
        <prop name="relativeDownloadSiteDir"/>
        <prop name="relativeWebServiceDir"/>
        <prop name="datasetName"/>
        <prop name="formatDownloadFile"/>
        <prop name="argsOfFormatingDownloadFile"/>
        <prop name="formattedOutputName"/>
        <prop name="inputFileNameRegex"/>
        <graphTemplateFile name="project.xml"/>

  </datasetClass>

 
    <datasetClass class="smallNcRnaExperiment" category="" datasetFileHint="">
    <purpose>Add an experiment mapping small non-coding RNAs to the genome</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName"></prop>
    <prop name="experimentVersion"></prop>
    <prop name="hasPairedEnds"/>
    <prop name="isColorspace"/>
    <prop name="removePCRDuplicates">If true samtools rmdup will run after mapping</prop>
    <prop name="extraBowtieParams">Parameters for Bowtie(2) above and beyond the default can be added verbatim here. "None" if default is ok</prop>
    <prop name="minReadLength">This workflow filters reads by length. Min 20 recommended unless stated by provider</prop>
    <prop name="maxReadLength">Max 35 recommended unless stated by provider</prop>
    <prop name="sequenceFormat">fastq (quality offset 33) or fastq-illumina (quality offset 64)</prop>

    <graphTemplateFile name="smallNcRnaExperiment.xml"/>
   
    <datasetLoader datasetName="${organismAbbrev}_smallNcRna_${experimentName}_RSRC" version="${experimentVersion}"
          plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="smallNcRna"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">

        <dir name="final">
        </dir>
      </manualGet>

      <unpack>rm -rf @@dataDir@@/final</unpack>
      <!-- since mirroring is already done, now we can make a non-empty final dir -->
      <unpack>ln -s @@manualDeliveryDir@@/${projectName}/${organismAbbrev}/rnaSeq/${experimentName}/${experimentVersion}/final/ @@dataDir@@</unpack>

      <getAndUnpackOutput dir="@@dataDir@@/final" />

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>

  <datasetClass class="smallNcRnaSamples" category="" datasetFileHint="">
    <purpose>Add samples for small non-coding RNA experiments</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName"/>
    <prop name="experimentVersion"/>
    <prop name="sampleName">Should match filename without extension</prop>

    <graphTemplateFile name="smallNcRnaSamples.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${experimentName}_${sampleName}_smallNcRnaSample_RSRC" version="dontcare"
          plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="transcript_expression"
              subType="smallNcRna"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <descriptionOfFinal>The final/ dir must contain a fastq file for each sample, named sampleName.fastq.  Fastq files in final/ should have been trimmed of adaptors and filtered for quality if required</descriptionOfFinal>
        <dir name="final">
        </dir>
      </manualGet>

      <!--So far all these experiments are single ended so don't need to worry about pair files-->
      <getAndUnpackOutput file="@@dataDir@@/../${organismAbbrev}_smallNcRna_${experimentName}_RSRC/final/${sampleName}.fastq" />

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>

    </datasetLoader>
  </datasetClass>

  <datasetClass class="copyNumberVariationExperiment" category="" datasetFileHint="">
    <purpose>Add an experiment where reads from samples are mapped to the genome for the purpose of calculating copy number variations at gene and chromosome level</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName">Should be same as experiment name for related SNPs dataset</prop>
    <prop name="experimentVersion"></prop>
    <prop name="ploidy">Base ploidy (i.e., ploidy for the majority of chromosomes) in the reference. Use 1 for haploid organisms and 2 for diploid organisms unless otherwise specified</prop>

    <graphTemplateFile name="SNPs_HTS.xml"/>
   
    <datasetLoader datasetName="${organismAbbrev}_copyNumberVariations_${experimentName}_RSRC" version="${experimentVersion}"
          plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="resequencing"
              subType="copyNumberVariation"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>


  <datasetClass class="copyNumberVariationSamples" category="" datasetFileHint="">
    <purpose>Add samples for copy number variation experiments</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="experimentName"/>
    <prop name="experimentVersion"/>
    <prop name="sampleName">Should match filename without extension</prop>

    <graphTemplateFile name="cnvSamples.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${experimentName}_CNV_${sampleName}_copyNumberVariationSample_RSRC" version="dontcare"
          plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="resequencing"
              subType="copyNumberVariation"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <descriptionOfFinal></descriptionOfFinal>
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>

    </datasetLoader>
  </datasetClass>


  <datasetClass class="copyNumberVariationMetaData" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev"/> 
    <prop name="experimentName"/>
    <prop name="experimentVersion"/>
    <prop name="projectName">&projectName;</prop>

    <graphTemplateFile name="studyMetadata.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_copyNumberVariation_metaData_${experimentName}_RSRC" version="${experimentVersion}"
        plugin="ApiCommonData::Load::Plugin::InsertStudyMetaData"
            scope="organism"
            type="metadata"
            subType="copyNumberVariation"
            organismAbbrev="${organismAbbrev}"
    >
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/dnaSeq/${experimentName}/${experimentVersion}/metadata/sampleMetaData.txt">
        <dir name="metadata">
        </dir>
      </manualGet>


      <pluginArgs>--file @@dataDir@@/sampleMetaData.txt --studyExtDbRlsSpec '${organismAbbrev}_copyNumberVariations_${experimentName}_RSRC|${experimentVersion}'</pluginArgs>
    </datasetLoader>
  </datasetClass>
 

  <datasetClass class="EcNumberGenus" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>

    <datasetLoader datasetName="EcNumberGenus_RSRC" version="${version}"
		   plugin="ApiCommonData::Load::Plugin::InsertEcNumberGenus"
		   scope="global"
		   type="ECToGenus"
		   >
      <manualGet fileOrDir="common/function/EcToGenus/${version}/final/ec_organism.txt">
        <dir name="final">
        </dir>
      </manualGet>
      <pluginArgs>--ecNumberGenusFile @@dataDir@@/ec_organism.txt</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <!-- The bedgraph file for this class needs a non-zero value for the 4th column -->
  <datasetClass class="createGffBigWig" category="" datasetFileHint=""> 
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="gsnap.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${name}_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::LoadNothing"
              type=""
              scope="organism"
              organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/gff/${name}/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>
      <getAndUnpackOutput dir="@@dataDir@@/final"/>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="StudyResultsLiteral" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>
    <prop name="projectName">&projectName;</prop>
    <prop name="name">&name;</prop>

    <graphTemplateFile name="project.xml"/>

    <datasetLoader datasetName="StudyResult_${name}_RSRC" version="${version}"
		   plugin="ApiCommonData::Load::Plugin::InsertStudyResults"
		   scope="global"
		   type="results"
		   >
      <manualGet fileOrDir="${projectName}/common/results/${name}/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>
      <pluginArgs>--inputDir @@dataDir@@/final/ --configFile @@dataDir@@/final/insert_study_results.txt --extDbSpec "%DATASET_NAME%|%DATASET_VERSION%" --studyName "%DATASET_NAME%"</pluginArgs>
    </datasetLoader>
  </datasetClass>




  <datasetClass class="EDAMegaStudy_WDK" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="vbId"/>
    <prop name="projectName"/>
    <prop name="version"/>

    <graphTemplateFile name="project.xml"/>

    <datasetLoader datasetName="EDAMegaStudy_${vbId}_RSRC" version="${version}"
           plugin="ApiCommonData::Load::Plugin::LoadNothing"
           scope="global"
           type="population_biology"
           subType="mapveu"
           >
      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>




  <datasetClass class="EDAMegaStudy" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="studyStableId"></prop> <!-- VBP0000123 -->
    <prop name="version"></prop>
    <prop name="webDisplayOntologyName"></prop>

    <graphTemplateFile name="edaStudies.xml"/>

    <datasetLoader
        datasetName="EDAMegaStudy_${studyStableId}_RSRC"
        version="${version}"
        plugin="ApiCommonData::Load::Plugin::LoadNothing"
        scope="global">


      <manualGet fileOrDir="${projectName}/popbio/${studyStableId}/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>

  <datasetClass class="EDAMegaStudyMicrobiome" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="studyStableId"></prop> <!-- VBP0000123 -->
    <prop name="version"></prop>
    <prop name="webDisplayOntologyName"></prop>

    <graphTemplateFile name="edaStudies.xml"/>

    <datasetLoader
        datasetName="EDAMegaStudy_${studyStableId}_RSRC"
        version="${version}"
        plugin="ApiCommonData::Load::Plugin::LoadNothing"
        scope="global">


      <manualGet fileOrDir="${projectName}/common/MicrobiomeStudyEda/${studyStableId}/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>



  <datasetClass class="ISATabPopBio_WDK" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="vbId"/>
    <prop name="projectName"/>
    <prop name="version"/>

    <graphTemplateFile name="project.xml"/>

    <datasetLoader datasetName="ISATab_${vbId}_RSRC" version="${version}"
           plugin="ApiCommonData::Load::Plugin::LoadNothing"
           scope="global"
           type="population_biology"
           subType="mapveu"
           >
      <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
      </manualGet>
      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>



  <datasetClass class="ISATabPopBio" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="studyName"></prop> <!-- VBP0000123 -->
    <prop name="version"></prop>
    <prop name="webDisplayOntologyName"></prop>
    <prop name="speciesReconciliationOntologySpec"></prop>
    <prop name="speciesReconciliationFallbackSpecies"></prop>

    <graphTemplateFile name="edaStudies.xml"/>

    <datasetLoader
        datasetName="ISATab_${studyName}_RSRC"
        version="${version}"
        plugin="ApiCommonData::Load::Plugin::LoadNothing"
        scope="global">


      <manualGet fileOrDir="${projectName}/popbio/${studyName}/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>

  <datasetClass class="SingleISATabPopBio" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="studyName"></prop> <!-- VBP0000123 -->
    <prop name="version"></prop>
    <prop name="webDisplayOntologyName"></prop>
    <prop name="speciesReconciliationOntologySpec"></prop>
    <prop name="speciesReconciliationFallbackSpecies"></prop>

    <graphTemplateFile name="edaStudies.xml"/>

    <datasetLoader
        datasetName="ISATab_${studyName}_RSRC"
        version="${version}"
        plugin="ApiCommonData::Load::Plugin::LoadNothing"
        scope="global">


      <manualGet fileOrDir="${projectName}/popbio/${studyName}/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>




  <datasetClass class="ExternalResourceUrl" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>
    <prop name="projectName">&projectName;</prop>
    <prop name="name">&name;</prop>

    <graphTemplateFile name="project.xml"/>

    <datasetLoader datasetName="ExternalResourceUrl_${name}_RSRC" version="${version}"
           plugin="ApiCommonData::Load::Plugin::InsertExternalResourceUrl"
           scope="global"
           type="externalResourceUrl"
           >
      <manualGet fileOrDir="common/externalResourceUrl/${name}/${version}/final">
        <dir name="final">
        </dir>
      </manualGet>
      <pluginArgs>--inputFile @@dataDir@@/final/URLs.tab --core_version ${version}</pluginArgs>
    </datasetLoader>
  </datasetClass>

  <datasetClass class="auxiliaryDummy" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>

    <graphTemplateFile name="organismSpecificMiscNoAlias.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_${name}_RSRC" version="${version}"
                   plugin="ApiCommonData::Load::Plugin::LoadNothing"
                   scope="organism"
                   type="unknown"
                   organismAbbrev="${organismAbbrev}">
    <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
    </manualGet>
     <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>
  
  <datasetClass class="legacyDatasets" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="version">&version;</prop>
  <datasetLoader datasetName="Legacy_Datasets_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::InsertLegacyDataset"
              scope="global"
              type="sres"
              >
    <manualGet fileOrDir="common/dataset/LegacyDatasetNames/${version}/final/datasetnames.txt">
        <dir name="final">
        </dir>
    </manualGet>
    <pluginArgs>--legacyDatasetFile @@dataDir@@/datasetnames.txt --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%'</pluginArgs>
  </datasetLoader>
  </datasetClass>
  
  <datasetClass class="productionDatasets" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>

    <graphTemplateFile name="project.xml"/>

  <datasetLoader datasetName="Production_Datasets_RSRC" version="current"
              plugin="ApiCommonData::Load::Plugin::InsertProductionDatasets"
              scope="global"
              type="sres"
              >
    <manualGet fileOrDir="common/empty">
        <dir name="final">
        </dir>
    </manualGet>
    <pluginArgs>--projectName "${projectName}" --extDbRlsSpec '%DATASET_NAME%|%DATASET_VERSION%'</pluginArgs>
  </datasetLoader>
  </datasetClass>  

  <datasetClass class="dnaSeqExperimentFromAccession" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="isPaired"></prop>
    <prop name="ploidy"></prop>
    <prop name="fromBAM"></prop>
    <prop name="isLocal"></prop>
    <prop name="taxonId"></prop>
    <graphTemplateFile name="dnaseq.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_dnaseqExperiment_${name}_RSRC" version="${version}"
          plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="isolates"
              subType="Dna_Seq"
              organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/dnaSeq/${name}/${version}/final/accessions.tsv">
        <dir name="final">
        </dir>
      </manualGet>
      <getAndUnpackOutput file="@@dataDir@@/accessions.tsv"/>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>


  <datasetClass class="dnaSeqExperimentFromLocal" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="isPaired"></prop>
    <prop name="ploidy"></prop>
    <prop name="fromBAM"></prop>
    <prop name="isLocal"></prop>
    <prop name="taxonId"></prop>
    <graphTemplateFile name="dnaseq.xml"/>

    <datasetLoader datasetName="${organismAbbrev}_dnaseqExperiment_${name}_RSRC" version="${version}"
          plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="isolates"
              subType="Dna_Seq"
              organismAbbrev="${organismAbbrev}">
      <manualGet fileOrDir="${projectName}/${organismAbbrev}/dnaSeq/${name}/${version}/final/">
        <dir name="final">
        </dir>
      </manualGet>
      <getAndUnpackOutput file="@@dataDir@@/final"/>

      <pluginArgs>--dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>

  </datasetClass>

  <!-- New dataset class for the long read RNA Seq -->
  <datasetClass class="LongReadRnaSeqExperimentNextflow" category="" datasetFileHint="">
    <purpose></purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="name">&name;</prop>
    <prop name="version">&version;</prop>
    <prop name="sequencePlatform"></prop>

    <graphTemplateFile name="hisat.xml"/>
    <qaNotes>
        To be added once after testing 
    </qaNotes> 
    <datasetLoader datasetName="${organismAbbrev}_${name}_rnaSeqNextflow_RSRC" version="${version}"
              plugin="ApiCommonData::Load::Plugin::LoadNothing"
              scope="organism"
              type="longRead_transcript_expression"
              subType="longReadrnaseq"
              organismAbbrev="${organismAbbrev}">

      <manualGet fileOrDir="common/empty">
        <descriptionOfFinal>
	The final/ dir must contain the following files: analysisConfig.xml and a FASTQ file for each sample in the experiment or a tsv file (sraSampleList.tsv) that contain the list of samples to be analyse. The analysisConfig.xml privides properties for creating expression profiles of all samples in the experiment. The name of FASTQ file or sra ID in he sraSampleList.tsv file must be consistent with "sampleName" defined in "rnaSeqSample". To make analysisConfig.xml, please check the google doc: "Analysis Config Breakdown", to make the sraSampleList.tsv please check .....
	</descriptionOfFinal>
        <dir name="final">
        </dir>
      </manualGet>
      <unpack>ln -s @@manualDeliveryDir@@/${projectName}/${organismAbbrev}/longReadrnaSeq/${name}/${version}/final/ @@dataDir@@/final</unpack>

      <getAndUnpackOutput dir="@@dataDir@@/final" />
      <getAndUnpackOutput file="@@dataDir@@/final/analysisConfig.xml"/>
      <pluginArgs>dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
 </datasetClass>

  <datasetClass class="stableIdsEvents" category="" datasetFileHint="">
    <purpose>copy stable id ids_events.tab file from EBI ftp site to apiSiteFile</purpose>
    <prop name="projectName">&projectName;</prop>
    <prop name="organismAbbrev">&organismAbbrev;</prop>
    <prop name="buildNumber">which build number (eg 63)</prop>
    <prop name="name">&name;</prop>

    <graphTemplateFile name="organismSpecificMisc.xml"/>

    <datasetLoader plugin="ApiCommonData::Load::Plugin::LoadNothing"
              datasetName="${organismAbbrev}_${name}_stableIdsEvents_RSRC"
              version="${buildNumber}"
              scope="organism"
              type=""
              organismAbbrev="${organismAbbrev}">
      <wgetArgs url="ftp://ftp-private.ebi.ac.uk//upload/EBI/build${buildNumber}/stable_id_events/metadata/${projectName}/${organismAbbrev}/${name}.tab">--cut-dirs 8 --no-host-directories  --recursive --no-parent --ftp-user @@ebiFtpUser@@ --ftp-password @@ebiFtpPassword@@</wgetArgs>
      <pluginArgs>-dbRefExternalDatabaseSpec "%DATASET_NAME%|%DATASET_VERSION%"</pluginArgs>
    </datasetLoader>
  </datasetClass>

</datasetClasses>

